{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"himalaya-mcp","text":"<p>Privacy-first email for Claude -- an MCP server and Claude Code plugin (<code>email</code>) wrapping the himalaya CLI.</p>"},{"location":"#what-is-himalaya-mcp","title":"What is himalaya-mcp?","text":"<p>himalaya-mcp gives Claude the ability to read, triage, compose, and manage email -- all without sending your credentials to the cloud. It wraps the local himalaya CLI as a subprocess, exposing email operations through the Model Context Protocol. Install as the <code>email</code> plugin in Claude Code for <code>/email:*</code> slash commands.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li> <p> 19 MCP Tools</p> <p>List, search, read, flag, move, draft reply, send, export, action items, clipboard, folders, attachments, calendar</p> <p> Command Reference</p> </li> <li> <p> 4 MCP Prompts</p> <p>Triage inbox, summarize email, daily digest, draft reply</p> <p> Prompt Details</p> </li> <li> <p> Two-Phase Send</p> <p><code>send_email</code> returns a preview first; requires explicit <code>confirm=true</code></p> <p> Safety Model</p> </li> <li> <p> Multi-Account</p> <p>Switch accounts per-call via <code>account</code> parameter</p> <p> Multi-Account Guide</p> </li> <li> <p> Plugin + Server + Extension</p> <p>Claude Code plugin (11 skills, 1 hook), MCP server, or <code>.mcpb</code> Desktop Extension</p> <p> Installation</p> </li> <li> <p> Privacy-First</p> <p>All authentication stays local. No OAuth tokens leave your machine.</p> <p> Architecture</p> </li> </ul>"},{"location":"#how-it-works","title":"How It Works","text":"<pre><code>flowchart LR\n    A[\"`**Claude**\n    Code / Desktop`\"] --&gt;|MCP JSON-RPC| B[\"`**himalaya-mcp**\n    19 tools \u00b7 4 prompts`\"]\n    B --&gt;|execFile| C[\"`**himalaya CLI**\n    --output json`\"]\n    C --&gt;|IMAP/SMTP| D[\"`**Mail Server**\n    Gmail, Fastmail, etc.`\"]</code></pre> <ul> <li>All authentication stays local (himalaya handles IMAP/SMTP auth)</li> <li>No OAuth tokens leave your machine</li> <li>Subprocess uses <code>execFile</code> (no shell injection)</li> <li>Claude never sends email without your explicit confirmation</li> </ul>"},{"location":"#plugin-skills","title":"Plugin Skills","text":"<p>When installed as a Claude Code plugin, these slash commands are available:</p> Skill Description <code>/email:inbox</code> Check inbox, list recent emails <code>/email:triage</code> AI-powered email classification <code>/email:digest</code> Generate daily priority digest <code>/email:reply</code> Draft and send with safety gate <code>/email:compose</code> Compose new emails with safety gate <code>/email:attachments</code> List, download, and calendar invites <code>/email:search</code> Search by keyword, sender, flags, dates <code>/email:manage</code> Bulk flag, move, archive with confirmation <code>/email:stats</code> Inbox statistics, top senders, trends <code>/email:config</code> Setup wizard with provider templates <code>/email:help</code> Help hub -- browse all tools, prompts, workflows"},{"location":"#quick-start","title":"Quick Start","text":""},{"location":"#homebrew-recommended","title":"Homebrew (recommended)","text":"<pre><code>brew tap data-wise/tap\nbrew install himalaya-mcp\n</code></pre> <p>That's it. Homebrew installs himalaya CLI + Node.js, bundles the server, symlinks the plugin, and auto-enables it in Claude Code.</p>"},{"location":"#claude-code-plugin-from-github","title":"Claude Code Plugin (from GitHub)","text":"<p>Prerequisites: <code>brew install node himalaya</code> (not bundled with GitHub install).</p> <pre><code>claude plugin marketplace add Data-Wise/himalaya-mcp\nclaude plugin install email\n</code></pre>"},{"location":"#from-source","title":"From Source","text":"<pre><code>brew install himalaya          # Email CLI\ngit clone https://github.com/Data-Wise/himalaya-mcp.git\ncd himalaya-mcp\nnpm install &amp;&amp; npm run build\nln -s $(pwd) ~/.claude/plugins/himalaya-mcp\n</code></pre>"},{"location":"#claude-desktop","title":"Claude Desktop","text":"<pre><code># Desktop Extension (.mcpb) \u2014 recommended\n# Download .mcpb from GitHub Releases, double-click to install\n# Or via CLI:\nhimalaya-mcp install-ext\n\n# Legacy MCP server config\nhimalaya-mcp setup\n</code></pre>"},{"location":"#verify-installation","title":"Verify Installation","text":"<pre><code>himalaya-mcp doctor            # Check all settings across the stack\nhimalaya-mcp doctor --fix      # Auto-fix common issues\n</code></pre> <p>Then in Claude Code:</p> <pre><code>You: \"Check my inbox\"\nYou: \"Triage my last 10 emails\"\nYou: \"Reply to the meeting email\"\nYou: \"Give me today's email digest\"\nYou: \"/email:help\"\n</code></pre>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li>Installation -- detailed setup guide</li> <li>Quick Start -- first email in 2 minutes</li> <li>Tutorials -- step-by-step from beginner to automation</li> <li>Command Reference -- all tools, prompts, and resources</li> <li>User Guide -- complete walkthrough</li> <li>Workflows -- common email patterns</li> <li>Cookbook -- practical recipes combining multiple skills</li> <li>Quick Reference -- one-page cheat sheet</li> <li>Architecture -- system design and security</li> <li>Desktop Extension -- install <code>.mcpb</code> in Claude Desktop</li> <li>Desktop Extensions Reference -- <code>.mcpb</code> format details</li> </ul>"},{"location":"bundling-research/","title":"Bundling himalaya CLI for macOS Distribution","text":"<p>Date: 2026-02-16 Purpose: Research findings for bundling himalaya CLI binary within .mcpb distribution</p>"},{"location":"bundling-research/#1-pre-built-himalaya-binaries-for-macos","title":"1. Pre-built himalaya Binaries for macOS","text":""},{"location":"bundling-research/#available-downloads","title":"Available Downloads","text":"<p>Source: himalaya v1.1.0 release</p> Platform Filename Compressed Size Extracted Size Download URL macOS arm64 <code>himalaya.aarch64-darwin.tgz</code> 9.0 MB 24 MB Download macOS x64 <code>himalaya.x86_64-darwin.tgz</code> 9.3 MB 25 MB Download"},{"location":"bundling-research/#binary-details","title":"Binary Details","text":"<ul> <li>arm64 binary: 24 MB (Mach-O 64-bit executable arm64)</li> <li>x64 binary: 25 MB (Mach-O 64-bit executable x86_64)</li> <li>Archive includes: Binary + completions + man pages + desktop file</li> <li>Current installed version: v1.1.0 (Homebrew installs 24 MB arm64 binary)</li> </ul>"},{"location":"bundling-research/#tarball-contents","title":"Tarball Contents","text":"<pre><code>himalaya                         # The binary\nshare/\n  man/                          # Man pages\n  completions/                  # Shell completions (bash, zsh, fish, elvish)\n  applications/himalaya.desktop # Desktop entry file\n</code></pre>"},{"location":"bundling-research/#2-creating-universal-fat-binaries","title":"2. Creating Universal (Fat) Binaries","text":""},{"location":"bundling-research/#using-lipo-command","title":"Using <code>lipo</code> Command","text":"<p>Apple's <code>lipo</code> tool merges architecture-specific binaries into a single universal binary:</p> <pre><code># Download both architectures\ncurl -L https://github.com/pimalaya/himalaya/releases/download/v1.1.0/himalaya.aarch64-darwin.tgz | tar xzf - himalaya\nmv himalaya himalaya-arm64\n\ncurl -L https://github.com/pimalaya/himalaya/releases/download/v1.1.0/himalaya.x86_64-darwin.tgz | tar xzf - himalaya\nmv himalaya himalaya-x64\n\n# Create universal binary\nlipo -create himalaya-arm64 himalaya-x64 -output himalaya-universal\n\n# Verify\nlipo -info himalaya-universal\n# Output: Architectures in the fat file: himalaya-universal are: x86_64 arm64\n</code></pre>"},{"location":"bundling-research/#size-comparison","title":"Size Comparison","text":"Binary Type Uncompressed Compressed (gzip) arm64 only 24 MB 9.0 MB x64 only 25 MB 9.3 MB Universal (fat) 49 MB 18.3 MB <p>Key Insight: Universal binary is ~49 MB (nearly double), but compressed is only 18.3 MB (not quite double due to compression overhead).</p>"},{"location":"bundling-research/#recommendation-platform-specific-vs-universal","title":"Recommendation: Platform-Specific vs Universal","text":"<p>Option A: Ship platform-specific binaries - Pros: Smaller download (9 MB vs 18 MB), faster extraction - Cons: Runtime architecture detection required, separate files to manage</p> <p>Option B: Ship universal binary - Pros: Single binary, simpler distribution, works on all Macs - Cons: ~2x size (18 MB compressed, 49 MB uncompressed)</p> <p>Recommended: Ship universal binary for simplicity. 18 MB is acceptable for one-click installation, and it eliminates runtime detection complexity.</p>"},{"location":"bundling-research/#3-macos-code-signing-gatekeeper","title":"3. macOS Code Signing &amp; Gatekeeper","text":""},{"location":"bundling-research/#gatekeeper-requirements","title":"Gatekeeper Requirements","text":"<p>macOS Gatekeeper enforces cryptographic signing requirements for downloaded binaries. [Source: Apple Codesign Documentation]</p>"},{"location":"bundling-research/#can-unsigned-binaries-run","title":"Can Unsigned Binaries Run?","text":"<p>Short answer: Yes, but with user friction.</p>"},{"location":"bundling-research/#unsigned-binary-behavior","title":"Unsigned Binary Behavior","text":"<ol> <li>First Launch: macOS kills the binary before it launches when run from Terminal</li> <li>User Override Required:</li> <li>Go to System Settings \u2192 Privacy &amp; Security</li> <li>Find \"Security\" section</li> <li>Click \"Open Anyway\" where message appears</li> <li>Enter admin credentials</li> <li>Subsequent Runs: Binary allowed after override</li> </ol> <p>[Source: So You Want to Code-Sign macOS Binaries?]</p>"},{"location":"bundling-research/#ad-hoc-signing","title":"Ad-Hoc Signing","text":"<ul> <li>What it is: \"Ad-hoc codesigning\" is essentially just a checksum of the executable</li> <li>Where it works: Only on the local machine that built it</li> <li>When copied: macOS will kill it before launch on other machines</li> <li>Not sufficient for distribution</li> </ul> <p>[Source: macOS distribution gist]</p>"},{"location":"bundling-research/#proper-distribution-path","title":"Proper Distribution Path","text":"<p>For frictionless distribution, binaries should be:</p> <ol> <li>Signed with a Developer ID certificate (requires Apple Developer account)</li> <li>Hardened (<code>codesign -o runtime</code>)</li> <li>Notarized via Apple's notarization service</li> </ol> <p>Gatekeeper allows execution only when all three conditions are met. [Source: DigiCert Code Signing Guide 2026]</p>"},{"location":"bundling-research/#implications-for-himalaya-mcp","title":"Implications for himalaya-mcp","text":"<p>Current State: himalaya binaries from GitHub releases are unsigned (community project, no Apple Developer certificate)</p> <p>Distribution Options:</p> <ol> <li>Bundle unsigned binary + document manual approval</li> <li>User must approve binary on first run (System Settings)</li> <li>Document in setup guide with screenshots</li> <li> <p>Acceptable for power users / developers</p> </li> <li> <p>Don't bundle, require Homebrew install</p> </li> <li><code>brew install himalaya</code> handles binary installation</li> <li>Our .mcpb just wraps the CLI</li> <li>Cleaner separation of concerns</li> <li> <p>Current approach (documented in setup guide)</p> </li> <li> <p>Sign binaries ourselves (future)</p> </li> <li>Requires Apple Developer account ($99/year)</li> <li>Sign universal binary after creation</li> <li>Notarize via Apple</li> <li>Provides frictionless install experience</li> </ol> <p>Recommendation: Keep current approach (Homebrew install) for now. Add bundled unsigned binary as optional future enhancement with clear documentation.</p>"},{"location":"bundling-research/#4-size-analysis","title":"4. Size Analysis","text":""},{"location":"bundling-research/#component-breakdown","title":"Component Breakdown","text":"Component Size Notes himalaya binary (universal) 49 MB uncompressed, 18.3 MB gzip Rust binary with all features Node.js runtime (if bundled) ~67 KB (symlink) Not needed\u2014.mcpb uses system Node.js Our dist/index.js 2.3 KB esbuild bundle (minimal, imports only) MCP server code (with deps) ~595 KB Estimated from package.json dependencies"},{"location":"bundling-research/#mcpb-bundle-size-estimate","title":".mcpb Bundle Size Estimate","text":"<p>If bundling himalaya binary:</p> <pre><code>manifest.json:           ~2 KB\ndist/index.js:           ~3 KB\nnode_modules/: ~        500 KB (MCP SDK + deps)\nbin/himalaya-universal: ~49 MB (uncompressed)\n-----------------------------------\nTotal uncompressed:     ~50 MB\nTotal compressed (zip): ~19 MB (estimated)\n</code></pre> <p>Without bundling binary (current approach):</p> <pre><code>manifest.json:          ~2 KB\ndist/index.js:          ~3 KB\nnode_modules/:       ~500 KB\n-----------------------------------\nTotal uncompressed:    ~505 KB\nTotal compressed (zip): ~150 KB (estimated)\n</code></pre> <p>Recommendation: Start with no-bundle approach (~150 KB), add optional bundled variant later for advanced users.</p>"},{"location":"bundling-research/#5-runtime-architecture-detection-in-nodejs","title":"5. Runtime Architecture Detection in Node.js","text":""},{"location":"bundling-research/#using-processarch-and-processplatform","title":"Using <code>process.arch</code> and <code>process.platform</code>","text":"<p>Node.js provides built-in architecture detection:</p> <pre><code>console.log('Platform:', process.platform);    // \"darwin\" on macOS\nconsole.log('Architecture:', process.arch);    // \"arm64\" or \"x64\"\n\n// Example usage in binary selection\nconst binaryPath = process.arch === 'arm64'\n  ? path.join(__dirname, 'bin', 'himalaya-arm64')\n  : path.join(__dirname, 'bin', 'himalaya-x64');\n</code></pre>"},{"location":"bundling-research/#platform-detection-values","title":"Platform Detection Values","text":"Platform <code>process.platform</code> <code>process.arch</code> (Intel) <code>process.arch</code> (Apple Silicon) macOS <code>\"darwin\"</code> <code>\"x64\"</code> <code>\"arm64\"</code> Linux <code>\"linux\"</code> <code>\"x64\"</code> <code>\"arm64\"</code> Windows <code>\"win32\"</code> <code>\"x64\"</code> N/A"},{"location":"bundling-research/#implementation-pattern-for-platform-specific-binaries","title":"Implementation Pattern for Platform-Specific Binaries","text":"<pre><code>import { execFile } from 'node:child_process';\nimport { fileURLToPath } from 'node:url';\nimport path from 'node:path';\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\n\nfunction getHimalayaBinary() {\n  // Check system install first\n  if (process.env.HIMALAYA_BINARY) {\n    return process.env.HIMALAYA_BINARY;\n  }\n\n  // Check system PATH\n  const systemBinary = 'himalaya'; // Resolved via PATH\n\n  // Fallback to bundled binary (if present)\n  const platform = process.platform;\n  const arch = process.arch;\n\n  if (platform !== 'darwin') {\n    throw new Error('Bundled binaries only available for macOS');\n  }\n\n  // With universal binary:\n  return path.join(__dirname, '..', 'bin', 'himalaya-universal');\n\n  // With platform-specific binaries:\n  // const binaryName = arch === 'arm64' ? 'himalaya-arm64' : 'himalaya-x64';\n  // return path.join(__dirname, '..', 'bin', binaryName);\n}\n</code></pre>"},{"location":"bundling-research/#rosetta-2-considerations","title":"Rosetta 2 Considerations","text":"<ul> <li>x64 binaries run on Apple Silicon Macs via Rosetta 2</li> <li>arm64 binaries cannot run on Intel Macs</li> <li>Universal binaries automatically select correct architecture</li> <li>No runtime detection needed with universal binary</li> </ul>"},{"location":"bundling-research/#6-mcpb-bundle-format-specification","title":"6. MCPB Bundle Format Specification","text":""},{"location":"bundling-research/#overview","title":"Overview","text":"<p><code>.mcpb</code> files are simple ZIP archives containing an MCP server and metadata. Spiritually similar to Chrome extensions (.crx) or VS Code extensions (.vsix).</p> <p>[Source: Adopting the MCP Bundle format, MCPB GitHub]</p>"},{"location":"bundling-research/#required-structure","title":"Required Structure","text":"<pre><code>my-server.mcpb (ZIP archive)\n\u251c\u2500\u2500 manifest.json          # Required: metadata + server config\n\u251c\u2500\u2500 server/                # Server code (Node.js, Python, or binary)\n\u2502   \u2514\u2500\u2500 index.js\n\u251c\u2500\u2500 node_modules/          # Bundled dependencies (optional)\n\u2514\u2500\u2500 icon.png               # Optional: icon for UI\n</code></pre>"},{"location":"bundling-research/#manifestjson-schema","title":"manifest.json Schema","text":"<p>Required fields:</p> <pre><code>{\n  \"manifest_version\": \"0.3\",\n  \"name\": \"himalaya-mcp\",\n  \"version\": \"1.2.0\",\n  \"description\": \"Privacy-first email MCP server\",\n  \"author\": {\n    \"name\": \"Data-Wise\"\n  },\n  \"server\": {\n    \"type\": \"node\",\n    \"entry_point\": \"dist/index.js\",\n    \"mcp_config\": {\n      \"command\": \"node\",\n      \"args\": [\"${__dirname}/dist/index.js\"],\n      \"env\": {\n        \"HIMALAYA_BINARY\": \"himalaya\"  // Or bundled path\n      }\n    }\n  }\n}\n</code></pre> <p>Optional fields:</p> <ul> <li><code>display_name</code>: Human-readable name</li> <li><code>icon</code> / <code>icons</code>: PNG assets</li> <li><code>repository</code>, <code>homepage</code>, <code>documentation</code>: URLs</li> <li><code>tools</code>, <code>prompts</code>: Declared capabilities</li> <li><code>compatibility</code>: Platform/runtime requirements</li> <li><code>user_config</code>: Configurable parameters</li> </ul>"},{"location":"bundling-research/#bundling-binaries-in-mcpb","title":"Bundling Binaries in MCPB","text":"<p>The manifest spec supports bundling binaries via:</p> <ol> <li>Platform-specific paths:</li> </ol> <pre><code>{\n  \"server\": {\n    \"type\": \"node\",\n    \"mcp_config\": {\n      \"env\": {\n        \"HIMALAYA_BINARY\": \"${__dirname}/bin/himalaya-universal\"\n      }\n    }\n  }\n}\n</code></pre> <ol> <li>Compatibility constraints:</li> </ol> <pre><code>{\n  \"compatibility\": {\n    \"platforms\": [\"darwin\"],  // macOS only\n    \"runtimes\": {\n      \"node\": \"&gt;=18.0.0\"\n    }\n  }\n}\n</code></pre> <ol> <li> <p>Variable substitution:</p> </li> <li> <p><code>${__dirname}</code>: Bundle root directory</p> </li> <li><code>${user_config.KEY}</code>: User configuration values</li> <li><code>${HOME}</code>: User home directory</li> </ol>"},{"location":"bundling-research/#bundle-size-implications","title":"Bundle Size Implications","text":"Approach Bundle Size Distribution User Setup No binary ~150 KB One-click install Manual <code>brew install himalaya</code> Bundled universal ~19 MB Fully self-contained None (code signing friction) Bundled platform-specific ~9-10 MB Self-contained None (code signing friction)"},{"location":"bundling-research/#7-recommendations","title":"7. Recommendations","text":""},{"location":"bundling-research/#phase-1-current-approach-ship-now","title":"Phase 1: Current Approach (Ship Now)","text":"<p>Don't bundle himalaya binary.</p> <ul> <li>Keep <code>.mcpb</code> at ~150 KB</li> <li>Document Homebrew install: <code>brew install himalaya</code></li> <li>Use <code>HIMALAYA_BINARY</code> env var for flexible binary location</li> <li>Why: Avoids code signing complexity, smaller download, separates concerns</li> </ul>"},{"location":"bundling-research/#phase-2-optional-bundled-variant-future","title":"Phase 2: Optional Bundled Variant (Future)","text":"<p>Offer bundled <code>.mcpb</code> as alternate download.</p> <ul> <li>Create <code>himalaya-mcp-bundled.mcpb</code> (~19 MB)</li> <li>Include universal binary (arm64 + x64)</li> <li>Document manual approval requirement (System Settings)</li> <li>Target: Power users who want zero-dependency install</li> <li>Why: Some users prefer self-contained bundles despite code signing friction</li> </ul>"},{"location":"bundling-research/#phase-3-signed-notarized-long-term","title":"Phase 3: Signed &amp; Notarized (Long-term)","text":"<p>Get Apple Developer certificate, sign binaries.</p> <ul> <li>Sign universal binary with Developer ID</li> <li>Notarize via Apple</li> <li>Frictionless install for all users</li> <li>Why: Best UX, but requires $99/year + notarization workflow</li> </ul>"},{"location":"bundling-research/#8-implementation-checklist","title":"8. Implementation Checklist","text":""},{"location":"bundling-research/#for-current-release-no-bundle","title":"For Current Release (No Bundle)","text":"<ul> <li>[x] Document <code>brew install himalaya</code> in setup guide</li> <li>[x] Use <code>HIMALAYA_BINARY</code> env var in config</li> <li>[x] Test with system-installed himalaya</li> <li>[ ] Add compatibility check to verify himalaya available</li> <li>[ ] Error message: \"himalaya not found, install via: brew install himalaya\"</li> </ul>"},{"location":"bundling-research/#for-future-bundled-variant","title":"For Future Bundled Variant","text":"<ul> <li>[ ] Download arm64 + x64 binaries from GitHub releases</li> <li>[ ] Create universal binary with <code>lipo -create</code></li> <li>[ ] Add <code>bin/himalaya-universal</code> to bundle</li> <li>[ ] Update manifest.json with bundled binary path</li> <li>[ ] Write documentation for manual approval (screenshots)</li> <li>[ ] Test on fresh macOS install (both Intel and Apple Silicon)</li> </ul>"},{"location":"bundling-research/#for-signed-variant-future","title":"For Signed Variant (Future)","text":"<ul> <li>[ ] Obtain Apple Developer account</li> <li>[ ] Generate Developer ID certificate</li> <li>[ ] Sign universal binary: <code>codesign -s \"Developer ID\" --options runtime bin/himalaya-universal</code></li> <li>[ ] Notarize via <code>xcrun notarytool</code></li> <li>[ ] Verify Gatekeeper acceptance</li> <li>[ ] Update distribution workflow</li> </ul>"},{"location":"bundling-research/#references","title":"References","text":"<ul> <li>himalaya releases</li> <li>Building a universal macOS binary</li> <li>A deep dive on macOS universal binaries</li> <li>So You Want to Code-Sign macOS Binaries?</li> <li>macOS distribution gist</li> <li>Apple Codesign Gatekeeper Primer</li> <li>MCPB Bundle Format</li> <li>MCPB GitHub</li> <li>Node.js Single Executable Applications</li> </ul> <p>Last Updated: 2026-02-16</p>"},{"location":"changelog/","title":"Changelog","text":"<p>All notable changes to this project will be documented in this file.</p> <p>Format follows Keep a Changelog.</p>"},{"location":"changelog/#unreleased","title":"[Unreleased]","text":""},{"location":"changelog/#140-2026-02-26","title":"[1.4.0] - 2026-02-26","text":""},{"location":"changelog/#added","title":"Added","text":"<ul> <li><code>/email:search</code> skill \u2014 Search emails by keyword, sender, flags, or date with himalaya filter syntax</li> <li><code>/email:manage</code> skill \u2014 Bulk email operations (flag, unflag, move, archive) with confirmation gate for &gt;5 emails</li> <li><code>/email:stats</code> skill \u2014 Inbox statistics: unread count, top senders, oldest unread, optional weekly trends</li> <li><code>/email:config</code> skill \u2014 Interactive setup wizard with provider templates (Gmail, Outlook, Fastmail), connection testing, and <code>--check</code> validation mode</li> <li>Pre-send confirmation hook \u2014 PreToolUse hook showing email preview (To, Subject, body snippet) before send/compose operations; logs to <code>~/.himalaya-mcp/sent.log</code></li> <li>Cookbook \u2014 Common email workflow patterns and recipes (<code>docs/guide/cookbook.md</code>)</li> </ul>"},{"location":"changelog/#changed","title":"Changed","text":"<ul> <li>Plugin description updated to reflect 11 skills + 1 hook</li> <li><code>/email:help</code> hub updated with new skills, hooks section, and quick reference entries</li> <li><code>plugin.json</code> now includes <code>hooks</code> registration for PreToolUse</li> </ul>"},{"location":"changelog/#fixed","title":"Fixed","text":"<ul> <li>Pre-send hook tests rewritten with HOME isolation (no audit log pollution)</li> <li>Cross-platform CI fix: use <code>fs.statSync().mode</code> instead of macOS-only <code>stat -f %Lp</code></li> <li>Removed dead <code>execFileSync</code> try/catch in hook tests (was running hook twice)</li> </ul>"},{"location":"changelog/#131-2026-02-25","title":"[1.3.1] - 2026-02-25","text":""},{"location":"changelog/#fixed_1","title":"Fixed","text":"<ul> <li>CI glob safety and timeout default handling</li> <li><code>doctor</code> test handles non-zero exit codes in CI environments</li> <li>Consistent plugin install command (<code>claude plugin install email</code>) across all docs</li> </ul>"},{"location":"changelog/#documentation","title":"Documentation","text":"<ul> <li>Quickstart: Tabbed multi-method install (Homebrew, GitHub Marketplace, Source) with <code>pymdownx.tabbed</code></li> <li>Installation: Prerequisites section, verification steps with <code>himalaya-mcp doctor</code> after each method</li> <li>README: Verification blocks and prerequisites for all install methods</li> <li>Troubleshooting: 3 new sections \u2014 skills nesting bug, MCP tools not available, plugin not found</li> <li>Packaging: Distribution architecture diagram (Mermaid), updated libexec layout paths</li> <li>Reference: Updated refcard with doctor verification, desktop-extension with .mcpb prerequisite admonition</li> </ul>"},{"location":"changelog/#130-2026-02-17","title":"[1.3.0] - 2026-02-17","text":""},{"location":"changelog/#added_1","title":"Added","text":"<ul> <li><code>.mcpb</code> Desktop Extension packaging for Claude Desktop/Cowork (manifest, build script, CI workflows)</li> <li><code>install-ext</code> / <code>remove-ext</code> CLI commands for local extension management</li> <li><code>doctor</code> diagnostic command with <code>--fix</code> and <code>--json</code> flags (checks 6 layers: prereqs, MCP server, email, Desktop extension, Code plugin, env)</li> <li>Desktop Extension tutorial, troubleshooting guide, and <code>.mcpb</code> format reference docs</li> <li>39 new tests (314 total): .mcpb packaging validation, doctor E2E, config template guards</li> </ul>"},{"location":"changelog/#fixed_2","title":"Fixed","text":"<ul> <li>himalaya v1.1.0 argument ordering (<code>--account</code>/<code>--output</code> flags now placed after subcommand)</li> <li>Unresolved <code>${user_config.*}</code> template variables from Desktop Extension config (config loader ignores <code>${</code> prefixed values)</li> <li>PATH environment variable included in <code>.mcpb</code> manifest for Claude Desktop compatibility</li> </ul>"},{"location":"changelog/#changed_1","title":"Changed","text":"<ul> <li>Default timeout changed from 30s to 120s (was briefly set to unlimited in v1.3.0; now 2 min for safety, set <code>HIMALAYA_TIMEOUT=0</code> for unlimited)</li> </ul>"},{"location":"changelog/#documentation_1","title":"Documentation","text":"<ul> <li>Quickstart: Tabbed multi-method install (Homebrew, GitHub Marketplace, Source)</li> <li>Installation: Prerequisites, verification steps, <code>himalaya-mcp doctor</code> after each method</li> <li>README: Verification blocks and prerequisites for all install methods</li> <li>Troubleshooting: New sections for skills nesting, MCP tools missing, symlink verification</li> <li>Packaging: Distribution architecture diagram (Mermaid), updated libexec layout</li> <li>Reference: Updated refcard with doctor verification</li> </ul>"},{"location":"changelog/#122-2026-02-16","title":"[1.2.2] - 2026-02-16","text":""},{"location":"changelog/#fixed_3","title":"Fixed","text":"<ul> <li>Setup CLI resolves MCP server path dynamically instead of hardcoding (works across install methods)</li> </ul>"},{"location":"changelog/#added_2","title":"Added","text":"<ul> <li>Install/upgrade E2E tests and CLI test suites (275 total tests across 15 files)</li> </ul>"},{"location":"changelog/#121-2026-02-16","title":"[1.2.1] - 2026-02-16","text":""},{"location":"changelog/#changed_2","title":"Changed","text":"<ul> <li>Plugin namespace renamed from <code>himalaya-mcp</code> to <code>email</code> \u2014 skills are now <code>/email:inbox</code>, <code>/email:triage</code>, etc. (5-char prefix instead of 13)</li> <li>Updated all documentation, tests, and marketplace manifest to reflect new namespace</li> <li>MCP server name, npm package, Homebrew formula, and GitHub repo remain <code>himalaya-mcp</code></li> </ul>"},{"location":"changelog/#120-2026-02-15","title":"[1.2.0] - 2026-02-15","text":""},{"location":"changelog/#added_3","title":"Added","text":"<ul> <li>Folder management (3 tools): <code>list_folders</code>, <code>create_folder</code>, <code>delete_folder</code> (with safety gate)</li> <li>Compose new emails: <code>compose_email</code> tool with two-phase safety gate (preview then confirm)</li> <li>Attachments (2 tools): <code>list_attachments</code> (with body part filtering and MIME inference), <code>download_attachment</code></li> <li>Calendar integration (2 tools): <code>extract_calendar_event</code> (ICS parser), <code>create_calendar_event</code> (Apple Calendar via AppleScript, with safety gate)</li> <li>Plugin skills: <code>/email:compose</code> (new email composition), <code>/email:attachments</code> (list, download, calendar invites)</li> <li>91 dogfood tests covering v1.2.0 tools (folders, compose, attachments, calendar)</li> <li>32 E2E tests (up from 22) \u2014 fake himalaya binary now creates real files on disk for attachment pipeline testing</li> <li>256 total tests across 15 test files</li> </ul>"},{"location":"changelog/#documentation_2","title":"Documentation","text":"<ul> <li>Full command reference for all 8 new tools with parameters, examples, and safety flows</li> <li>New tutorials: Compose &amp; Send Email, Attachments &amp; Calendar</li> <li>Updated workflows: compose, attachment download, calendar invite, folder management patterns</li> <li>Updated refcard, guide, and help skill with all 19 tools</li> <li>CHANGELOG v1.2.0 entry</li> </ul>"},{"location":"changelog/#111-2026-02-14","title":"[1.1.1] - 2026-02-14","text":""},{"location":"changelog/#added_4","title":"Added","text":"<ul> <li>Automated Homebrew formula update workflow (<code>homebrew-release.yml</code>)</li> <li>Triggers on GitHub release publish or manual <code>workflow_dispatch</code></li> <li>3-stage pipeline: validate (build/test/bundle + version check) \u2192 prepare (tarball SHA256 with retry) \u2192 update-homebrew (reusable workflow)</li> <li>Injection-safe: all GitHub context expressions use <code>env:</code> indirection</li> </ul>"},{"location":"changelog/#fixed_4","title":"Fixed","text":"<ul> <li>Hardened homebrew-release tarball download: <code>mktemp</code> for temp files, <code>--max-time 30</code> on curl, <code>sha256sum</code> (native on Ubuntu runners)</li> <li>Setup E2E tests skip gracefully when <code>dist/</code> not built (<code>describe.skipIf</code>)</li> <li>Setup E2E tests actually run when build exists: use <code>accessSync</code> (unmocked) instead of <code>existsSync</code> (mocked by <code>vi.mock</code>), fixing <code>vi.mock</code> interference that silently skipped 4 tests</li> <li>marketplace.json source path <code>\"./\"</code> back to canonical <code>\".\"</code> (fixes dogfood test)</li> <li>Homebrew post-install script hangs when Claude Code is running: guard all JSON file writes (<code>marketplace.json</code>, <code>settings.json</code>) behind <code>pgrep</code> check, replaced slow <code>lsof</code> with <code>pgrep -x \"claude\"</code></li> <li>Homebrew reusable workflow cross-repo push auth: <code>persist-credentials: false</code> + <code>unset GITHUB_TOKEN</code> to prevent runner credential helper override</li> <li>Removed stale <code>lint</code> script referencing uninstalled eslint</li> </ul>"},{"location":"changelog/#documentation_3","title":"Documentation","text":"<ul> <li>Added Claude Desktop section to user guide: platform comparison table, setup command details, config file paths, usage examples</li> <li>Split tutorials into 6 individual pages with learning path diagram (#15)</li> <li>Level 1: Read First Email, Multi-Account</li> <li>Level 2: Triage Inbox, Reply to Email, Export &amp; Save</li> <li>Level 3: Automate with Agent</li> <li>Mermaid flowchart showing progression between levels</li> <li>Added tutorials cross-references to index, installation, quickstart, and commands pages</li> <li>Added test breakdown table to README (unit/integration/dogfood/E2E)</li> <li>Added \"See also\" cross-links in command reference to tutorials and workflows</li> </ul>"},{"location":"changelog/#110-2026-02-14","title":"[1.1.0] - 2026-02-14","text":""},{"location":"changelog/#added_5","title":"Added","text":"<ul> <li>Plugin packaging for Homebrew distribution (#10)</li> <li>esbuild bundle (583KB single-file, eliminates 72MB node_modules)</li> <li><code>himalaya-mcp setup</code> CLI for Claude Desktop config (macOS/Linux/Windows)</li> <li>Homebrew formula with auto-symlink and marketplace registration</li> <li><code>brew install data-wise/tap/himalaya-mcp</code> zero-config install</li> <li>GitHub marketplace install: <code>claude plugin marketplace add Data-Wise/himalaya-mcp</code></li> <li>18 setup CLI tests (unit + E2E with subprocess)</li> </ul>"},{"location":"changelog/#fixed_5","title":"Fixed","text":"<ul> <li>plugin.json schema cleaned for Claude Code strict validation</li> </ul>"},{"location":"changelog/#documentation_4","title":"Documentation","text":"<ul> <li>Tutorials, skills guide, troubleshooting pages (#7)</li> <li>Packaging guide with esbuild bundle and Homebrew formula details</li> <li>CLI setup command reference with cross-platform config paths</li> <li>Git workflow and branch protection rules</li> <li>Full README rewrite with all install paths and GitHub Pages links</li> <li>Updated install commands across all docs (refcard, architecture, index)</li> </ul>"},{"location":"changelog/#100-2026-02-13","title":"[1.0.0] - 2026-02-13","text":""},{"location":"changelog/#added_6","title":"Added","text":"<ul> <li>11 MCP tools: list_emails, search_emails, read_email, read_email_html, flag_email, move_email, draft_reply, send_email, export_to_markdown, create_action_item, copy_to_clipboard</li> <li>4 MCP prompts: triage_inbox, summarize_email, daily_email_digest, draft_reply</li> <li>3 MCP resources: email://inbox, email://message/{id}, email://folders</li> <li>5 plugin skills: /email:inbox, /email:triage, /email:digest, /email:reply, /email:help</li> <li>Email assistant agent</li> <li>Two-phase send safety gate (preview then confirm)</li> <li>Multi-account support via <code>account</code> parameter</li> <li>Env-based configuration (HIMALAYA_BINARY, HIMALAYA_ACCOUNT, HIMALAYA_FOLDER, HIMALAYA_TIMEOUT)</li> <li>copy_to_clipboard adapter (pbcopy/xclip)</li> <li>GitHub Pages documentation site</li> <li>142 tests across 10 test files (unit, dogfooding, E2E)</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"Requirement Version Install Claude Code latest claude.ai/download or <code>brew install claude</code> Node.js 22+ nodejs.org or <code>brew install node</code> himalaya CLI latest <code>brew install himalaya</code> Email account -- Configured in <code>~/.config/himalaya/config.toml</code> <p>Homebrew installs deps for you</p> <p>If you use the Homebrew install method, Node.js and himalaya CLI are installed automatically as dependencies. You only need to have an email account configured.</p>"},{"location":"getting-started/installation/#verify-himalaya-works","title":"Verify himalaya works","text":"<pre><code>himalaya --output json envelope list\n</code></pre> <p>This should print JSON envelopes from your default account. If it fails, check the himalaya docs for account setup.</p>"},{"location":"getting-started/installation/#install-methods","title":"Install Methods","text":""},{"location":"getting-started/installation/#option-1-homebrew-recommended","title":"Option 1: Homebrew (recommended)","text":"<p>Zero-config install. Homebrew handles dependencies, bundling, plugin registration, and auto-enabling.</p> <pre><code>brew tap data-wise/tap\nbrew install himalaya-mcp\n</code></pre> <p>What happens automatically:</p> <ol> <li>Installs himalaya CLI + Node.js as dependencies</li> <li>Builds the esbuild bundle (583KB, no node_modules shipped)</li> <li>Symlinks plugin to <code>~/.claude/plugins/himalaya-mcp</code></li> <li>Registers in local marketplace</li> <li>Auto-runs install script (enables in Claude Code settings if Claude not running)</li> </ol> <p>Restart Claude Code. The <code>email</code> plugin gives you:</p> <ul> <li><code>/email:inbox</code> -- list recent emails</li> <li><code>/email:triage</code> -- classify and organize</li> <li><code>/email:digest</code> -- daily priority digest</li> <li><code>/email:reply</code> -- draft with safety gate</li> <li><code>/email:compose</code> -- compose new emails</li> <li><code>/email:attachments</code> -- list, download, calendar invites</li> <li><code>/email:help</code> -- help hub</li> </ul> <p>Verify:</p> <pre><code>himalaya-mcp doctor\n</code></pre> <p>Upgrade:</p> <pre><code>brew upgrade himalaya-mcp\n</code></pre> <p>Uninstall (cleans up symlinks and marketplace entry):</p> <pre><code>brew uninstall himalaya-mcp\n</code></pre>"},{"location":"getting-started/installation/#option-2-github-plugin-install","title":"Option 2: GitHub Plugin Install","text":"<p>Prerequisites</p> <p>Node.js 22+ and himalaya CLI must be installed separately before using the GitHub marketplace method. Run <code>brew install node himalaya</code> first.</p> <pre><code>claude plugin marketplace add Data-Wise/himalaya-mcp\nclaude plugin install email\n</code></pre> <p>Verify:</p> <pre><code>himalaya-mcp doctor\n</code></pre>"},{"location":"getting-started/installation/#option-3-from-source-development","title":"Option 3: From Source (development)","text":"<pre><code>git clone https://github.com/Data-Wise/himalaya-mcp.git\ncd himalaya-mcp\nnpm install\nnpm run build\nln -s $(pwd) ~/.claude/plugins/himalaya-mcp\n</code></pre> <p>Verify:</p> <pre><code>himalaya-mcp doctor\n</code></pre>"},{"location":"getting-started/installation/#option-4-standalone-mcp-server","title":"Option 4: Standalone MCP Server","text":"<p>Add to your Claude Code settings (<code>~/.claude/settings.json</code>):</p> <pre><code>{\n  \"mcpServers\": {\n    \"himalaya\": {\n      \"command\": \"node\",\n      \"args\": [\"/path/to/himalaya-mcp/dist/index.js\"]\n    }\n  }\n}\n</code></pre>"},{"location":"getting-started/installation/#claude-desktop-setup","title":"Claude Desktop Setup","text":""},{"location":"getting-started/installation/#option-a-mcpb-package-one-click","title":"Option A: .mcpb Package (one-click)","text":"<p>Download <code>himalaya-mcp-v{version}.mcpb</code> from GitHub Releases and double-click to install in Claude Desktop. The <code>.mcpb</code> is a lightweight (~147 KB) package that bundles the MCP server and configures it automatically.</p> <p>Prerequisites</p> <p>The <code>.mcpb</code> package does not bundle the himalaya CLI. You must install it separately:</p> <pre><code>brew install himalaya\n</code></pre> <p>During install, you can configure:</p> <ul> <li>himalaya binary path -- path to himalaya binary (default: <code>himalaya</code>)</li> <li>Default account -- email account name (default: system default)</li> <li>Default folder -- folder for operations (default: <code>INBOX</code>)</li> </ul>"},{"location":"getting-started/installation/#option-a2-mcpb-via-cli","title":"Option A2: .mcpb via CLI","text":"<p>If you have himalaya-mcp installed (Homebrew or source), you can install the extension from the command line:</p> <pre><code>npm run build:mcpb                                     # Build .mcpb (dev only)\nhimalaya-mcp install-ext himalaya-mcp-v1.4.0.mcpb      # Install from file\nhimalaya-mcp install-ext                                # Auto-find in project root\nhimalaya-mcp remove-ext                                 # Uninstall extension\n</code></pre> <p>This unpacks the extension to Claude Desktop's extensions directory and registers it. Restart Claude Desktop after install.</p>"},{"location":"getting-started/installation/#option-b-cli-setup-legacy","title":"Option B: CLI Setup (Legacy)","text":"<p>After installing himalaya-mcp via Homebrew or from source, configure it as an MCP server for Claude Desktop:</p> <pre><code>himalaya-mcp setup           # Add to Claude Desktop config\nhimalaya-mcp setup --check   # Verify configuration\nhimalaya-mcp setup --remove  # Remove server entry\n</code></pre> <p>This adds the server to <code>~/Library/Application Support/Claude/claude_desktop_config.json</code>. Restart Claude Desktop after running setup.</p> <p>Manual configuration (if you prefer):</p> <pre><code>{\n  \"mcpServers\": {\n    \"himalaya\": {\n      \"command\": \"node\",\n      \"args\": [\"~/.claude/plugins/himalaya-mcp/dist/index.js\"]\n    }\n  }\n}\n</code></pre>"},{"location":"getting-started/installation/#configuration","title":"Configuration","text":"<p>All optional. Set via environment variables in your MCP server config:</p> Variable Default Description <code>HIMALAYA_BINARY</code> <code>himalaya</code> Path to himalaya binary <code>HIMALAYA_ACCOUNT</code> (system default) Default email account name <code>HIMALAYA_FOLDER</code> <code>INBOX</code> Default folder for operations <code>HIMALAYA_TIMEOUT</code> <code>120000</code> (2 min) Command timeout in milliseconds (0 = unlimited)"},{"location":"getting-started/installation/#example-with-env-vars","title":"Example with env vars","text":"<pre><code>{\n  \"mcpServers\": {\n    \"himalaya\": {\n      \"command\": \"node\",\n      \"args\": [\"/path/to/himalaya-mcp/dist/index.js\"],\n      \"env\": {\n        \"HIMALAYA_ACCOUNT\": \"work\",\n        \"HIMALAYA_TIMEOUT\": \"60000\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<pre><code># Full diagnostic (checks prereqs, MCP server, email, Desktop extension, plugin)\nhimalaya-mcp doctor\n\n# Auto-fix common issues\nhimalaya-mcp doctor --fix\n\n# Run tests (335 tests)\nnpm test\n\n# Check Claude Desktop config (legacy)\nhimalaya-mcp setup --check\n</code></pre>"},{"location":"getting-started/installation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/installation/#homebrew-install-hangs-during-post-install","title":"Homebrew install hangs during post-install","text":"<p>If <code>brew install</code> or <code>brew upgrade</code> takes a very long time, Claude Code may be holding file locks. Kill the stuck process and complete manually:</p> <pre><code># If brew hangs, press Ctrl+C then:\nclaude plugin install email@local-plugins\n</code></pre> <p>This is fixed in the latest formula -- JSON file writes are skipped when Claude is running.</p>"},{"location":"getting-started/installation/#homebrew-install-fails-on-symlink","title":"Homebrew install fails on symlink","text":"<p>If macOS permissions prevent automatic symlinking:</p> <pre><code>ln -sf $(brew --prefix)/opt/himalaya-mcp/libexec ~/.claude/plugins/himalaya-mcp\n</code></pre>"},{"location":"getting-started/installation/#plugin-not-loading-after-install","title":"Plugin not loading after install","text":"<ol> <li>Restart Claude Code</li> <li>Check if plugin is enabled: <code>claude plugin list</code></li> <li>Manually enable: <code>claude plugin install email@local-plugins</code></li> </ol>"},{"location":"getting-started/installation/#skills-not-loading-homebrew-install","title":"Skills not loading (Homebrew install)","text":"<p>If <code>/email:*</code> skills don't appear after Homebrew install:</p> <ol> <li>Check skills path: <code>ls ~/.claude/plugins/himalaya-mcp/skills/</code></li> <li>If missing, upgrade: <code>brew upgrade himalaya-mcp</code></li> <li>If still broken: <code>ln -sf $(brew --prefix)/opt/himalaya-mcp/libexec ~/.claude/plugins/himalaya-mcp</code></li> </ol>"},{"location":"getting-started/installation/#mcp-server-not-starting","title":"MCP server not starting","text":"<p>Verify the bundled server works:</p> <pre><code>echo '{}' | node ~/.claude/plugins/himalaya-mcp/dist/index.js\n</code></pre> <p>If you see a JSON-RPC response, the server is working. Check your MCP configuration paths.</p>"},{"location":"getting-started/installation/#desktop-extension-not-working","title":"Desktop Extension not working","text":"<p>Run the doctor command to diagnose:</p> <pre><code>himalaya-mcp doctor\n</code></pre> <p>Common issues it catches: - himalaya binary not found (PATH not inherited by Desktop) - Unresolved <code>${user_config.*}</code> template variables - Missing extension registry or settings files</p> <p>Use <code>--fix</code> to auto-resolve what it can, or see the Troubleshooting Guide for manual fixes.</p>"},{"location":"getting-started/installation/#whats-next","title":"What's Next?","text":"<p>Ready to use himalaya-mcp? Start with the Tutorials -- read your first email in 2 minutes, then work up to full inbox automation.</p>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>Get from zero to reading email in 2 minutes.</p>"},{"location":"getting-started/quickstart/#1-install","title":"1. Install","text":"Homebrew (recommended)GitHub MarketplaceFrom Source <pre><code>brew tap data-wise/tap\nbrew install himalaya-mcp\n</code></pre> <p>Zero config. Installs deps, builds, symlinks, auto-enables.</p> <p>Requires <code>brew install node himalaya</code> separately.</p> <pre><code>claude plugin marketplace add Data-Wise/himalaya-mcp\nclaude plugin install email\n</code></pre> <pre><code>brew install himalaya\ngit clone https://github.com/Data-Wise/himalaya-mcp.git\ncd himalaya-mcp &amp;&amp; npm install &amp;&amp; npm run build\nln -s $(pwd) ~/.claude/plugins/himalaya-mcp\n</code></pre> <p>Restart Claude Code after install.</p>"},{"location":"getting-started/quickstart/#2-verify","title":"2. Verify","text":"<pre><code>himalaya-mcp doctor    # Check all settings\n</code></pre>"},{"location":"getting-started/quickstart/#3-try-it","title":"3. Try It","text":"<pre><code>You: \"Check my inbox\"\n</code></pre> <p>Claude calls <code>list_emails</code> and shows your recent emails:</p> <pre><code>Found 5 emails in INBOX:\n\n| ID     | From              | Subject                  | Date       | Flags |\n|--------|-------------------|--------------------------|------------|-------|\n| 249088 | alice@work.com    | Q1 Budget Review         | 2026-02-13 | Seen  |\n| 249064 | bob@team.com      | Sprint Retrospective     | 2026-02-13 |       |\n| 249051 | boss@work.com     | Meeting Tomorrow         | 2026-02-12 | Seen  |\n| 249030 | news@devweekly.io | This Week in TypeScript   | 2026-02-12 | Seen  |\n| 249015 | hr@company.com    | Benefits Enrollment      | 2026-02-11 |       |\n</code></pre>"},{"location":"getting-started/quickstart/#4-common-commands","title":"4. Common Commands","text":"What you say What happens \"Check my inbox\" Lists recent emails \"Read email 249088\" Shows full email body \"Triage my inbox\" Classifies emails, suggests actions \"Reply to 249088\" Drafts reply, shows for approval \"Give me today's digest\" Priority-grouped summary \"Export 249088 as markdown\" Email with YAML frontmatter \"Flag 249088 as important\" Adds Flagged flag \"Archive email 249064\" Moves to Archive folder"},{"location":"getting-started/quickstart/#5-safety","title":"5. Safety","text":"<ul> <li>Claude never sends email without your explicit \"yes\" / \"send it\"</li> <li><code>send_email</code> shows a preview first -- you approve before it sends</li> <li>No emails are ever deleted -- only flagged or moved</li> </ul>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>Tutorials -- step-by-step from beginner to automation</li> <li>User Guide -- all 19 tools, 4 prompts, 3 resources</li> <li>Workflows -- triage, reply, digest, export patterns</li> <li>Quick Reference -- one-page cheat sheet</li> </ul>"},{"location":"guide/cookbook/","title":"Email Cookbook","text":"<p>Practical recipes combining multiple skills and tools for common email scenarios.</p>"},{"location":"guide/cookbook/#recipe-1-monday-morning-routine","title":"Recipe 1: Monday Morning Routine","text":"<p>Start your week with a structured email review.</p> <pre><code>You: \"/email:stats\"\n\u2192 See unread count, volume, top senders\n\nYou: \"/email:triage\"\n\u2192 Classify inbox: actionable / FYI / skip\n\nYou: \"/email:manage archive\" (for skip emails)\n\u2192 Bulk archive low-priority items\n\nYou: \"/email:digest\"\n\u2192 Generate priority digest for the week\n</code></pre> <p>Why it works: Stats gives you the big picture before you dive in. Triage classifies efficiently. Manage clears the noise. Digest gives you a reference for the day.</p>"},{"location":"guide/cookbook/#recipe-2-inbox-zero-sprint","title":"Recipe 2: Inbox Zero Sprint","text":"<p>Aggressively clear your inbox to zero unread.</p> <pre><code>Step 1: \"/email:stats\"\n  \u2192 Know the scope: \"47 unread, oldest 12 days\"\n\nStep 2: \"/email:triage 50\"\n  \u2192 Classify all 50 emails at once\n\nStep 3: \"Archive all skip emails\"\n  \u2192 /email:manage archive [skip IDs]\n\nStep 4: \"Mark all FYI as read\"\n  \u2192 /email:manage flag [fyi IDs] (Seen)\n\nStep 5: \"Draft replies for actionable emails\"\n  \u2192 /email:reply for each actionable email\n\nStep 6: \"/email:stats\"\n  \u2192 Verify: \"0 unread\"\n</code></pre> <p>Time estimate: ~15 minutes for 50 emails with Claude doing the heavy lifting.</p>"},{"location":"guide/cookbook/#recipe-3-email-search-pipeline","title":"Recipe 3: Email Search Pipeline","text":"<p>Find, review, and act on specific emails.</p> <pre><code>You: \"/email:search from:client --unread\"\n\u2192 Find all unread client emails\n\nYou: \"Read #1\"\n\u2192 Review the most recent one\n\nYou: \"Summarize #2 and #3\"\n\u2192 Get quick summaries of the rest\n\nYou: \"/email:manage flag 1,2,3\"\n\u2192 Star them all for follow-up\n</code></pre> <p>Variations:</p> <ul> <li>By date: <code>/email:search from:boss after:2026-02-20</code></li> <li>By topic: <code>/email:search budget --flagged</code></li> <li>Unread only: <code>/email:search --unread</code></li> </ul>"},{"location":"guide/cookbook/#recipe-4-new-account-setup","title":"Recipe 4: New Account Setup","text":"<p>Set up himalaya from scratch using the config wizard.</p> <pre><code>You: \"/email:config\"\n\nClaude walks you through:\n1. Check himalaya installed\n2. Choose provider (Gmail/Outlook/Fastmail/Custom)\n3. Enter email address\n4. Generate config.toml with provider settings\n5. Store password in Keychain (Gmail: app password)\n6. Test IMAP/SMTP connection\n7. Run doctor check\n\nYou: \"/email:inbox\"\n\u2192 First email check with new account!\n</code></pre> <p>Adding a second account:</p> <pre><code>You: \"/email:config --add-account\"\n\u2192 Same wizard, appends to existing config\n\nYou: \"/email:inbox\" (uses default account)\nYou: \"Check my work inbox\" (uses account: \"work\")\n</code></pre>"},{"location":"guide/cookbook/#recipe-5-weekly-email-analytics","title":"Recipe 5: Weekly Email Analytics","text":"<p>Track your email patterns over time.</p> <pre><code>You: \"/email:stats --weekly\"\n\nWeekly Comparison\n           This week    Last week    Change\nReceived:  47           52           down 10%\nUnread:    12           8            up 50%\n\nYou: \"Who's sending me the most email?\"\n\u2192 Top senders breakdown\n\nYou: \"/email:search from:newsletter\"\n\u2192 Find all newsletters\n\nYou: \"/email:manage archive\" (newsletter IDs)\n\u2192 Clean up recurring noise\n</code></pre> <p>Insight: If unread is trending up, schedule a triage session. If a single sender dominates, consider filters.</p>"},{"location":"guide/cookbook/#recipe-6-meeting-preparation","title":"Recipe 6: Meeting Preparation","text":"<p>Gather all context before a meeting.</p> <pre><code>You: \"/email:search from:alice Q1 budget\"\n\u2192 Find all relevant threads\n\nYou: \"Summarize each of these\"\n\u2192 One-line summary per email\n\nYou: \"Extract action items from #1 and #3\"\n\u2192 Pull todos and deadlines\n\nYou: \"Export all as markdown and copy to clipboard\"\n\u2192 Ready to paste into meeting notes\n</code></pre>"},{"location":"guide/cookbook/#recipe-7-end-of-day-sweep-stats","title":"Recipe 7: End-of-Day Sweep + Stats","text":"<p>Quick cleanup before signing off.</p> <pre><code>You: \"/email:stats\"\n\u2192 See what came in today\n\nYou: \"Triage today's unread\"\n\u2192 Quick classification\n\nYou: \"/email:manage flag\" (tomorrow's priorities)\n\u2192 Star what needs attention tomorrow\n\nYou: \"/email:manage archive\" (handled items)\n\u2192 Clean up processed emails\n\nYou: \"/email:stats\"\n\u2192 Confirm inbox is under control\n</code></pre>"},{"location":"guide/cookbook/#recipe-8-delegation-and-forwarding","title":"Recipe 8: Delegation and Forwarding","text":"<p>Process emails that need someone else's attention.</p> <pre><code>You: \"/email:triage\"\n\u2192 Identify emails that need delegation\n\nYou: \"Draft a forward of #42 to bob@team.com with context\"\n\u2192 Claude composes a forwarding message\n\nYou: \"Extract the action items from #42\"\n\u2192 Create a todo list for the delegate\n\nYou: \"/email:manage move 42 Delegated\"\n\u2192 Move to a tracking folder\n</code></pre>"},{"location":"guide/cookbook/#skill-combination-cheat-sheet","title":"Skill Combination Cheat Sheet","text":"Goal Skills/Tools Flow Morning review stats \u2192 triage \u2192 manage \u2192 digest Big picture \u2192 classify \u2192 clean \u2192 reference Inbox zero stats \u2192 triage \u2192 manage \u2192 reply \u2192 stats Scope \u2192 classify \u2192 archive \u2192 reply \u2192 verify Find + act search \u2192 read \u2192 reply/manage Filter \u2192 review \u2192 respond New setup config \u2192 inbox \u2192 stats Configure \u2192 test \u2192 baseline Weekly review stats --weekly \u2192 search \u2192 manage Trends \u2192 find noise \u2192 clean up Meeting prep search \u2192 summarize \u2192 action items \u2192 export Find \u2192 understand \u2192 extract \u2192 notes End of day stats \u2192 triage \u2192 manage \u2192 stats Assess \u2192 classify \u2192 clean \u2192 verify"},{"location":"guide/guide/","title":"himalaya-mcp User Guide","text":"<p>Privacy-first email for Claude via the himalaya CLI.</p>"},{"location":"guide/guide/#how-it-works","title":"How It Works","text":"<p>himalaya-mcp wraps the himalaya CLI as a subprocess, exposing email operations as MCP tools, resources, and prompts. Claude never touches raw IMAP/SMTP -- all authentication stays local on your machine.</p> <pre><code>Claude &lt;\u2500\u2500MCP\u2500\u2500&gt; himalaya-mcp &lt;\u2500\u2500execFile\u2500\u2500&gt; himalaya CLI &lt;\u2500\u2500IMAP/SMTP\u2500\u2500&gt; Mail Server\n</code></pre> <p>Key design choices:</p> <ul> <li>Subprocess, not library -- wraps the CLI binary via <code>execFile</code> (no shell injection)</li> <li>Prompt-based AI -- Claude IS the AI; MCP prompts guide triage/summarization</li> <li>Two-phase send -- <code>send_email</code> returns a preview first; requires <code>confirm=true</code> to actually send</li> <li>Plugin-first -- ships as a Claude Code plugin; also works as standalone MCP server</li> </ul>"},{"location":"guide/guide/#claude-code-vs-claude-desktop","title":"Claude Code vs Claude Desktop","text":"<p>himalaya-mcp works with both Claude Code and Claude Desktop, but the experience differs:</p> Feature Claude Code Claude Desktop 19 MCP tools Yes Yes 4 MCP prompts Yes Yes 3 MCP resources Yes Yes <code>/email:*</code> slash commands Yes (11 skills) No Plugin hooks Yes (1 pre-send hook) No Email assistant agent Yes No Natural language (\"check my inbox\") Yes Yes Two-phase send safety gate Yes Yes Env var configuration Yes Yes <p>In Claude Code, the plugin system provides slash-command skills (<code>/email:inbox</code>, <code>/email:triage</code>, <code>/email:search</code>, <code>/email:manage</code>, <code>/email:stats</code>, <code>/email:config</code>, etc.) that orchestrate multi-step workflows, plus an autonomous email assistant agent and a pre-send confirmation hook. These are Claude Code-only features defined in the plugin manifest.</p> <p>In Claude Desktop, you get the full MCP server -- all 19 tools, 4 prompts, and 3 resources work identically. You interact using natural language instead of slash commands. Say \"check my inbox\" and Claude calls <code>list_emails</code> directly. The two-phase send safety gate works the same way.</p> <p>Which should I use?</p> <p>Use Claude Code if you want the structured skill workflows and the email assistant agent. Use Claude Desktop if you prefer the desktop UI or want email access alongside other MCP servers.</p>"},{"location":"guide/guide/#prerequisites","title":"Prerequisites","text":"<ol> <li>Node.js 22+</li> <li>himalaya CLI -- <code>brew install himalaya</code></li> <li>Configured email -- at least one account in <code>~/.config/himalaya/config.toml</code></li> </ol> <p>Verify himalaya works:</p> <pre><code>himalaya --output json envelope list     # Should print JSON envelopes\n</code></pre>"},{"location":"guide/guide/#installation","title":"Installation","text":""},{"location":"guide/guide/#homebrew-recommended","title":"Homebrew (recommended)","text":"<pre><code>brew tap data-wise/tap\nbrew install himalaya-mcp\n</code></pre> <p>Zero-config: installs dependencies, builds the bundle, symlinks the plugin, and auto-enables in Claude Code. See the detailed installation guide for all options.</p>"},{"location":"guide/guide/#from-source","title":"From Source","text":"<pre><code>git clone https://github.com/Data-Wise/himalaya-mcp.git\ncd himalaya-mcp\nnpm install &amp;&amp; npm run build\nln -s $(pwd) ~/.claude/plugins/himalaya-mcp\n</code></pre> <p>Restart Claude Code. The plugin provides <code>/email:inbox</code>, <code>/email:triage</code>, <code>/email:digest</code>, and <code>/email:reply</code> skills.</p>"},{"location":"guide/guide/#claude-desktop-mcpb","title":"Claude Desktop (.mcpb)","text":"<p>Download <code>himalaya-mcp-v{version}.mcpb</code> from GitHub Releases and double-click to install in Claude Desktop. The <code>.mcpb</code> package is lightweight (~150 KB) and configures the MCP server automatically.</p> <p>Prerequisites: himalaya CLI must be installed separately:</p> <pre><code>brew install himalaya\n</code></pre> <p>User-configurable fields (set during install):</p> Field Default Description himalaya binary path <code>himalaya</code> Path to himalaya binary (optional) Default account (system default) Email account name (optional) Default folder <code>INBOX</code> Folder for operations"},{"location":"guide/guide/#claude-desktop-cli-setup","title":"Claude Desktop (CLI setup)","text":"<p>Alternatively, if you installed himalaya-mcp via Homebrew or from source, run the setup command:</p> <pre><code>himalaya-mcp setup           # Add MCP server to Desktop config\nhimalaya-mcp setup --check   # Verify configuration is correct\nhimalaya-mcp setup --remove  # Remove the server entry\n</code></pre> <p>Restart Claude Desktop after running setup.</p>"},{"location":"guide/guide/#what-setup-does","title":"What <code>setup</code> does","text":"<p>The <code>setup</code> command writes a server entry into Claude Desktop's config file. It preserves all existing MCP servers -- only the <code>himalaya</code> entry is added or updated.</p> <p>Config file location (per platform):</p> Platform Path macOS <code>~/Library/Application Support/Claude/claude_desktop_config.json</code> Linux <code>~/.config/Claude/claude_desktop_config.json</code> Windows <code>%APPDATA%/Claude/claude_desktop_config.json</code> <p>What gets written:</p> <pre><code>{\n  \"mcpServers\": {\n    \"himalaya\": {\n      \"command\": \"node\",\n      \"args\": [\"~/.claude/plugins/himalaya-mcp/dist/index.js\"]\n    }\n  }\n}\n</code></pre> <p>Claude Desktop reads this on startup and spawns <code>node dist/index.js</code> as a subprocess. The MCP server communicates over stdin/stdout using JSON-RPC, exposing all 19 tools, 4 prompts, and 3 resources.</p>"},{"location":"guide/guide/#using-himalaya-mcp-in-claude-desktop","title":"Using himalaya-mcp in Claude Desktop","text":"<p>Once configured, just talk naturally:</p> <pre><code>You: \"Check my inbox\"\nYou: \"Triage my last 10 emails\"\nYou: \"Reply to the meeting email\"\nYou: \"Give me today's email digest\"\nYou: \"Find emails from Alice about the budget\"\nYou: \"Export email 42 as markdown\"\n</code></pre> <p>Claude sees the MCP tools and calls them automatically. There are no slash commands -- everything is natural language.</p>"},{"location":"guide/guide/#adding-env-vars-optional","title":"Adding env vars (optional)","text":"<p>To customize the server behavior, add environment variables to the config:</p> <pre><code>{\n  \"mcpServers\": {\n    \"himalaya\": {\n      \"command\": \"node\",\n      \"args\": [\"~/.claude/plugins/himalaya-mcp/dist/index.js\"],\n      \"env\": {\n        \"HIMALAYA_ACCOUNT\": \"work\",\n        \"HIMALAYA_TIMEOUT\": \"60000\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"guide/guide/#verifying-the-server-works","title":"Verifying the server works","text":"<p>Test the MCP server standalone:</p> <pre><code>echo '{}' | node ~/.claude/plugins/himalaya-mcp/dist/index.js\n</code></pre> <p>If you see a JSON-RPC response, the server is working. If Claude Desktop still can't connect, check the config path and restart Desktop.</p>"},{"location":"guide/guide/#configuration","title":"Configuration","text":"<p>All settings are optional. Set via environment variables in your MCP server config:</p> Variable Default Description <code>HIMALAYA_BINARY</code> <code>himalaya</code> Path to himalaya binary <code>HIMALAYA_ACCOUNT</code> (system default) Default email account name <code>HIMALAYA_FOLDER</code> <code>INBOX</code> Default folder for operations <code>HIMALAYA_TIMEOUT</code> <code>120000</code> (2 min) Command timeout in milliseconds (0 = unlimited) <p>Example with env vars:</p> <pre><code>{\n  \"mcpServers\": {\n    \"himalaya\": {\n      \"command\": \"node\",\n      \"args\": [\"/path/to/himalaya-mcp/dist/index.js\"],\n      \"env\": {\n        \"HIMALAYA_ACCOUNT\": \"work\",\n        \"HIMALAYA_TIMEOUT\": \"60000\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"guide/guide/#mcp-tools-19","title":"MCP Tools (19)","text":""},{"location":"guide/guide/#reading","title":"Reading","text":"Tool Description Key Parameters <code>list_emails</code> List envelopes in a folder <code>page_size</code>, <code>page</code>, <code>folder</code>, <code>account</code> <code>search_emails</code> Search by subject, from, body, etc. <code>query</code>, <code>folder</code>, <code>account</code> <code>read_email</code> Read plain text body <code>id</code>, <code>folder</code>, <code>account</code> <code>read_email_html</code> Read HTML body <code>id</code>, <code>folder</code>, <code>account</code>"},{"location":"guide/guide/#managing-folders","title":"Managing Folders","text":"Tool Description Key Parameters <code>list_folders</code> List all available folders <code>account</code> <code>create_folder</code> Create a new folder <code>name</code>, <code>account</code> <code>delete_folder</code> Delete an existing folder <code>name</code>, <code>account</code>"},{"location":"guide/guide/#managing-emails","title":"Managing Emails","text":"Tool Description Key Parameters <code>flag_email</code> Add/remove flags (Seen, Flagged, Answered, etc.) <code>id</code>, <code>flags</code>, <code>action</code> (\"add\"/\"remove\") <code>move_email</code> Move to another folder <code>id</code>, <code>target_folder</code>"},{"location":"guide/guide/#composing","title":"Composing","text":"Tool Description Key Parameters <code>compose_email</code> Compose a new email from scratch <code>to</code>, <code>subject</code>, <code>body</code>, <code>account</code> <code>draft_reply</code> Generate reply template (does NOT send) <code>id</code>, <code>body</code>, <code>reply_all</code> <code>send_email</code> Send with safety gate <code>template</code>, <code>confirm</code> (must be <code>true</code> to send)"},{"location":"guide/guide/#attachments","title":"Attachments","text":"Tool Description Key Parameters <code>list_attachments</code> List all attachments in an email <code>id</code>, <code>folder</code>, <code>account</code> <code>download_attachment</code> Download a specific attachment <code>id</code>, <code>attachment_name</code>, <code>folder</code>, <code>account</code>"},{"location":"guide/guide/#calendar","title":"Calendar","text":"Tool Description Key Parameters <code>extract_calendar_event</code> Extract calendar event details from email <code>id</code>, <code>folder</code>, <code>account</code> <code>create_calendar_event</code> Create calendar event from extracted data <code>event_data</code>"},{"location":"guide/guide/#exporting","title":"Exporting","text":"Tool Description Key Parameters <code>export_to_markdown</code> Email to markdown with YAML frontmatter <code>id</code>, <code>folder</code>, <code>account</code> <code>create_action_item</code> Extract todos, deadlines, commitments <code>id</code>, <code>folder</code>, <code>account</code> <code>copy_to_clipboard</code> Copy text to system clipboard <code>text</code>"},{"location":"guide/guide/#mcp-prompts-4","title":"MCP Prompts (4)","text":"<p>Prompts guide Claude's reasoning for email tasks. Use them via the MCP prompt interface or through the plugin skills.</p> Prompt Purpose Parameters <code>triage_inbox</code> Classify emails as actionable/FYI/skip, suggest flags and moves <code>count</code> (default: 10) <code>summarize_email</code> One-sentence summary + action items + priority <code>id</code>, <code>folder</code> <code>daily_email_digest</code> Markdown digest grouped by priority (action/FYI/low) (none) <code>draft_reply</code> Compose a reply with tone guidance and safety reminders <code>id</code>, <code>tone</code>, <code>instructions</code>"},{"location":"guide/guide/#mcp-resources-3","title":"MCP Resources (3)","text":"<p>Resources provide browsable email data without requiring tool calls.</p> Resource URI Returns Inbox listing <code>email://inbox</code> Recent envelopes with sender, subject, date Message by ID <code>email://message/{id}</code> Full plain text body Folder list <code>email://folders</code> All available folders"},{"location":"guide/guide/#multi-account-support","title":"Multi-Account Support","text":"<p>Every tool accepts an optional <code>account</code> parameter matching a himalaya account name from your config. Set a default with <code>HIMALAYA_ACCOUNT</code> env var, then override per-call:</p> <pre><code>\"List emails from my work account\"    -&gt; list_emails(account: \"work\")\n\"Search personal for receipts\"        -&gt; search_emails(query: \"receipts\", account: \"personal\")\n</code></pre>"},{"location":"guide/guide/#safety-model","title":"Safety Model","text":"<p>himalaya-mcp is designed so Claude cannot accidentally send email:</p> <ol> <li><code>draft_reply</code> generates a template but never sends</li> <li><code>send_email</code> without <code>confirm=true</code> returns a preview only</li> <li><code>send_email</code> with <code>confirm=true</code> is the only path to actually send</li> <li>Plugin skills enforce showing the draft and waiting for explicit user approval</li> <li>The email-assistant agent is instructed to never send without confirmation</li> </ol> <p>No emails are ever deleted -- only flagged or moved.</p>"},{"location":"guide/guide/#diagnostics","title":"Diagnostics","text":"<pre><code>himalaya-mcp doctor          # Check all settings across the full stack\nhimalaya-mcp doctor --fix    # Auto-fix common issues\nhimalaya-mcp doctor --json   # Machine-readable output\n</code></pre> <p>The <code>doctor</code> command checks prerequisites (Node.js, himalaya), MCP server health, email connectivity, Claude Desktop extension state, Claude Code plugin registration, and environment variables. See the Command Reference for full details.</p>"},{"location":"guide/guide/#testing","title":"Testing","text":"<pre><code>npm test    # 335 tests across 15 files (vitest)\n</code></pre> <p>Test breakdown:</p> File Tests What it covers <code>parser.test.ts</code> 13 JSON response parsing, formatEnvelope <code>client.test.ts</code> 12 Subprocess wrapper, argument building <code>manage.test.ts</code> 7 flag_email, move_email client methods <code>compose.test.ts</code> 9 draft_reply, send_email safety gate <code>compose-new.test.ts</code> 8 compose_email safety gate <code>folders.test.ts</code> 12 Folder tools (list, create, delete) <code>attachments.test.ts</code> 10 Attachment list/download with body part filtering <code>calendar.test.ts</code> 18 ICS parser + calendar event tools + escaping <code>actions.test.ts</code> 6 export_to_markdown formatting <code>prompts.test.ts</code> 15 All 4 prompts register and return correct text <code>config.test.ts</code> 7 Env var loading, template variable guards <code>clipboard.test.ts</code> 4 pbcopy/xclip adapter <code>dogfood.test.ts</code> 122 Realistic Claude usage scenarios + packaging validation <code>e2e.test.ts</code> 34 Full MCP server pipeline + .mcpb build pipeline <code>setup.test.ts</code> 36 CLI setup/check/remove, install/upgrade E2E, doctor command"},{"location":"guide/packaging/","title":"Plugin Packaging &amp; Distribution","text":"<p>himalaya-mcp is distributed via multiple channels targeting both Claude Code and Claude Desktop. This guide covers the packaging architecture, build process, and how each distribution method works.</p>"},{"location":"guide/packaging/#distribution-channels","title":"Distribution Channels","text":"Channel Command Target Auto-setup Homebrew (recommended) <code>brew install data-wise/tap/himalaya-mcp</code> Claude Code Symlink, marketplace, auto-enable GitHub Marketplace <code>claude plugin marketplace add Data-Wise/himalaya-mcp</code> Claude Code Plugin cache .mcpb Extension Download from Releases Claude Desktop One-click install, GUI settings Source <code>git clone</code> + <code>npm run build</code> Both Manual symlink"},{"location":"guide/packaging/#distribution-architecture","title":"Distribution Architecture","text":"<pre><code>flowchart TD\n    SRC[\"`**Source**\n    16 TypeScript files\n    + MCP SDK + zod`\"] --&gt;|esbuild| BUNDLE[\"`**dist/index.js**\n    583KB single file`\"]\n\n    BUNDLE --&gt; HB[\"`**Homebrew**\n    brew install himalaya-mcp`\"]\n    BUNDLE --&gt; MCPB[\"`**.mcpb Extension**\n    ~147KB ZIP archive`\"]\n    BUNDLE --&gt; GH[\"`**GitHub Marketplace**\n    claude plugin marketplace add`\"]\n    BUNDLE --&gt; DEV[\"`**Source Install**\n    git clone + npm run build`\"]\n\n    HB --&gt; CC1[Claude Code]\n    GH --&gt; CC2[Claude Code]\n    DEV --&gt; CC3[Claude Code]\n    MCPB --&gt; CD[Claude Desktop]\n    DEV --&gt; CD2[Claude Desktop]</code></pre>"},{"location":"guide/packaging/#esbuild-bundle","title":"esbuild Bundle","text":"<p>The MCP server is bundled into a single file using esbuild, eliminating the 72MB <code>node_modules</code> directory.</p>"},{"location":"guide/packaging/#how-it-works","title":"How it works","text":"<pre><code>npm run build:bundle\n# Equivalent to:\n# esbuild src/index.ts --bundle --platform=node --target=node22 \\\n#   --outfile=dist/index.js --format=esm --minify\n</code></pre> <p>Input: 16 TypeScript source files + <code>@modelcontextprotocol/sdk</code> dependency</p> <p>Output: Single <code>dist/index.js</code> (583KB minified)</p> <p>The bundle includes all dependencies (MCP SDK, zod) inlined. No runtime <code>node_modules</code> needed -- just <code>node dist/index.js</code>.</p>"},{"location":"guide/packaging/#why-esbuild","title":"Why esbuild","text":"<ul> <li>72MB to 583KB -- node_modules eliminated entirely</li> <li>Zero runtime deps -- single file ships in Homebrew formula</li> <li>Fast -- builds in ~25ms</li> <li>ESM compatible -- handles zod/v4 import maps and MCP SDK subpath exports</li> </ul>"},{"location":"guide/packaging/#build-scripts","title":"Build scripts","text":"Script Purpose Output <code>npm run build</code> TypeScript compilation (development) <code>dist/*.js</code> + <code>.d.ts</code> + sourcemaps <code>npm run build:bundle</code> esbuild single-file (production) <code>dist/index.js</code> (583KB)"},{"location":"guide/packaging/#homebrew-formula","title":"Homebrew Formula","text":"<p>The formula lives in the homebrew-tap repository at <code>Formula/himalaya-mcp.rb</code>.</p>"},{"location":"guide/packaging/#what-brew-install-does","title":"What <code>brew install</code> does","text":"<ol> <li>Downloads the release tarball from GitHub</li> <li>Installs dependencies -- <code>himalaya</code> (email CLI) + <code>node</code> (runtime)</li> <li>Builds -- runs <code>npm install</code> then <code>npm run build:bundle</code></li> <li>Installs to libexec -- <code>.claude-plugin/</code>, <code>.mcp.json</code>, <code>skills/</code>, <code>agents/</code>, <code>dist/</code></li> <li>Runs post-install -- auto-runs install script (symlink, marketplace registration, auto-enable)</li> </ol>"},{"location":"guide/packaging/#post-install-script","title":"Post-install script","text":"<p>The <code>himalaya-mcp-install</code> script (created by the formula) auto-runs during <code>post_install</code>:</p> <ol> <li>Detects if Claude Code is running (<code>pgrep -x \"claude\"</code>)</li> <li>Symlinks <code>libexec</code> to <code>~/.claude/plugins/himalaya-mcp</code></li> <li>Registers in <code>~/.claude/local-marketplace/marketplace.json</code> (skipped if Claude is running)</li> <li>Auto-enables in <code>~/.claude/settings.json</code> (skipped if Claude is running)</li> <li>Uses stable <code>$(brew --prefix)/opt/himalaya-mcp/libexec</code> path (survives upgrades)</li> </ol> <p>All JSON file writes (<code>marketplace.json</code>, <code>settings.json</code>) are guarded behind the Claude detection check because <code>mv</code> blocks indefinitely on files locked by Claude Code. If Claude is running during install, run <code>claude plugin install email@local-plugins</code> manually afterward.</p>"},{"location":"guide/packaging/#uninstall","title":"Uninstall","text":"<p><code>brew uninstall himalaya-mcp</code> runs the <code>himalaya-mcp-uninstall</code> script which:</p> <ol> <li>Removes the plugin symlink</li> <li>Removes the marketplace.json entry</li> <li>Removes the marketplace symlink</li> </ol>"},{"location":"guide/packaging/#upgrade","title":"Upgrade","text":"<p><code>brew upgrade himalaya-mcp</code> preserves user configuration. The symlink always points to the stable opt path, so upgrades are seamless.</p>"},{"location":"guide/packaging/#release-automation","title":"Release Automation","text":"<p>When a GitHub release is published, the <code>homebrew-release.yml</code> workflow automatically updates the Homebrew formula.</p>"},{"location":"guide/packaging/#pipeline","title":"Pipeline","text":"<pre><code>GitHub Release (v1.2.0)\n  \u2502\n  \u251c\u2500 validate         Build + test + bundle, verify package.json matches tag\n  \u2502\n  \u251c\u2500 prepare          Download tarball, compute SHA256 (5 retries, 10s delay)\n  \u2502\n  \u2514\u2500 update-homebrew  Call reusable update-formula.yml \u2192 PR to homebrew-tap\n</code></pre>"},{"location":"guide/packaging/#how-it-works_1","title":"How it works","text":"<ol> <li>Trigger \u2014 publish a GitHub release (or manual <code>workflow_dispatch</code>)</li> <li>Validate \u2014 checks out the tag, runs <code>npm ci</code>, verifies <code>package.json</code> version matches the release tag, then builds, tests, and bundles</li> <li>Prepare \u2014 downloads the release tarball with retry logic (GitHub tarballs take seconds to materialize), computes SHA256</li> <li>Update \u2014 calls the reusable <code>Data-Wise/homebrew-tap/.github/workflows/update-formula.yml</code> workflow, which opens a PR to update <code>Formula/himalaya-mcp.rb</code> with the new version and SHA</li> </ol>"},{"location":"guide/packaging/#manual-trigger","title":"Manual trigger","text":"<p>For re-running or testing without creating a new release:</p> <pre><code>gh workflow run homebrew-release.yml \\\n  -f version=1.2.0 \\\n  -f auto_merge=true\n</code></pre>"},{"location":"guide/packaging/#required-secret","title":"Required secret","text":"<p><code>HOMEBREW_TAP_GITHUB_TOKEN</code> \u2014 a fine-grained PAT with Contents: Read and write permission for <code>Data-Wise/homebrew-tap</code>. Set via:</p> <pre><code>gh secret set HOMEBREW_TAP_GITHUB_TOKEN --repo Data-Wise/himalaya-mcp\n</code></pre>"},{"location":"guide/packaging/#cross-repo-authentication","title":"Cross-repo authentication","text":"<p>The reusable workflow uses <code>persist-credentials: false</code> on <code>actions/checkout</code> and <code>unset GITHUB_TOKEN</code> before pushing. This prevents the GitHub Actions runner's credential helper from intercepting the push with the caller workflow's token (which only has access to himalaya-mcp, not homebrew-tap). Authentication is handled via the PAT embedded in the git remote URL.</p>"},{"location":"guide/packaging/#marketplace-registration","title":"Marketplace Registration","text":"<p>The repository includes <code>.claude-plugin/marketplace.json</code> for GitHub-based plugin discovery:</p> <pre><code>{\n  \"name\": \"himalaya-mcp-marketplace\",\n  \"owner\": { \"name\": \"Data-Wise\" },\n  \"plugins\": [{\n    \"name\": \"email\",\n    \"source\": \"./himalaya-mcp-plugin\",\n    \"description\": \"Privacy-first email MCP server wrapping himalaya CLI\",\n    \"category\": \"productivity\",\n    \"tags\": [\"email\", \"mcp\", \"himalaya\", \"privacy\"]\n  }]\n}\n</code></pre> <p>This enables the GitHub install flow:</p> <pre><code>claude plugin marketplace add Data-Wise/himalaya-mcp\nclaude plugin install email\n</code></pre>"},{"location":"guide/packaging/#mcpb-desktop-extension","title":".mcpb Desktop Extension","text":"<p>The <code>.mcpb</code> format packages the MCP server as a Claude Desktop Extension -- a lightweight ZIP archive (~147 KB) containing the esbuild bundle and a <code>manifest.json</code> descriptor.</p>"},{"location":"guide/packaging/#build","title":"Build","text":"<pre><code>npm run build:mcpb\n# Output: himalaya-mcp-v1.4.0.mcpb (147 KB)\n</code></pre> <p>This runs <code>scripts/build-mcpb.sh</code> which:</p> <ol> <li>Builds the esbuild bundle (<code>dist/index.js</code>)</li> <li>Copies the bundle to <code>mcpb/dist/</code></li> <li>Validates the manifest (<code>npx @anthropic-ai/mcpb validate mcpb/</code>)</li> <li>Packs the archive (<code>npx @anthropic-ai/mcpb pack mcpb/</code>)</li> <li>Renames to <code>himalaya-mcp-v{version}.mcpb</code></li> </ol>"},{"location":"guide/packaging/#install-gui","title":"Install (GUI)","text":"<p>Download <code>himalaya-mcp-v{version}.mcpb</code> from GitHub Releases and double-click to install in Claude Desktop.</p>"},{"location":"guide/packaging/#install-cli","title":"Install (CLI)","text":"<pre><code>himalaya-mcp install-ext himalaya-mcp-v1.4.0.mcpb   # Install from file\nhimalaya-mcp install-ext                              # Auto-find in project root\nhimalaya-mcp remove-ext                               # Uninstall\n</code></pre> <p>The CLI install unpacks to <code>~/Library/Application Support/Claude/Claude Extensions/himalaya-mcp/</code>, registers in <code>extensions-installations.json</code>, and creates a default settings file. Restart Claude Desktop after install.</p>"},{"location":"guide/packaging/#user-configuration","title":"User Configuration","text":"<p>During install (or via Settings &gt; Extensions in Claude Desktop), users can configure:</p> Setting Type Default Description Himalaya Binary file <code>himalaya</code> Path to himalaya CLI binary Default Account string (system default) Email account from himalaya config Default Folder string <code>INBOX</code> Default folder for operations"},{"location":"guide/packaging/#whats-in-the-mcpb","title":"What's in the .mcpb","text":"File Size Purpose <code>manifest.json</code> 6.3 KB Extension manifest (metadata, tools, prompts, config) <code>dist/index.js</code> 595 KB esbuild bundle (all deps inlined) <p>See also</p> <p>Desktop Extensions Reference for the full <code>.mcpb</code> format specification, manifest schema, and installation internals.</p>"},{"location":"guide/packaging/#claude-desktop-setup-cli-legacy","title":"Claude Desktop Setup CLI (Legacy)","text":"<p>The <code>himalaya-mcp</code> CLI provides a setup command for Claude Desktop users who prefer the legacy <code>mcpServers</code> approach:</p> <pre><code>himalaya-mcp setup           # Add MCP server to claude_desktop_config.json\nhimalaya-mcp setup --check   # Verify configuration exists and paths are valid\nhimalaya-mcp setup --remove  # Remove the server entry\n</code></pre> <p>Config path: <code>~/Library/Application Support/Claude/claude_desktop_config.json</code></p> <p>The setup command:</p> <ul> <li>Reads existing config (or creates a new one)</li> <li>Adds the <code>himalaya</code> MCP server entry</li> <li>Preserves all other existing servers</li> <li>Points to the plugin's <code>dist/index.js</code> via the standard plugin path</li> </ul> <p>Prefer .mcpb for new installations</p> <p>The <code>.mcpb</code> extension approach provides a GUI settings panel and automatic updates. Use <code>himalaya-mcp setup</code> only if you need manual control over the MCP server configuration.</p>"},{"location":"guide/packaging/#what-ships-in-each-channel","title":"What Ships in Each Channel","text":"Content Homebrew GitHub Source <code>dist/index.js</code> (bundle) Built during install Pre-built Built locally <code>.claude-plugin/plugin.json</code> Stripped to essentials Full Full <code>.claude-plugin/marketplace.json</code> In libexec In repo In repo <code>.mcp.json</code> In libexec In repo In repo <code>skills/*.md</code> At libexec root In repo In repo <code>agents/*.md</code> At libexec root In repo In repo <code>node_modules/</code> Not shipped Not shipped Local only <code>src/</code> Not shipped In repo In repo <code>tests/</code> Not shipped In repo In repo"},{"location":"guide/packaging/#version-management","title":"Version Management","text":"<p>Versions are synchronized across three files:</p> File Field Purpose <code>package.json</code> <code>version</code> npm package version <code>.claude-plugin/plugin.json</code> <code>version</code> Claude Code plugin version <code>src/index.ts</code> <code>VERSION</code> MCP server reported version <p>All three must match. The Homebrew formula URL references the GitHub release tag (e.g., <code>v1.1.0</code>). The <code>homebrew-release.yml</code> validate job enforces this \u2014 a mismatch between the release tag and <code>package.json</code> version will fail the workflow.</p>"},{"location":"guide/skills/","title":"Plugin Skills &amp; Agent","text":"<p>When installed as a Claude Code plugin, the email plugin provides 11 slash commands (skills), 1 autonomous agent, and 1 hook.</p>"},{"location":"guide/skills/#skills-vs-tools","title":"Skills vs Tools","text":"Layer What How to use Example Skills High-level workflows Say the command or natural language <code>/email:inbox</code> or \"check my inbox\" Tools Atomic operations Claude calls them automatically <code>list_emails(page_size: 10)</code> Prompts AI guidance templates Referenced by skills and tools <code>triage_inbox</code> prompt <p>Skills orchestrate multiple tools. When you say <code>/email:triage</code>, the skill instructs Claude to call <code>list_emails</code>, then <code>read_email</code> on each, then classify results.</p>"},{"location":"guide/skills/#emailinbox","title":"/email:inbox","text":"<p>Check your inbox and list recent emails.</p> <p>Triggers: \"check email\", \"inbox\", \"read email\", \"my emails\"</p> <p>What it does:</p> <ol> <li>Calls <code>list_emails</code> to fetch recent envelopes (default: last 10)</li> <li>Presents a summary table with sender, subject, date, and flags</li> <li>Offers to read, triage, or reply to specific emails</li> </ol> <p>Example:</p> <pre><code>You: /email:inbox\n\nClaude:\nFound 5 emails in INBOX:\n\n| ID     | From              | Subject              | Date       | Flags   |\n|--------|-------------------|----------------------|------------|---------|\n| 249088 | alice@work.com    | Q1 Budget Review     | 2026-02-13 | Seen    |\n| 249064 | bob@team.com      | Sprint Retro Notes   | 2026-02-13 |         |\n| 249051 | boss@work.com     | Meeting Tomorrow     | 2026-02-12 | Flagged |\n\nWould you like me to:\n- Read any of these emails?\n- Triage your inbox?\n- Reply to one?\n</code></pre> <p>Options:</p> <ul> <li>Specify a count: \"Check my last 20 emails\"</li> <li>Specify a folder: \"Check my Sent folder\"</li> <li>Specify an account: \"Check my work inbox\"</li> </ul>"},{"location":"guide/skills/#emailtriage","title":"/email:triage","text":"<p>AI-powered email classification. Reads each email and sorts into actionable categories.</p> <p>Triggers: \"triage email\", \"classify email\", \"sort email\", \"organize inbox\"</p> <p>What it does:</p> <ol> <li>Calls <code>list_emails</code> to fetch recent emails (configurable count)</li> <li>Reads each email with <code>read_email</code></li> <li>Classifies into Actionable / Informational / Skip</li> <li>Suggests specific actions (reply, flag, archive, etc.)</li> <li>Presents a decision table</li> <li>Waits for your approval before making any changes</li> </ol> <p>Example:</p> <pre><code>You: /email:triage\n\nClaude:\nTriaging last 10 emails...\n\n| ID     | From           | Subject              | Class        | Suggested Action     |\n|--------|----------------|----------------------|--------------|----------------------|\n| 249088 | alice@work.com | Q1 Budget Review     | Actionable   | Reply needed by Fri  |\n| 249064 | newsletter@... | Weekly Digest        | Skip         | Archive              |\n| 249051 | boss@work.com  | Meeting Tomorrow     | Actionable   | Flag + prepare       |\n| 249045 | hr@company.com | Benefits Update      | Informational| Mark read            |\n\nShall I:\n1. Flag the 2 actionable emails?\n2. Archive the newsletter?\n3. Mark the HR email as read?\n</code></pre> <p>Key behavior:</p> <ul> <li>Never acts without confirmation</li> <li>Groups similar actions (flag all actionable, archive all skippable)</li> <li>Provides reasoning for each classification</li> </ul>"},{"location":"guide/skills/#emaildigest","title":"/email:digest","text":"<p>Generate a daily priority digest in markdown format.</p> <p>Triggers: \"email digest\", \"daily digest\", \"email summary\", \"morning briefing\"</p> <p>What it does:</p> <ol> <li>Fetches today's emails (or configurable date range)</li> <li>Reads and analyzes each email</li> <li>Groups by priority: Requires Action / FYI / Low Priority</li> <li>Generates a markdown digest with one-line summaries</li> <li>Includes stats (total, action needed, FYI, low priority)</li> </ol> <p>Example output:</p> <pre><code># Email Digest -- 2026-02-13\n\n## Requires Action (2)\n- **Q1 Budget Review** from Alice -- needs approval by Friday\n- **Meeting Tomorrow** from Boss -- bring Q4 slides\n\n## FYI / Review (3)\n- **Sprint Retro Notes** from Bob -- action items from yesterday\n- **Benefits Update** from HR -- open enrollment ends Feb 28\n- **Server Maintenance** from DevOps -- scheduled downtime Saturday\n\n## Low Priority (4)\n- **Weekly Newsletter** from DevWeekly\n- **GitHub Notifications** (3 PRs merged)\n\n---\nStats: 9 emails | 2 action | 3 FYI | 4 low\n</code></pre> <p>Options:</p> <ul> <li>Export: \"Export my digest as markdown\"</li> <li>Clipboard: \"Copy the digest to my clipboard\"</li> <li>Date range: \"Digest for the last 3 days\"</li> </ul>"},{"location":"guide/skills/#emailreply","title":"/email:reply","text":"<p>Draft and send email replies with safety confirmation.</p> <p>Triggers: \"reply to email\", \"respond to email\", \"draft reply\"</p> <p>What it does:</p> <ol> <li>Reads the original email with <code>read_email</code></li> <li>Generates a draft reply with <code>draft_reply</code></li> <li>Shows the full draft for your review</li> <li>Accepts edits (\"make it shorter\", \"add that I'll be late\")</li> <li>Only sends after your explicit confirmation</li> </ol> <p>Example:</p> <pre><code>You: /email:reply 249088\n\nClaude:\nReading email 249088 from Alice...\n\nSubject: Q1 Budget Review\n\nHere's a draft reply:\n\n---\nHi Alice,\n\nThanks for sharing the Q1 budget review. I've looked through the\nnumbers and have a few questions:\n\n1. The marketing line item seems higher than projected -- is this\n   due to the new campaign?\n2. Can we schedule 30 minutes to discuss the engineering allocation?\n\nHappy to chat anytime this week.\n\nBest,\n[Your name]\n---\n\nWant me to:\n- Send this as-is?\n- Make changes? (e.g., \"make it more formal\", \"add a deadline\")\n- Cancel?\n</code></pre> <p>Tone options:</p> Tone When to use <code>professional</code> Default. Business communication <code>casual</code> Friends, close colleagues <code>brief</code> Quick acknowledgments <code>detailed</code> Complex topics needing explanation <p>Safety guarantees:</p> <ul> <li>Draft is always shown before sending</li> <li>\"Send\" requires explicit confirmation</li> <li>You can revise unlimited times</li> <li>\"Cancel\" stops the workflow entirely</li> </ul>"},{"location":"guide/skills/#emailsearch","title":"/email:search","text":"<p>Search emails by keyword, sender, flags, or date.</p> <p>Triggers: \"search email\", \"find email\", \"look for email\", \"email from\", \"email about\"</p> <p>What it does:</p> <ol> <li>Parses user query into himalaya filter syntax (<code>from:</code>, <code>subject:</code>, <code>--unread</code>, <code>--flagged</code>, dates)</li> <li>Calls <code>search_emails</code> MCP tool</li> <li>Formats results as a table: ID, From, Subject, Date, Flags</li> <li>Offers to read, refine, or triage results</li> </ol> <p>Example:</p> <pre><code>You: /email:search from:alice meeting\n\nClaude:\nFound 3 emails matching \"from:alice meeting\":\n\n| ID     | From           | Subject                  | Date       | Flags |\n|--------|----------------|--------------------------|------------|-------|\n| 249088 | alice@work.com | Q1 Budget Review Meeting | 2026-02-13 | Seen  |\n| 248972 | alice@work.com | Meeting Tomorrow         | 2026-02-10 |       |\n| 248901 | alice@work.com | Re: Weekly Meeting Notes | 2026-02-07 | Seen  |\n\nWould you like me to:\n- Read any of these emails?\n- Refine the search?\n- Triage these results?\n</code></pre> <p>Options:</p> <ul> <li>Combine filters: \"emails from alice about budget flagged\"</li> <li>Unread only: \"unread emails from boss\"</li> <li>Flagged: \"flagged emails this week\"</li> <li>Date hints: \"emails about invoices from last month\"</li> </ul>"},{"location":"guide/skills/#emailmanage","title":"/email:manage","text":"<p>Bulk email operations -- flag, unflag, move, archive.</p> <p>Triggers: \"manage email\", \"bulk email\", \"move emails\", \"flag emails\", \"archive emails\"</p> <p>What it does:</p> <ol> <li>Parses action (flag / unflag / move / archive) and target list (comma-separated IDs or <code>all-unread</code>)</li> <li>Shows a confirmation gate for operations affecting more than 5 emails</li> <li>Executes operations in sequence with a progress display</li> <li>Reports a summary when complete</li> </ol> <p>Example:</p> <pre><code>You: /email:manage move 1,2,3 Archive\n\nClaude:\nMoving 3 emails to Archive...\n\n  [1/3] 249088 -- moved\n  [2/3] 249064 -- moved\n  [3/3] 249051 -- moved\n\nDone. 3 emails moved to Archive.\n</code></pre> <p>Safety:</p> <ul> <li>Confirmation required for operations affecting more than 5 emails</li> <li>Never deletes emails -- moves to Trash only</li> <li>All moves are reversible (move back from Trash or Archive)</li> </ul>"},{"location":"guide/skills/#emailstats","title":"/email:stats","text":"<p>Inbox statistics -- unread count, top senders, trends.</p> <p>Triggers: \"email stats\", \"inbox stats\", \"email analytics\", \"how many unread\"</p> <p>What it does:</p> <ol> <li>Calls <code>list_emails</code> and <code>search_emails</code> to gather data</li> <li>Computes unread count, today's email count, top senders, and oldest unread email</li> <li>Displays a stats block with optional weekly trend comparison</li> </ol> <p>Example output:</p> <pre><code>Inbox Stats -- 2026-02-13\n\n  Unread:        14\n  Today:          5\n  Oldest unread:  2026-02-01 (from devops@company.com)\n\n  Top senders (last 30 days):\n    1. github@github.com      -- 42 emails\n    2. alice@work.com         -- 18 emails\n    3. newsletter@devweekly   -- 12 emails\n</code></pre> <p>Options:</p> <ul> <li><code>--weekly</code> to include a trend comparison vs. last week</li> <li><code>--folder Sent</code> to run stats on a specific folder</li> </ul>"},{"location":"guide/skills/#emailconfig","title":"/email:config","text":"<p>Setup wizard for email configuration.</p> <p>Triggers: \"email config\", \"email setup\", \"configure email\", \"himalaya setup\"</p> <p>What it does:</p> <ol> <li>Checks that the himalaya CLI is installed</li> <li>Checks that a config file exists at <code>~/.config/himalaya/config.toml</code></li> <li>Runs an interactive setup with provider templates (Gmail, Outlook, Fastmail, custom IMAP)</li> <li>Tests the connection</li> <li>Runs <code>himalaya-mcp doctor</code> to verify everything is working</li> </ol> <p>Modes:</p> Mode Usage Wizard (default) <code>/email:config</code> Validate existing config <code>/email:config --check</code> Add another account <code>/email:config --add-account</code> <p>Example:</p> <pre><code>You: /email:config\n\nClaude:\nEmail Setup Wizard\n\nStep 1/5  Checking himalaya CLI...   installed (v1.0.0)\nStep 2/5  Checking config file...    not found\n\nLet's create one. Which email provider?\n  1. Gmail\n  2. Outlook / Microsoft 365\n  3. Fastmail\n  4. Custom IMAP/SMTP\n\nYou: 1\n\nStep 3/5  Gmail setup\n  IMAP host:  imap.gmail.com:993 (SSL)\n  SMTP host:  smtp.gmail.com:587 (STARTTLS)\n  Email address: you@gmail.com\n  Auth:       App password (recommended)\n\nStep 4/5  Testing connection...      OK\nStep 5/5  Running doctor check...    All checks passed\n\nSetup complete. Try /email:inbox to check your mail.\n</code></pre>"},{"location":"guide/skills/#emailhelp","title":"/email:help","text":"<p>Help hub for the email plugin. Browse all available tools, prompts, resources, and workflows.</p> <p>Triggers: \"email help\", \"himalaya help\", \"email commands\", \"what can you do with email\"</p> <p>Views:</p> Command Shows <code>/email:help</code> Overview of all capabilities <code>/email:help tools</code> All 19 MCP tools with parameters <code>/email:help prompts</code> All 4 MCP prompts <code>/email:help resources</code> All 3 MCP resources <code>/email:help workflows</code> Common email workflow patterns <code>/email:help quick</code> One-page quick reference <code>/email:help [tool-name]</code> Detailed help for a specific tool <p>Example:</p> <pre><code>You: /email:help\n\nClaude:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Email Help                                  \u2502\n\u2502  Privacy-first email for Claude              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                              \u2502\n\u2502  Skills:                                     \u2502\n\u2502    /email:inbox        Check your inbox      \u2502\n\u2502    /email:triage       Classify emails       \u2502\n\u2502    /email:digest       Daily summary         \u2502\n\u2502    /email:reply        Draft &amp; send safely   \u2502\n\u2502    /email:compose      Compose new emails    \u2502\n\u2502    /email:attachments  Files &amp; calendar      \u2502\n\u2502    /email:help         This help             \u2502\n\u2502                                              \u2502\n\u2502  Quick actions:                              \u2502\n\u2502    \"Check my inbox\"                          \u2502\n\u2502    \"Triage my last 20 emails\"                \u2502\n\u2502    \"Reply to email 42\"                       \u2502\n\u2502    \"Export email 42 as markdown\"             \u2502\n\u2502    \"Find emails from alice about budget\"     \u2502\n\u2502                                              \u2502\n\u2502  Type /email:help [topic] for details        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"guide/skills/#email-assistant-agent","title":"Email Assistant Agent","text":"<p>The email-assistant is an autonomous agent that can process your entire inbox with minimal interaction.</p> <p>Triggers: \"handle my email\", \"process inbox\", \"email workflow\"</p> <p>What it does:</p> <ol> <li>Scan -- lists unread emails</li> <li>Classify -- triages each email</li> <li>Summarize -- one-sentence summary per email</li> <li>Act -- drafts replies, extracts todos, suggests flags/moves</li> <li>Report -- generates a digest with stats</li> </ol> <p>Safety rules:</p> <ul> <li>Never sends email without your explicit confirmation</li> <li>Never deletes (only flags or moves)</li> <li>Never accesses other accounts without permission</li> <li>Asks before bulk operations on 5+ emails</li> <li>All actions are reversible (unflag, move back)</li> </ul> <p>Example session:</p> <pre><code>You: \"Handle my email\"\n\nClaude (email-assistant agent):\nScanning inbox... found 12 unread emails.\n\nReading and classifying...\n\nSummary:\n- 3 emails need replies (Alice, Boss, Client)\n- 4 are FYI (team updates, CI notifications)\n- 5 are low priority (newsletters, promotions)\n\nSuggested actions:\n1. Draft replies for the 3 actionable emails\n2. Mark 4 FYI emails as read\n3. Archive 5 low-priority emails\n\nShall I proceed with these actions? I'll show each\ndraft before sending.\n</code></pre> <p>The agent is best for batch processing when you have many emails to work through. For individual emails, the skills are faster.</p>"},{"location":"guide/skills/#plugin-hooks","title":"Plugin Hooks","text":"<p>The plugin includes a pre-send confirmation hook that provides an additional safety layer.</p>"},{"location":"guide/skills/#pre-send-confirmation","title":"Pre-Send Confirmation","text":"<p>Event: PreToolUse (on <code>send_email</code> and <code>compose_email</code>)</p> <p>When you send an email with <code>confirm=true</code>, the hook shows a preview on stderr before the MCP tool's own safety gate processes the request:</p> <pre><code>\ud83d\udce7 \u2500\u2500\u2500 Email Send Preview \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  To:      alice@example.com\n  Subject: Meeting tomorrow\n  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  Hi Alice,\n  Just confirming our meeting...\n  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n</code></pre> <p>The hook also logs all sends to <code>~/.himalaya-mcp/sent.log</code> for audit purposes.</p>"},{"location":"guide/skills/#choosing-between-skills-and-natural-language","title":"Choosing Between Skills and Natural Language","text":"<p>Both approaches work. Skills provide structured workflows; natural language is more flexible.</p> Want to... Skill Natural language Check inbox <code>/email:inbox</code> \"What's in my inbox?\" Triage <code>/email:triage</code> \"Organize my last 20 emails\" Daily summary <code>/email:digest</code> \"Give me today's email digest\" Reply <code>/email:reply 42</code> \"Reply to that email from Alice\" Search <code>/email:search</code> \"Find emails about the project deadline\" Export (no skill) \"Export email 42 as markdown\" Bulk actions <code>/email:manage</code> \"Archive all newsletters\" Inbox stats <code>/email:stats</code> \"How many unread emails?\" Setup email <code>/email:config</code> \"Configure my email\" Full processing (agent) \"Handle my email\" <p>Natural language can combine operations: \"Find the budget email from Alice, summarize it, and draft a reply saying I approve.\" Skills are for when you want a predictable, structured workflow.</p>"},{"location":"guide/troubleshooting/","title":"Troubleshooting","text":"<p>Common issues and solutions for himalaya-mcp.</p>"},{"location":"guide/troubleshooting/#himalaya-cli-issues","title":"himalaya CLI Issues","text":""},{"location":"guide/troubleshooting/#himalaya-command-not-found","title":"\"himalaya: command not found\"","text":"<p>The himalaya binary isn't in your PATH.</p> <p>Fix:</p> <pre><code># Install via Homebrew\nbrew install himalaya\n\n# Verify\nwhich himalaya\nhimalaya --version\n</code></pre> <p>If installed but not found, set the full path in your MCP config:</p> <pre><code>{\n  \"env\": {\n    \"HIMALAYA_BINARY\": \"/opt/homebrew/bin/himalaya\"\n  }\n}\n</code></pre>"},{"location":"guide/troubleshooting/#no-account-found","title":"\"No account found\"","text":"<p>himalaya needs at least one configured email account.</p> <p>Fix:</p> <p>Create <code>~/.config/himalaya/config.toml</code>:</p> <pre><code>[accounts.personal]\ndefault = true\nemail = \"you@example.com\"\ndisplay-name = \"Your Name\"\n\nbackend.type = \"imap\"\nbackend.host = \"imap.example.com\"\nbackend.port = 993\nbackend.encryption = \"tls\"\nbackend.login = \"you@example.com\"\nbackend.passwd.cmd = \"security find-generic-password -s 'himalaya-personal' -w\"\n\nmessage.send.backend.type = \"smtp\"\nmessage.send.backend.host = \"smtp.example.com\"\nmessage.send.backend.port = 465\nmessage.send.backend.encryption = \"tls\"\nmessage.send.backend.login = \"you@example.com\"\nmessage.send.backend.passwd.cmd = \"security find-generic-password -s 'himalaya-personal' -w\"\n</code></pre> <p>See the himalaya docs for provider-specific setup (Gmail, Fastmail, etc.).</p>"},{"location":"guide/troubleshooting/#authentication-failed","title":"\"Authentication failed\"","text":"<p>Your password or app-specific password is incorrect.</p> <p>Fix for Gmail:</p> <ol> <li>Enable 2FA on your Google account</li> <li>Generate an app password at myaccount.google.com/apppasswords</li> <li>Store it in your keychain:    <pre><code>security add-generic-password -s 'himalaya-gmail' -a 'you@gmail.com' -w 'your-app-password'\n</code></pre></li> <li>Reference it in config: <code>passwd.cmd = \"security find-generic-password -s 'himalaya-gmail' -w\"</code></li> </ol>"},{"location":"guide/troubleshooting/#connection-timed-out","title":"\"Connection timed out\"","text":"<p>The IMAP/SMTP server is unreachable.</p> <p>Fix:</p> <ul> <li>Check your internet connection</li> <li>Verify host and port in your himalaya config</li> <li>Try increasing the timeout:   <pre><code>{ \"env\": { \"HIMALAYA_TIMEOUT\": \"60000\" } }\n</code></pre></li> <li>Some networks block IMAP port 993 -- try a different network</li> </ul>"},{"location":"guide/troubleshooting/#mcp-server-issues","title":"MCP Server Issues","text":""},{"location":"guide/troubleshooting/#server-not-responding-in-claude-code","title":"\"Server not responding\" in Claude Code","text":"<p>The MCP server process may have crashed.</p> <p>Fix:</p> <pre><code># Test the server directly\nnode dist/index.js\n\n# If it fails, rebuild\nnpm run build &amp;&amp; node dist/index.js\n</code></pre>"},{"location":"guide/troubleshooting/#tool-not-found-errors","title":"\"Tool not found\" errors","text":"<p>The server is running but tools aren't registered.</p> <p>Fix:</p> <ol> <li>Rebuild: <code>npm run build</code></li> <li>Restart Claude Code</li> <li>Verify the plugin path is correct:    <pre><code>ls -la ~/.claude/plugins/himalaya-mcp\n</code></pre></li> </ol>"},{"location":"guide/troubleshooting/#plugin-not-loading","title":"Plugin not loading","text":"<p>Check the symlink:</p> <pre><code>ls -la ~/.claude/plugins/himalaya-mcp\n# Should point to your himalaya-mcp directory\n</code></pre> <p>Check the plugin manifest:</p> <pre><code>cat ~/.claude/plugins/himalaya-mcp/.claude-plugin/plugin.json\n</code></pre> <p>Rebuild if needed:</p> <pre><code>cd ~/projects/dev-tools/himalaya-mcp\nnpm run build\n</code></pre>"},{"location":"guide/troubleshooting/#skills-not-loading","title":"Skills not loading","text":"<p>If <code>/email:*</code> slash commands don't appear after install, the most common cause is a skills nesting bug -- the plugin symlink points to a directory that has an extra level of nesting (e.g., <code>skills/</code> is inside a subdirectory instead of at the plugin root).</p> <p>Diagnose:</p> <pre><code># Skills must be at the plugin root, not nested\nls ~/.claude/plugins/himalaya-mcp/skills/\n# Expected: inbox.md  triage.md  digest.md  reply.md  compose.md  attachments.md  help.md\n</code></pre> <p>Fix (Homebrew):</p> <p>The Homebrew formula symlinks <code>libexec</code> (which contains <code>skills/</code> at its root) to <code>~/.claude/plugins/himalaya-mcp</code>. If the symlink target is wrong:</p> <pre><code># Re-create the symlink pointing to the correct path\nln -sf $(brew --prefix)/opt/himalaya-mcp/libexec ~/.claude/plugins/himalaya-mcp\n</code></pre> <p>Then restart Claude Code.</p> <p>Fix (GitHub Marketplace):</p> <p>The marketplace install clones the full repo. Skills live at <code>himalaya-mcp-plugin/skills/</code>, but Claude Code expects them at the plugin root. Verify:</p> <pre><code>ls ~/.claude/plugins/himalaya-mcp/skills/\n</code></pre> <p>If missing, re-install: <code>claude plugin install email@himalaya-mcp</code></p>"},{"location":"guide/troubleshooting/#mcp-tools-not-available-github-marketplace-install","title":"MCP tools not available (GitHub Marketplace install)","text":"<p>If you installed via <code>claude plugin marketplace add</code> and MCP tools (like <code>list_emails</code>, <code>search_emails</code>) are not available, the <code>dist/</code> directory may be missing. The GitHub marketplace method does not pre-build the server bundle.</p> <p>Diagnose:</p> <pre><code>ls ~/.claude/plugins/himalaya-mcp/dist/index.js\n# If \"No such file\", the bundle wasn't built\n</code></pre> <p>Fix:</p> <pre><code>cd ~/.claude/plugins/himalaya-mcp\nnpm install &amp;&amp; npm run build\n</code></pre> <p>Then restart Claude Code. The <code>dist/index.js</code> bundle is required for the MCP server to start.</p>"},{"location":"guide/troubleshooting/#plugin-not-found-after-install","title":"Plugin not found after install","text":"<p>If <code>claude plugin list</code> doesn't show the <code>email</code> plugin:</p> <p>1. Check the symlink exists and is valid:</p> <pre><code>ls -la ~/.claude/plugins/himalaya-mcp\n# Should be a symlink pointing to a real directory\n</code></pre> <p>If the symlink is broken (target doesn't exist):</p> <pre><code># Homebrew installs\nln -sf $(brew --prefix)/opt/himalaya-mcp/libexec ~/.claude/plugins/himalaya-mcp\n\n# Source installs\nln -sf /path/to/your/himalaya-mcp ~/.claude/plugins/himalaya-mcp\n</code></pre> <p>2. Check the plugin manifest exists:</p> <pre><code>cat ~/.claude/plugins/himalaya-mcp/.claude-plugin/plugin.json\n</code></pre> <p>If this file is missing, the install is corrupt. Re-install via your preferred method.</p> <p>3. Check marketplace registration:</p> <pre><code>cat ~/.claude/local-marketplace/marketplace.json\n# Should contain an entry for \"himalaya-mcp\"\n</code></pre> <p>If missing, register manually:</p> <pre><code>claude plugin install email@local-plugins\n</code></pre> <p>4. Restart Claude Code -- plugin discovery only runs at startup.</p>"},{"location":"guide/troubleshooting/#email-issues","title":"Email Issues","text":""},{"location":"guide/troubleshooting/#empty-search-results","title":"Empty search results","text":"<p>himalaya's search syntax is specific. Common mistakes:</p> Wrong Right Why <code>from: alice</code> <code>from alice</code> No colon in himalaya syntax <code>\"subject invoice\"</code> <code>subject invoice</code> No quotes needed <code>from=alice</code> <code>from alice</code> Use space, not equals <p>Correct syntax:</p> <pre><code>subject budget                    -- subject contains \"budget\"\nfrom alice                        -- sender contains \"alice\"\nfrom alice and subject budget     -- both conditions\nnot flag Seen                     -- unread emails\nafter 2026-02-01                  -- after a date\n</code></pre>"},{"location":"guide/troubleshooting/#wrong-folder-names","title":"Wrong folder names","text":"<p>Folder names are provider-specific:</p> Provider Trash Spam Sent Archive Gmail <code>[Gmail]/Trash</code> <code>[Gmail]/Spam</code> <code>[Gmail]/Sent Mail</code> <code>[Gmail]/All Mail</code> Fastmail <code>Trash</code> <code>Junk Mail</code> <code>Sent</code> <code>Archive</code> Generic IMAP <code>Trash</code> <code>Spam</code> <code>Sent</code> <code>Archive</code> <p>Find your folders:</p> <pre><code>You: \"List my email folders\"\n</code></pre> <p>Claude calls the <code>email://folders</code> resource.</p>"},{"location":"guide/troubleshooting/#html-emails-show-as-empty","title":"HTML emails show as empty","text":"<p>Some emails are HTML-only with no plain text version.</p> <p>Fix: Use <code>read_email_html</code> instead of <code>read_email</code>:</p> <pre><code>You: \"Show me the HTML version of email 42\"\n</code></pre>"},{"location":"guide/troubleshooting/#pagination-not-working","title":"Pagination not working","text":"<p>The <code>page</code> parameter starts at 1, not 0:</p> <pre><code>list_emails(page_size: 10, page: 1)   -- first 10\nlist_emails(page_size: 10, page: 2)   -- next 10\n</code></pre>"},{"location":"guide/troubleshooting/#desktop-extension-issues","title":"Desktop Extension Issues","text":""},{"location":"guide/troubleshooting/#himalaya-cli-not-found-in-claude-desktop","title":"\"himalaya CLI not found\" in Claude Desktop","text":"<p>Claude Desktop doesn't inherit your shell's PATH. The himalaya binary at <code>/opt/homebrew/bin/himalaya</code> isn't visible to the extension.</p> <p>Fix:</p> <ol> <li>Run <code>himalaya-mcp doctor --fix</code> -- this auto-sets <code>himalaya_binary</code> in Desktop settings</li> <li>Or manually set the binary path in the extension settings:</li> <li>Open <code>~/Library/Application Support/Claude/Claude Extensions Settings/himalaya-mcp.json</code></li> <li>Set <code>\"himalaya_binary\": \"/opt/homebrew/bin/himalaya\"</code> in <code>userConfig</code></li> </ol>"},{"location":"guide/troubleshooting/#unresolved-user_config-template-variables","title":"Unresolved <code>${user_config.*}</code> template variables","text":"<p>If optional fields (himalaya_binary, himalaya_account, himalaya_folder) are left empty during install, Claude Desktop passes literal <code>${user_config.himalaya_binary}</code> strings instead of empty values.</p> <p>Fix: This is handled automatically since v1.2.1 -- the config loader ignores any value starting with <code>${</code>. If you're on an older version, upgrade the extension.</p>"},{"location":"guide/troubleshooting/#extension-not-showing-tools","title":"Extension not showing tools","text":"<ol> <li>Run <code>himalaya-mcp doctor</code> to check extension status</li> <li>Verify the extension is enabled in Claude Desktop settings</li> <li>Restart Claude Desktop after installing or updating the extension</li> </ol>"},{"location":"guide/troubleshooting/#extension-install-path","title":"Extension install path","text":"<p>Extensions are stored at:</p> <pre><code>~/Library/Application Support/Claude/Claude Extensions/himalaya-mcp/\n</code></pre> <p>Registry: <code>~/Library/Application Support/Claude/extensions-installations.json</code> Settings: <code>~/Library/Application Support/Claude/Claude Extensions Settings/himalaya-mcp.json</code></p>"},{"location":"guide/troubleshooting/#common-error-messages","title":"Common Error Messages","text":"Error Cause Fix <code>himalaya exited with code 1</code> CLI command failed Check himalaya config, try the command manually <code>ETIMEOUT</code> Server connection timeout Increase <code>HIMALAYA_TIMEOUT</code>, check network <code>JSON parse error</code> Unexpected CLI output Rebuild (<code>npm run build</code>), update himalaya <code>spawn himalaya ENOENT</code> Binary not found Set <code>HIMALAYA_BINARY</code> env var to full path <code>No such folder</code> Invalid folder name Use <code>email://folders</code> to list valid names"},{"location":"guide/troubleshooting/#getting-help","title":"Getting Help","text":"<ul> <li>himalaya CLI: github.com/pimalaya/himalaya</li> <li>himalaya-mcp: github.com/Data-Wise/himalaya-mcp/issues</li> <li>MCP Protocol: modelcontextprotocol.io</li> </ul>"},{"location":"guide/troubleshooting/#run-doctor","title":"Run doctor","text":"<p>The fastest way to diagnose issues:</p> <pre><code>himalaya-mcp doctor          # Check everything\nhimalaya-mcp doctor --fix    # Auto-fix what it can\nhimalaya-mcp doctor --json   # Machine-readable output\n</code></pre> <p>Doctor checks: Node.js, himalaya binary, himalaya config, MCP server bundle, email connectivity, Desktop extension (install, registry, settings, user_config), Claude Code plugin (symlink, marketplace), and environment variables.</p>"},{"location":"guide/troubleshooting/#debug-mode","title":"Debug mode","text":"<p>Run the MCP server with debug output:</p> <pre><code>DEBUG=* node dist/index.js\n</code></pre>"},{"location":"guide/troubleshooting/#run-tests-to-verify-installation","title":"Run tests to verify installation","text":"<pre><code>npm test    # 335 tests\n</code></pre>"},{"location":"guide/workflows/","title":"Email Workflows","text":"<p>Common patterns for using himalaya-mcp with Claude.</p>"},{"location":"guide/workflows/#1-morning-inbox-triage","title":"1. Morning Inbox Triage","text":"<p>The most common workflow -- review and organize your inbox.</p> <p>Natural language: \"Triage my inbox\"</p> <p>What happens:</p> <ol> <li><code>list_emails(page_size: 20)</code> -- fetch recent emails</li> <li><code>read_email</code> on each -- understand content</li> <li>Classify as Actionable / FYI / Skip</li> <li>Present table with suggested actions</li> <li>Wait for your approval before any flags or moves</li> </ol> <p>Example interaction:</p> <pre><code>You: \"Triage my inbox\"\n\nClaude:\n| ID     | From           | Subject              | Class      | Action          |\n|--------|----------------|----------------------|------------|-----------------|\n| 249088 | alice@work.com | Q1 Budget Review     | Actionable | Reply needed    |\n| 249064 | newsletter@... | Weekly Digest        | Skip       | Move to Archive |\n| 249051 | boss@work.com  | Meeting Tomorrow     | Actionable | Flag + Reply    |\n\nWant me to flag #249088 and #249051, and archive #249064?\n</code></pre>"},{"location":"guide/workflows/#2-reply-to-an-email","title":"2. Reply to an Email","text":"<p>Draft and send a reply with safety confirmation.</p> <p>Natural language: \"Reply to email 249088\"</p> <p>What happens:</p> <ol> <li><code>read_email(id: \"249088\")</code> -- understand original</li> <li><code>draft_reply(id: \"249088\")</code> -- generate reply template</li> <li>Show full draft for review</li> <li>Wait for approval or edits</li> <li><code>send_email(template, confirm: true)</code> only after explicit \"send it\"</li> </ol> <p>Key safety points: - Draft is shown before anything is sent - You can say \"make it more formal\" or \"add that I'll be late\" - Claude revises and shows again - Only \"send\" / \"yes\" / \"looks good\" triggers actual send</p>"},{"location":"guide/workflows/#3-daily-email-digest","title":"3. Daily Email Digest","text":"<p>Get a priority-grouped summary of today's email.</p> <p>Natural language: \"Give me today's email digest\"</p> <p>What happens:</p> <ol> <li><code>list_emails(page_size: 50)</code> -- fetch recent emails</li> <li><code>read_email</code> on each for content understanding</li> <li>Group by priority: Action Required / FYI / Low Priority</li> <li>Generate markdown digest with one-line summaries</li> <li>Offer to export or copy to clipboard</li> </ol> <p>Output format:</p> <pre><code># Email Digest -- 2026-02-13\n\n## Requires Action\n- **Q1 Budget Review** from Alice -- needs approval by Friday\n\n## FYI / Review\n- **Sprint Retrospective Notes** from Bob -- action items from yesterday\n\n## Low Priority\n- **Weekly Newsletter** from DevNews -- this week's highlights\n\nStats: 12 emails | 2 action | 4 FYI | 6 low\n</code></pre>"},{"location":"guide/workflows/#4-export-email-to-markdown","title":"4. Export Email to Markdown","text":"<p>Save an email as a structured markdown file.</p> <p>Natural language: \"Export email 249088 as markdown\"</p> <p>What happens:</p> <ol> <li><code>export_to_markdown(id: \"249088\")</code> -- generates markdown with YAML frontmatter</li> <li>Returns formatted text you can save or pipe</li> </ol> <p>Output:</p> <pre><code>---\nsubject: \"Q1 Budget Review\"\nfrom: \"Alice &lt;alice@work.com&gt;\"\nto: \"You &lt;you@work.com&gt;\"\ndate: \"2026-02-13T09:15:00Z\"\nid: \"249088\"\nflags: [Seen, Flagged]\nhas_attachment: true\n---\n\n# Q1 Budget Review\n\nHi team, please review the attached budget...\n</code></pre>"},{"location":"guide/workflows/#5-extract-action-items","title":"5. Extract Action Items","text":"<p>Pull todos and deadlines from an email.</p> <p>Natural language: \"What are the action items in email 249088?\"</p> <p>What happens:</p> <ol> <li><code>create_action_item(id: \"249088\")</code> -- fetches email with context</li> <li>Claude identifies tasks, deadlines, questions, and commitments</li> </ol> <p>Output:</p> <pre><code>Action items from \"Q1 Budget Review\" (Alice, 2026-02-13):\n\n- [ ] Review budget spreadsheet (attached)\n- [ ] Submit feedback by Friday 2026-02-14\n- [ ] Schedule follow-up meeting for next week\n</code></pre>"},{"location":"guide/workflows/#6-multi-account-workflow","title":"6. Multi-Account Workflow","text":"<p>Work across email accounts in a single session.</p> <p>Natural language: \"Check my work inbox, then my personal\"</p> <pre><code>list_emails(account: \"work\")       -- work inbox\nlist_emails(account: \"personal\")   -- personal inbox\n</code></pre> <p>Set a default account via <code>HIMALAYA_ACCOUNT</code> env var, then override per-call.</p>"},{"location":"guide/workflows/#7-search-and-process","title":"7. Search and Process","text":"<p>Find specific emails and act on them.</p> <p>Natural language: \"Find all emails from alice about the budget\"</p> <pre><code>search_emails(query: \"from:alice subject:budget\")\n  -&gt; read_email on results\n  -&gt; summarize, reply, export, or extract actions\n</code></pre> <p>Search supports himalaya's filter syntax: <code>from:</code>, <code>subject:</code>, <code>body:</code>, <code>before:</code>, <code>after:</code>.</p>"},{"location":"guide/workflows/#8-batch-flagmove","title":"8. Batch Flag/Move","text":"<p>Organize multiple emails at once.</p> <p>Natural language: \"Mark all newsletters as read and archive them\"</p> <pre><code>search_emails(query: \"from:newsletter\")\n  -&gt; flag_email(id, flags: [\"Seen\"], action: \"add\")  -- for each\n  -&gt; move_email(id, target_folder: \"Archive\")         -- for each\n</code></pre> <p>The email-assistant agent asks for confirmation before bulk operations on 5+ emails.</p>"},{"location":"guide/workflows/#9-newsletter-cleanup","title":"9. Newsletter Cleanup","text":"<p>Bulk archive newsletters and promotional emails.</p> <p>Natural language: \"Clean up my newsletters from the past week\"</p> <p>What happens:</p> <ol> <li><code>search_emails(query: \"after 2026-02-06\")</code> -- recent emails</li> <li>Claude identifies newsletters by sender patterns</li> <li>Presents list for confirmation</li> <li><code>flag_email(id, flags: [\"Seen\"], action: \"add\")</code> -- mark read</li> <li><code>move_email(id, target_folder: \"Archive\")</code> -- archive each</li> </ol> <p>Tip: Combine with triage for efficiency:</p> <pre><code>You: \"Triage my inbox, but auto-archive anything from\n      newsletters or marketing\"\n</code></pre>"},{"location":"guide/workflows/#10-meeting-preparation","title":"10. Meeting Preparation","text":"<p>Pull relevant emails before a meeting.</p> <p>Natural language: \"Find all emails about the Q1 review meeting\"</p> <p>What happens:</p> <ol> <li><code>search_emails(query: \"subject Q1 review\")</code> -- find related emails</li> <li><code>read_email</code> on each -- gather context</li> <li><code>create_action_item</code> on each -- extract todos and deadlines</li> <li>Claude summarizes all relevant context</li> </ol> <p>Example:</p> <pre><code>You: \"I have a meeting with Alice about Q1 budget. Gather all\n      relevant emails and action items.\"\n\nClaude:\nFound 4 emails about Q1 budget:\n\nEmail threads:\n1. Alice: Q1 Budget Review (Feb 13) -- initial review request\n2. Alice: Budget Spreadsheet Updated (Feb 10) -- revised numbers\n3. Bob: Q1 Projections (Feb 8) -- engineering estimates\n4. Alice: Budget Meeting Agenda (Feb 7) -- meeting prep\n\nAction items:\n- [ ] Review marketing line item variance\n- [ ] Prepare engineering allocation proposal\n- [ ] Bring Q4 actuals for comparison\n\nWant me to export this as markdown for your notes?\n</code></pre>"},{"location":"guide/workflows/#11-email-to-notes-pipeline","title":"11. Email-to-Notes Pipeline","text":"<p>Convert important emails into structured notes.</p> <p>Natural language: \"Save the project update email to my notes\"</p> <p>What happens:</p> <ol> <li><code>read_email(id)</code> -- get content</li> <li><code>export_to_markdown(id)</code> -- convert with YAML frontmatter</li> <li><code>create_action_item(id)</code> -- extract tasks</li> <li><code>copy_to_clipboard(text)</code> -- ready to paste into Obsidian, Notion, etc.</li> </ol> <p>Combined output:</p> <pre><code>You: \"Export email 42 with action items and copy everything\"\n\nClaude exports:\n---\nsubject: \"Project Alpha Update\"\nfrom: \"pm@company.com\"\ndate: \"2026-02-13\"\n---\n\n# Project Alpha Update\n\n[email body]\n\n## Action Items\n- [ ] Review updated timeline by Wednesday\n- [ ] Schedule stakeholder demo for next week\n\nCopied to clipboard.\n</code></pre>"},{"location":"guide/workflows/#12-compose-a-new-email","title":"12. Compose a New Email","text":"<p>Send a new email (not a reply) with safety confirmation.</p> <p>Natural language: \"Email alice@example.com about the project deadline\"</p> <p>What happens:</p> <ol> <li><code>compose_email(to, subject, body)</code> -- generates preview (not sent)</li> <li>Show full preview for review</li> <li>Wait for approval or edits</li> <li><code>compose_email(..., confirm: true)</code> only after explicit approval</li> </ol> <p>Example interaction:</p> <pre><code>You: \"Email the team about moving the deadline to Friday\"\n\nClaude:\n--- EMAIL PREVIEW (not sent) ---\n\nTo: team@work.com\nSubject: Deadline Moved to Friday\n\nHi team,\n\nQuick update -- the project deadline has been moved to Friday.\nPlease adjust your timelines accordingly.\n\nLet me know if you have any questions.\n\n--- END PREVIEW ---\n\nSend this, edit it, or cancel?\n</code></pre> <p>Tip: Add CC/BCC: \"Email Alice, CC Bob about the meeting change\"</p>"},{"location":"guide/workflows/#13-download-and-process-attachments","title":"13. Download and Process Attachments","text":"<p>View and download email attachments.</p> <p>Natural language: \"What attachments does email 42 have?\"</p> <p>What happens:</p> <ol> <li><code>list_attachments(id: \"42\")</code> -- shows files with MIME types and sizes</li> <li>Choose which to download</li> <li><code>download_attachment(id: \"42\", filename: \"report.pdf\")</code> -- saves to temp dir</li> </ol> <pre><code>You: \"Download the report from email 42\"\n\nClaude:\nAttachments for email 42:\n- report.pdf (application/pdf, 245 KB)\n- invite.ics (text/calendar, 2 KB)\n\nDownloaded \"report.pdf\" to: /tmp/himalaya-mcp-abc123/report.pdf\n</code></pre> <p>Note: Body parts (<code>plain.txt</code>, <code>index.html</code>) are automatically filtered out.</p>"},{"location":"guide/workflows/#14-process-calendar-invites","title":"14. Process Calendar Invites","text":"<p>Extract meeting details from ICS attachments and add to Apple Calendar.</p> <p>Natural language: \"Check the meeting invite in email 42\"</p> <p>What happens:</p> <ol> <li><code>extract_calendar_event(id: \"42\")</code> -- downloads attachments, finds <code>.ics</code>, parses it</li> <li>Shows event details: title, dates, location, organizer</li> <li>If you want to add to calendar:</li> <li><code>create_calendar_event(...)</code> -- shows preview first (safety gate)</li> <li><code>create_calendar_event(..., confirm: true)</code> -- creates in Apple Calendar</li> </ol> <pre><code>You: \"Add the meeting from email 42 to my calendar\"\n\nClaude:\nEvent: Q2 Planning Meeting\nStart: 2026-03-01 14:00\nEnd: 2026-03-01 15:00\nLocation: Room 42\nOrganizer: alice@example.com\n\nCreate this event in Apple Calendar?\n</code></pre> <p>Note: Calendar creation is macOS only (uses AppleScript).</p>"},{"location":"guide/workflows/#15-folder-management","title":"15. Folder Management","text":"<p>Create and organize email folders.</p> <p>Natural language: \"Create a Projects folder for my work account\"</p> <pre><code>create_folder(name: \"Projects\", account: \"work\")  -- create\nlist_folders(account: \"work\")                       -- verify\nmove_email(id: \"42\", target_folder: \"Projects\")     -- use it\n</code></pre> <p>Delete with safety gate:</p> <pre><code>You: \"Delete the OldStuff folder\"\n\nClaude:\n--- DELETE FOLDER PREVIEW ---\nFolder to delete: OldStuff\nWARNING: This will permanently delete the folder and all emails in it.\n---\n\nAre you sure? This action cannot be undone.\n</code></pre>"},{"location":"guide/workflows/#16-end-of-day-email-sweep","title":"16. End-of-Day Email Sweep","text":"<p>Quick cleanup before signing off. Now includes attachment checks and calendar event extraction.</p> <p>Natural language: \"Do an end-of-day email sweep\"</p> <p>What happens:</p> <ol> <li><code>list_emails(page_size: 30)</code> -- today's emails</li> <li>Claude identifies unread and unflagged items</li> <li>Quick classification: reply tomorrow / archive / ignore</li> <li>Generates a \"tomorrow morning\" action list</li> </ol> <p>Example:</p> <pre><code>You: \"End-of-day sweep\"\n\nClaude:\nToday's email summary:\n- 23 emails received\n- 18 already handled\n- 5 remaining:\n\n| ID     | From    | Subject           | Suggested      |\n|--------|---------|-------------------|----------------|\n| 249102 | Client  | Contract question | Reply tomorrow |\n| 249098 | Boss    | FYI: new hire     | Mark read      |\n| 249095 | DevOps  | Deploy complete   | Archive        |\n| 249091 | HR      | Survey reminder   | Archive        |\n| 249089 | Alice   | Quick question    | Reply tomorrow |\n\nTomorrow's priority list:\n1. Reply to Client re: contract question\n2. Reply to Alice re: quick question\n\nMark the other 3 as read and archive?\n</code></pre>"},{"location":"guide/workflows/#17-search-and-filter-emails","title":"17. Search and Filter Emails","text":"<p>Use the <code>/email:search</code> skill for powerful email search with filter combinations.</p> <p>Natural language: \"Find unread emails from Alice about the budget\"</p> <p>What happens:</p> <ol> <li><code>/email:search</code> parses your query into himalaya filter syntax</li> <li><code>search_emails(query: \"from alice and subject budget and not flag Seen\")</code> -- combined filters</li> <li>Results displayed as a table with ID, From, Subject, Date, Flags</li> <li>Offers to read, triage, or act on results</li> </ol> <p>Filter combinations:</p> <pre><code>Keyword only:     \"search meeting\"         \u2192 subject meeting or body meeting\nSender filter:    \"search from:alice\"      \u2192 from alice\nFlag filter:      \"search --unread\"        \u2192 not flag Seen\nDate filter:      \"find emails from last week\" \u2192 after 2026-02-19\nCombined:         \"search from:alice --unread meeting\" \u2192 from alice and not flag Seen and subject meeting\n</code></pre> <p>Example interaction:</p> <pre><code>You: \"Find unread emails from Alice\"\n\nClaude:\nSearch: \"from alice, unread\" (3 results)\n\n| # | From              | Subject              | Date       | Flags |\n|---|-------------------|----------------------|------------|-------|\n| 1 | alice@work.com    | Q2 Planning          | Feb 25     |       |\n| 2 | alice@work.com    | Budget Revision      | Feb 24     |       |\n| 3 | alice@work.com    | Meeting Notes        | Feb 23     |       |\n\n\u2192 \"Read #1\" to view full email\n\u2192 \"Flag all\" to star these\n\u2192 \"/email:manage archive 1,2,3\" to bulk archive\n</code></pre>"},{"location":"guide/workflows/#18-bulk-email-management","title":"18. Bulk Email Management","text":"<p>Use <code>/email:manage</code> for batch operations on multiple emails.</p> <p>Natural language: \"Move emails 1, 2, 5 to Archive\"</p> <p>What happens:</p> <ol> <li><code>/email:manage</code> parses the action and target list</li> <li>Shows confirmation gate for operations on &gt;5 emails</li> <li>Executes operations with progress display</li> <li>Shows summary</li> </ol> <p>Batch patterns:</p> <pre><code>Flag specific:    /email:manage flag 1,2,5\nUnflag:           /email:manage unflag 3,7\nMove to folder:   /email:manage move 1,2,3 Archive\nArchive shortcut: /email:manage archive 4,5,6\nAll unread:       /email:manage move all-unread Spam\n</code></pre> <p>Example interaction:</p> <pre><code>You: \"Archive all the newsletter emails\"\n\nClaude:\nFound 8 newsletter emails.\n\nWARNING: This will move 8 emails to Archive. Continue? (yes/no)\n\nYou: \"yes\"\n\n[1/8] Moving email #249064 to Archive...\n[2/8] Moving email #249058 to Archive...\n...\n[8/8] Moving email #249012 to Archive...\n\nMoved 8 emails to Archive\n\n\u2192 \"/email:inbox\" to check remaining emails\n\u2192 \"Undo\" to move these back to INBOX\n</code></pre> <p>Tip: Combine with search for powerful workflows:</p> <pre><code>You: \"Find all emails from newsletter@dev.to and archive them\"\n</code></pre>"},{"location":"guide/workflows/#19-inbox-statistics-and-trends","title":"19. Inbox Statistics and Trends","text":"<p>Use <code>/email:stats</code> for a quick overview of your inbox health.</p> <p>Natural language: \"How many unread emails do I have?\"</p> <p>What happens:</p> <ol> <li><code>/email:stats</code> calls <code>list_emails</code> and <code>search_emails</code> to gather data</li> <li>Computes unread count, today's volume, top senders, oldest unread</li> <li>Displays formatted statistics</li> <li>Optional <code>--weekly</code> for trend comparison</li> </ol> <p>Example interaction:</p> <pre><code>You: \"/email:stats\"\n\nClaude:\nInbox Stats\n\nUnread: 47 (12 today, 8 yesterday)\nTotal recent: 156 emails (last 7 days)\n\nTop senders:\n  1. boss@company.com -- 6 emails\n  2. team@company.com -- 4 emails\n  3. newsletter@dev.to -- 3 emails\n\nOldest unread: 12 days ago\n  From: hr@company.com\n  Subject: Benefits enrollment deadline\n\n\u2192 \"Read oldest unread\" to view it\n\u2192 \"/email:triage\" to classify unread\n</code></pre> <p>Weekly comparison:</p> <pre><code>You: \"/email:stats --weekly\"\n\nClaude:\nWeekly Comparison\n\n           This week    Last week    Change\nReceived:  47           52           down 10%\nUnread:    12           8            up 50%\nSent:      23           19           up 21%\n\n\u2192 Unread trending up -- consider /email:triage\n</code></pre> <p>Tip: Great for Monday morning email planning -- check stats before diving in.</p>"},{"location":"reference/architecture/","title":"Architecture","text":""},{"location":"reference/architecture/#system-overview","title":"System Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Claude (Code / Desktop / Cowork)                                \u2502\n\u2502                                                                 \u2502\n\u2502   \"Triage my inbox\"                                             \u2502\n\u2502         \u2502                                                       \u2502\n\u2502         \u25bc                                                       \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   MCP Protocol   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502   \u2502 MCP Client  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502 himalaya-mcp         \u2502    \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   (JSON-RPC)     \u2502                      \u2502    \u2502\n\u2502                                     \u2502  Tools (19)          \u2502    \u2502\n\u2502                                     \u2502  Prompts (4)         \u2502    \u2502\n\u2502                                     \u2502  Resources (3)       \u2502    \u2502\n\u2502                                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                \u2502                \u2502\n\u2502                                     execFile (no shell)         \u2502\n\u2502                                                \u2502                \u2502\n\u2502                                     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502                                     \u2502 himalaya CLI         \u2502    \u2502\n\u2502                                     \u2502 --output json        \u2502    \u2502\n\u2502                                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                \u2502                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                 \u2502\n                                      IMAP / SMTP (local auth)\n                                                 \u2502\n                                      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                      \u2502 Mail Server          \u2502\n                                      \u2502 (Gmail, Fastmail,    \u2502\n                                      \u2502  self-hosted, etc.)  \u2502\n                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"reference/architecture/#distribution-architecture","title":"Distribution Architecture","text":"<pre><code>Homebrew (Primary)                  GitHub (Fallback)                    .mcpb (Claude Desktop)\n  brew install himalaya-mcp           claude plugin marketplace add ...     Download .mcpb from GitHub Releases\n  \u2502                                   claude plugin install email           Double-click to install in Desktop\n  \u251c\u2500 depends_on \"himalaya\"            \u2502                                     \u2502\n  \u251c\u2500 depends_on \"node\"                \u2514\u2500 Copies plugin to cache             \u251c\u2500 ~150 KB package (bundled server)\n                                                                            \u251c\u2500 Configurable: binary path, account, folder\n                                                                            \u2514\u2500 Requires: brew install himalaya\n  \u2502\n  \u251c\u2500 libexec/\n  \u2502   \u251c\u2500 .claude-plugin/plugin.json\n  \u2502   \u251c\u2500 .claude-plugin/marketplace.json\n  \u2502   \u251c\u2500 .mcp.json\n  \u2502   \u251c\u2500 plugin/skills/*.md\n  \u2502   \u251c\u2500 plugin/agents/*.md\n  \u2502   \u2514\u2500 dist/index.js (esbuild bundle, 583KB)\n  \u2502\n  \u2514\u2500 post_install \u2192 himalaya-mcp-install\n      \u251c\u2500 symlink \u2192 ~/.claude/plugins/himalaya-mcp\n      \u251c\u2500 register \u2192 ~/.claude/local-marketplace/marketplace.json\n      \u2514\u2500 auto-enable \u2192 ~/.claude/settings.json\n</code></pre>"},{"location":"reference/architecture/#build-pipeline","title":"Build Pipeline","text":"<pre><code>src/index.ts (16 files)\n  \u2502\n  \u251c\u2500 npm run build          \u2192 dist/*.js + .d.ts (development)\n  \u2502\n  \u2514\u2500 npm run build:bundle   \u2192 dist/index.js (583KB, production)\n      esbuild --bundle --platform=node --target=node22 --format=esm --minify\n      Inlines: @modelcontextprotocol/sdk, zod, content-type, raw-body\n</code></pre>"},{"location":"reference/architecture/#cicd-workflows","title":"CI/CD Workflows","text":"<pre><code>.github/workflows/\n\u251c\u2500\u2500 ci.yml                 Push/PR to main|dev \u2014 lint, typecheck, build, test, bundle, validate plugin\n\u251c\u2500\u2500 docs.yml               Push to main \u2014 deploy GitHub Pages\n\u2514\u2500\u2500 homebrew-release.yml   Release published \u2014 validate \u2192 compute SHA \u2192 update homebrew-tap formula\n</code></pre> <p>Release flow:</p> <pre><code>git tag v1.2.0 \u2192 gh release create\n  \u2502\n  \u251c\u2500 ci.yml (PR checks)\n  \u2502\n  \u2514\u2500 homebrew-release.yml\n      \u251c\u2500 validate    npm ci \u2192 version check \u2192 build \u2192 test \u2192 bundle\n      \u251c\u2500 prepare     curl tarball (5 retries, 30s timeout) \u2192 sha256sum\n      \u2514\u2500 update      \u2192 Data-Wise/homebrew-tap/update-formula.yml@main\n                        \u251c\u2500 checkout with persist-credentials: false\n                        \u251c\u2500 unset GITHUB_TOKEN (bypass runner credential helper)\n                        \u2514\u2500 direct push to main (auto_merge=true)\n</code></pre>"},{"location":"reference/architecture/#module-map","title":"Module Map","text":"<pre><code>src/\n\u251c\u2500\u2500 index.ts              Entry point \u2014 creates McpServer, registers everything\n\u251c\u2500\u2500 config.ts             Reads HIMALAYA_* env vars \u2192 HimalayaClientOptions\n\u2502\n\u251c\u2500\u2500 himalaya/\n\u2502   \u251c\u2500\u2500 client.ts         HimalayaClient \u2014 subprocess wrapper\n\u2502   \u2502                     execFile(\"himalaya\", [...args, \"--output\", \"json\"])\n\u2502   \u251c\u2500\u2500 parser.ts         parseEnvelopes, parseMessageBody, parseFolders\n\u2502   \u2502                     formatEnvelope \u2014 human-readable one-liner\n\u2502   \u2514\u2500\u2500 types.ts          Envelope, Folder, HimalayaClientOptions, *Params\n\u2502\n\u251c\u2500\u2500 tools/\n\u2502   \u251c\u2500\u2500 inbox.ts          list_emails, search_emails\n\u2502   \u251c\u2500\u2500 read.ts           read_email, read_email_html\n\u2502   \u251c\u2500\u2500 manage.ts         flag_email, move_email\n\u2502   \u251c\u2500\u2500 compose.ts        draft_reply, send_email (safety gate)\n\u2502   \u251c\u2500\u2500 compose-new.ts    compose_email (new messages, safety gate)\n\u2502   \u251c\u2500\u2500 folders.ts        list_folders, create_folder, delete_folder\n\u2502   \u251c\u2500\u2500 attachments.ts    list_attachments, download_attachment\n\u2502   \u251c\u2500\u2500 calendar.ts       extract_calendar_event, create_calendar_event\n\u2502   \u2514\u2500\u2500 actions.ts        export_to_markdown, create_action_item\n\u2502\n\u251c\u2500\u2500 prompts/\n\u2502   \u251c\u2500\u2500 triage.ts         triage_inbox \u2014 classify actionable/FYI/skip\n\u2502   \u251c\u2500\u2500 summarize.ts      summarize_email \u2014 one-sentence + action items\n\u2502   \u251c\u2500\u2500 digest.ts         daily_email_digest \u2014 priority-grouped markdown\n\u2502   \u2514\u2500\u2500 reply.ts          draft_reply \u2014 guided reply composition\n\u2502\n\u251c\u2500\u2500 resources/\n\u2502   \u2514\u2500\u2500 index.ts          email://inbox, email://message/{id}, email://folders\n\u2502\n\u251c\u2500\u2500 adapters/\n\u2502   \u251c\u2500\u2500 clipboard.ts      copy_to_clipboard \u2014 pbcopy (macOS) / xclip (Linux)\n\u2502   \u2514\u2500\u2500 calendar.ts       ICS parser + Apple Calendar (osascript)\n\u2502\n\u2514\u2500\u2500 cli/\n    \u2514\u2500\u2500 setup.ts          Claude Desktop setup (setup/check/remove MCP config + install-ext/remove-ext)\n</code></pre>"},{"location":"reference/architecture/#data-flow","title":"Data Flow","text":""},{"location":"reference/architecture/#read-path","title":"Read Path","text":"<pre><code>list_emails\n  \u2192 client.listEnvelopes(folder, pageSize, page, account)\n    \u2192 execFile(\"himalaya\", [\"envelope\", \"list\", \"--page-size\", N, \"--output\", \"json\"])\n      \u2192 parseEnvelopes(stdout) \u2192 Envelope[]\n        \u2192 formatEnvelope(each) \u2192 \"ID | From | Subject | Date | Flags\"\n</code></pre>"},{"location":"reference/architecture/#send-path-two-phase-safety-gate","title":"Send Path (Two-Phase Safety Gate)","text":"<pre><code>Phase 1: Preview\n  draft_reply(id)\n    \u2192 client.replyTemplate(id) \u2192 template string\n      \u2192 Return \"--- DRAFT REPLY (not sent) ---\"\n\n  send_email(template, confirm=false)\n    \u2192 Return \"--- EMAIL PREVIEW (not sent) ---\"\n\nPhase 2: Confirmed Send\n  send_email(template, confirm=true)\n    \u2192 client.sendTemplate(template)\n      \u2192 execFile(\"himalaya\", [\"template\", \"send\", template])\n        \u2192 \"Email sent successfully.\"\n</code></pre>"},{"location":"reference/architecture/#triage-path","title":"Triage Path","text":"<pre><code>triage_inbox prompt\n  \u2192 Returns guide text instructing Claude to:\n    1. list_emails(page_size: N)\n    2. read_email on each\n    3. Classify: Actionable / FYI / Skip\n    4. Present table\n    5. Wait for user confirmation before flag/move\n</code></pre>"},{"location":"reference/architecture/#plugin-structure","title":"Plugin Structure","text":"<pre><code>.claude-plugin/\n  plugin.json         Manifest \u2014 declares skills, agents, hooks, MCP server\n  marketplace.json    GitHub plugin discovery (self-hosted marketplace)\n  hooks/\n    pre-send.sh       PreToolUse hook \u2014 email send preview + audit log\n\nplugin/\n  skills/\n    inbox.md          /email:inbox \u2014 list recent emails\n    triage.md         /email:triage \u2014 classify and organize\n    digest.md         /email:digest \u2014 daily summary\n    reply.md          /email:reply \u2014 draft with safety gate\n    compose.md        /email:compose \u2014 compose new emails\n    attachments.md    /email:attachments \u2014 files and calendar\n    search.md         /email:search \u2014 search with filters\n    manage.md         /email:manage \u2014 bulk operations\n    stats.md          /email:stats \u2014 inbox statistics\n    config.md         /email:config \u2014 setup wizard\n    help.md           /email:help \u2014 help hub\n\n  agents/\n    email-assistant.md  Autonomous triage agent (all 19 tools)\n\n.mcp.json             MCP server config (node dist/index.js)\n</code></pre>"},{"location":"reference/architecture/#security-boundaries","title":"Security Boundaries","text":"Layer Protection Subprocess <code>execFile</code> (not <code>exec</code>) \u2014 no shell injection Authentication Local only \u2014 himalaya handles auth, no tokens in MCP Send gate <code>confirm=true</code> required \u2014 preview-first by default Hook gate PreToolUse <code>pre-send.sh</code> \u2014 stderr preview before send, audit log Delete Not implemented \u2014 only flag/move Bulk Agent asks before operating on 5+ emails Account Per-call <code>account</code> param \u2014 no cross-account leaks"},{"location":"reference/commands/","title":"Command Reference","text":"<p>Complete reference for all 19 MCP tools, 4 prompts, 3 resources, and CLI commands.</p> <p>See also</p> <p>Tutorials for step-by-step walkthroughs | Workflows for common email patterns</p>"},{"location":"reference/commands/#tools","title":"Tools","text":""},{"location":"reference/commands/#inbox-search","title":"Inbox &amp; Search","text":""},{"location":"reference/commands/#list_emails","title":"<code>list_emails</code>","text":"<p>List emails in a folder. Returns envelope data: subject, from, date, flags.</p> Parameter Type Required Default Description <code>folder</code> string No <code>INBOX</code> Folder name <code>page_size</code> number No <code>25</code> Number of emails to return <code>page</code> number No <code>1</code> Page number for pagination <code>account</code> string No default Account name from himalaya config <p>Examples:</p> <pre><code>\"List my last 10 emails\"\n\u2192 list_emails(page_size: 10)\n\n\"Show emails in Archive\"\n\u2192 list_emails(folder: \"Archive\")\n\n\"Page 2 of my work inbox\"\n\u2192 list_emails(page: 2, account: \"work\")\n</code></pre> <p>Output: One line per email with ID, flags, date, sender, and subject.</p> <p>Related: search_emails, read_email</p>"},{"location":"reference/commands/#search_emails","title":"<code>search_emails</code>","text":"<p>Search emails using himalaya filter syntax.</p> Parameter Type Required Default Description <code>query</code> string Yes \u2014 Search query in himalaya filter syntax <code>folder</code> string No <code>INBOX</code> Folder to search in <code>account</code> string No default Account name <p>Filter syntax:</p> Condition Example Description <code>subject</code> <code>subject invoice</code> Subject contains \"invoice\" <code>from</code> <code>from alice</code> Sender contains \"alice\" <code>to</code> <code>to team</code> Recipient contains \"team\" <code>body</code> <code>body deadline</code> Body contains \"deadline\" <code>date</code> <code>date 2026-02-13</code> Sent on date <code>before</code> <code>before 2026-02-01</code> Sent before date <code>after</code> <code>after 2026-01-01</code> Sent after date <code>flag</code> <code>flag Flagged</code> Has specific flag <p>Operators: <code>and</code>, <code>or</code>, <code>not</code></p> <p>Examples:</p> <pre><code>\"Find emails about invoices\"\n\u2192 search_emails(query: \"subject invoice\")\n\n\"Emails from Alice about the meeting\"\n\u2192 search_emails(query: \"from alice and subject meeting\")\n\n\"Unread emails from last week\"\n\u2192 search_emails(query: \"not flag Seen and after 2026-02-06\")\n\n\"Search Sent folder for budget emails\"\n\u2192 search_emails(query: \"subject budget\", folder: \"Sent\")\n</code></pre> <p>Related: list_emails, read_email</p>"},{"location":"reference/commands/#reading","title":"Reading","text":""},{"location":"reference/commands/#read_email","title":"<code>read_email</code>","text":"<p>Read an email message body as plain text.</p> Parameter Type Required Default Description <code>id</code> string Yes \u2014 Email message ID (from list or search) <code>folder</code> string No <code>INBOX</code> Folder name <code>account</code> string No default Account name <p>Examples:</p> <pre><code>\"Read email 42\"\n\u2192 read_email(id: \"42\")\n\n\"Read that email from Sent\"\n\u2192 read_email(id: \"15\", folder: \"Sent\")\n</code></pre> <p>Related: read_email_html, list_emails</p>"},{"location":"reference/commands/#read_email_html","title":"<code>read_email_html</code>","text":"<p>Read an email message body as HTML. Useful for formatted emails with tables, images, or rich text.</p> Parameter Type Required Default Description <code>id</code> string Yes \u2014 Email message ID <code>folder</code> string No <code>INBOX</code> Folder name <code>account</code> string No default Account name <p>Examples:</p> <pre><code>\"Show the HTML version of email 42\"\n\u2192 read_email_html(id: \"42\")\n\n\"Read the formatted newsletter\"\n\u2192 read_email_html(id: \"88\")\n</code></pre> <p>When to use: Prefer <code>read_email</code> for most messages. Use <code>read_email_html</code> when the plain text version is empty or poorly formatted (newsletters, marketing emails, HTML-only senders).</p> <p>Related: read_email</p>"},{"location":"reference/commands/#managing","title":"Managing","text":""},{"location":"reference/commands/#flag_email","title":"<code>flag_email</code>","text":"<p>Add or remove flags on an email.</p> Parameter Type Required Default Description <code>id</code> string Yes \u2014 Email message ID <code>flags</code> string[] Yes \u2014 Flags to add/remove <code>action</code> <code>\"add\"</code> | <code>\"remove\"</code> Yes \u2014 Whether to add or remove flags <code>folder</code> string No <code>INBOX</code> Folder name <code>account</code> string No default Account name <p>Available flags:</p> Flag Meaning <code>Seen</code> Email has been read <code>Flagged</code> Starred / important <code>Answered</code> Has been replied to <code>Deleted</code> Marked for deletion <code>Draft</code> Is a draft message <p>Examples:</p> <pre><code>\"Star email 42\"\n\u2192 flag_email(id: \"42\", flags: [\"Flagged\"], action: \"add\")\n\n\"Mark emails 10-15 as read\"\n\u2192 flag_email(id: \"10\", flags: [\"Seen\"], action: \"add\")\n   (repeat for each ID)\n\n\"Unstar email 42\"\n\u2192 flag_email(id: \"42\", flags: [\"Flagged\"], action: \"remove\")\n\n\"Mark as read and flag important\"\n\u2192 flag_email(id: \"42\", flags: [\"Seen\", \"Flagged\"], action: \"add\")\n</code></pre> <p>Related: move_email, triage_inbox</p>"},{"location":"reference/commands/#move_email","title":"<code>move_email</code>","text":"<p>Move an email to a different folder.</p> Parameter Type Required Default Description <code>id</code> string Yes \u2014 Email message ID <code>target_folder</code> string Yes \u2014 Destination folder name <code>folder</code> string No <code>INBOX</code> Source folder name <code>account</code> string No default Account name <p>Common target folders:</p> Folder Purpose <code>Archive</code> Reviewed, no action needed <code>Trash</code> Delete <code>Spam</code> Junk mail <code>Drafts</code> Saved drafts <p>Folder names are provider-specific</p> <p>Gmail uses <code>[Gmail]/Trash</code>, <code>[Gmail]/Spam</code>, etc. Fastmail uses <code>Trash</code>, <code>Spam</code>. Check your folders with the <code>email://folders</code> resource.</p> <p>Examples:</p> <pre><code>\"Archive email 42\"\n\u2192 move_email(id: \"42\", target_folder: \"Archive\")\n\n\"Delete email 10\"\n\u2192 move_email(id: \"10\", target_folder: \"Trash\")\n\n\"Move to project folder\"\n\u2192 move_email(id: \"42\", target_folder: \"Projects/Launch\")\n</code></pre> <p>Related: flag_email, triage_inbox</p>"},{"location":"reference/commands/#folders","title":"Folders","text":""},{"location":"reference/commands/#list_folders","title":"<code>list_folders</code>","text":"<p>List all email folders/mailboxes for an account.</p> Parameter Type Required Default Description <code>account</code> string No default Account name <p>Examples:</p> <pre><code>\"Show my email folders\"\n\u2192 list_folders()\n\n\"List folders on my work account\"\n\u2192 list_folders(account: \"work\")\n</code></pre> <p>Output: One line per folder with the folder name and optional description.</p> <p>Related: create_folder, delete_folder, move_email</p>"},{"location":"reference/commands/#create_folder","title":"<code>create_folder</code>","text":"<p>Create a new email folder/mailbox.</p> Parameter Type Required Default Description <code>name</code> string Yes \u2014 Name for the new folder <code>account</code> string No default Account name <p>Examples:</p> <pre><code>\"Create a folder called Projects\"\n\u2192 create_folder(name: \"Projects\")\n\n\"Make a Receipts folder on my work account\"\n\u2192 create_folder(name: \"Receipts\", account: \"work\")\n</code></pre> <p>Related: list_folders, delete_folder</p>"},{"location":"reference/commands/#delete_folder","title":"<code>delete_folder</code>","text":"<p>Delete an email folder/mailbox. Safety gate: requires <code>confirm=true</code> to actually delete.</p> Parameter Type Required Default Description <code>name</code> string Yes \u2014 Folder name to delete <code>confirm</code> boolean No <code>false</code> Set <code>true</code> to actually delete <code>account</code> string No default Account name <p>Safety flow:</p> <pre><code>1. delete_folder(name: \"OldStuff\")            \u2192 PREVIEW warning (not deleted)\n2. User reviews and approves\n3. delete_folder(name: \"OldStuff\", confirm: true)  \u2192 DELETES\n</code></pre> <p>Permanent deletion</p> <p>Deleting a folder permanently removes the folder and all emails in it. Always review the preview before confirming.</p> <p>Related: list_folders, create_folder</p>"},{"location":"reference/commands/#compose","title":"Compose","text":""},{"location":"reference/commands/#compose_email","title":"<code>compose_email</code>","text":"<p>Compose and send a new email (not a reply). Two-phase safety gate: requires explicit <code>confirm=true</code>.</p> Parameter Type Required Default Description <code>to</code> string Yes \u2014 Recipient email address <code>subject</code> string Yes \u2014 Email subject line <code>body</code> string Yes \u2014 Email body text <code>cc</code> string No \u2014 CC recipient(s) <code>bcc</code> string No \u2014 BCC recipient(s) <code>confirm</code> boolean No <code>false</code> Set <code>true</code> to actually send <code>account</code> string No default Account name <p>Safety flow:</p> <pre><code>1. compose_email(to: \"alice@example.com\", subject: \"Meeting\", body: \"...\")\n   \u2192 shows PREVIEW (not sent)\n2. User reviews and approves\n3. compose_email(..., confirm: true)  \u2192 SENDS\n</code></pre> <p>Examples:</p> <pre><code>\"Send Alice an email about the meeting\"\n\u2192 compose_email(to: \"alice@example.com\", subject: \"Meeting Request\", body: \"Hi Alice...\")\n\n\"Email the team about the deadline\"\n\u2192 compose_email(to: \"team@example.com\", subject: \"Q2 Deadline Reminder\", body: \"...\")\n</code></pre> <p>Never skip the preview step</p> <p>Always call <code>compose_email</code> without <code>confirm</code> first to show the preview. Only set <code>confirm=true</code> after the user explicitly approves.</p> <p>Related: draft_reply, send_email</p>"},{"location":"reference/commands/#actions","title":"Actions","text":""},{"location":"reference/commands/#export_to_markdown","title":"<code>export_to_markdown</code>","text":"<p>Export an email as formatted markdown with YAML frontmatter.</p> Parameter Type Required Default Description <code>id</code> string Yes \u2014 Email message ID <code>folder</code> string No <code>INBOX</code> Folder name <code>account</code> string No default Account name <p>Output format:</p> <pre><code>---\nsubject: \"Meeting Notes - Q1 Review\"\nfrom: \"Alice &lt;alice@example.com&gt;\"\nto: \"Team &lt;team@example.com&gt;\"\ndate: \"2026-02-13\"\nid: \"42\"\nflags: [Seen, Flagged]\nhas_attachment: false\n---\n\n# Meeting Notes - Q1 Review\n\n[email body in plain text]\n</code></pre> <p>Examples:</p> <pre><code>\"Export email 42 to markdown\"\n\u2192 export_to_markdown(id: \"42\")\n\n\"Save this email for my notes\"\n\u2192 export_to_markdown(id: \"42\")\n   then copy_to_clipboard or save to file\n</code></pre> <p>Related: copy_to_clipboard, read_email</p>"},{"location":"reference/commands/#create_action_item","title":"<code>create_action_item</code>","text":"<p>Extract action items, todos, deadlines, and commitments from an email.</p> Parameter Type Required Default Description <code>id</code> string Yes \u2014 Email message ID <code>folder</code> string No <code>INBOX</code> Folder name <code>account</code> string No default Account name <p>Output identifies:</p> <ul> <li>Action items / tasks</li> <li>Deadlines or due dates</li> <li>Commitments made by sender</li> <li>Questions that need answers</li> <li>Meetings or events mentioned</li> </ul> <p>Examples:</p> <pre><code>\"What do I need to do from email 42?\"\n\u2192 create_action_item(id: \"42\")\n\n\"Extract todos from the project update\"\n\u2192 create_action_item(id: \"88\")\n</code></pre> <p>Related: triage_inbox, summarize_email</p>"},{"location":"reference/commands/#replies-sending","title":"Replies &amp; Sending","text":""},{"location":"reference/commands/#draft_reply","title":"<code>draft_reply</code>","text":"<p>Generate a reply template for an email. Does not send.</p> Parameter Type Required Default Description <code>id</code> string Yes \u2014 Email message ID to reply to <code>body</code> string No \u2014 Custom reply body text <code>reply_all</code> boolean No <code>false</code> Reply to all recipients <code>folder</code> string No <code>INBOX</code> Folder name <code>account</code> string No default Account name <p>Examples:</p> <pre><code>\"Draft a reply to email 42\"\n\u2192 draft_reply(id: \"42\")\n\n\"Reply all with my availability\"\n\u2192 draft_reply(id: \"42\", body: \"I'm available Tuesday afternoon.\", reply_all: true)\n</code></pre> <p>This tool creates a draft only</p> <p>The reply is not sent. Use send_email with <code>confirm=true</code> after reviewing.</p> <p>Related: send_email, draft_reply prompt</p>"},{"location":"reference/commands/#send_email","title":"<code>send_email</code>","text":"<p>Send an email template. Two-phase safety gate: requires explicit <code>confirm=true</code>.</p> Parameter Type Required Default Description <code>template</code> string Yes \u2014 Full email template (MML format from draft_reply) <code>confirm</code> boolean No <code>false</code> Set <code>true</code> to actually send <code>account</code> string No default Account name <p>Safety flow:</p> <pre><code>1. draft_reply(id: \"42\")           \u2192 generates template\n2. send_email(template: \"...\")     \u2192 shows PREVIEW (not sent)\n3. User reviews and approves\n4. send_email(template: \"...\", confirm: true)  \u2192 SENDS\n</code></pre> <p>Never skip the preview step</p> <p>Always call <code>send_email</code> without <code>confirm</code> first to show the preview. Only set <code>confirm=true</code> after the user explicitly approves.</p> <p>Related: draft_reply</p>"},{"location":"reference/commands/#adapters","title":"Adapters","text":""},{"location":"reference/commands/#copy_to_clipboard","title":"<code>copy_to_clipboard</code>","text":"<p>Copy text to the system clipboard (macOS <code>pbcopy</code>).</p> Parameter Type Required Default Description <code>text</code> string Yes \u2014 Text to copy <p>Examples:</p> <pre><code>\"Copy that email to my clipboard\"\n\u2192 export_to_markdown(id: \"42\")\n   then copy_to_clipboard(text: &lt;markdown output&gt;)\n\n\"Copy the sender's email address\"\n\u2192 copy_to_clipboard(text: \"alice@example.com\")\n</code></pre>"},{"location":"reference/commands/#attachments","title":"Attachments","text":""},{"location":"reference/commands/#list_attachments","title":"<code>list_attachments</code>","text":"<p>List all attachments in an email message. Downloads all attachments to inspect them, returning filename, MIME type (inferred from extension), and file size for each.</p> Parameter Type Required Default Description <code>id</code> string Yes \u2014 Email message ID <code>folder</code> string No <code>INBOX</code> Folder name <code>account</code> string No default Account name <p>Examples:</p> <pre><code>\"What attachments does email 42 have?\"\n\u2192 list_attachments(id: \"42\")\n\n\"Check attachments in the project email\"\n\u2192 list_attachments(id: \"88\")\n</code></pre> <p>Output: One line per attachment with filename, MIME type, and size in KB.</p> <p>Body parts are filtered</p> <p>himalaya downloads all message parts including <code>plain.txt</code> and <code>index.html</code> body parts. These are automatically excluded from the attachment list.</p> <p>Related: download_attachment, extract_calendar_event</p>"},{"location":"reference/commands/#download_attachment","title":"<code>download_attachment</code>","text":"<p>Download a specific attachment from an email to a temporary directory.</p> Parameter Type Required Default Description <code>id</code> string Yes \u2014 Email message ID <code>filename</code> string Yes \u2014 Attachment filename to download <code>folder</code> string No <code>INBOX</code> Folder name <code>account</code> string No default Account name <p>Examples:</p> <pre><code>\"Download the PDF from email 42\"\n\u2192 download_attachment(id: \"42\", filename: \"report.pdf\")\n\n\"Get the spreadsheet attachment\"\n\u2192 download_attachment(id: \"88\", filename: \"budget.xlsx\")\n</code></pre> <p>Output: File path where the attachment was saved (temp directory).</p> <p>Typical workflow:</p> <pre><code>1. list_attachments(id: \"42\")    \u2192 see available files\n2. download_attachment(id: \"42\", filename: \"report.pdf\")  \u2192 get file path\n</code></pre> <p>Related: list_attachments</p>"},{"location":"reference/commands/#calendar","title":"Calendar","text":""},{"location":"reference/commands/#extract_calendar_event","title":"<code>extract_calendar_event</code>","text":"<p>Extract calendar event details from an email's ICS attachment. Downloads all attachments, finds the <code>.ics</code> file, parses it, and returns event summary, dates, location, and organizer.</p> Parameter Type Required Default Description <code>id</code> string Yes \u2014 Email message ID containing the calendar invite <code>folder</code> string No <code>INBOX</code> Folder name <code>account</code> string No default Account name <p>Examples:</p> <pre><code>\"What's in the meeting invite in email 42?\"\n\u2192 extract_calendar_event(id: \"42\")\n\n\"Parse the calendar attachment\"\n\u2192 extract_calendar_event(id: \"88\")\n</code></pre> <p>Output: Event title, start/end times, location, organizer, and description.</p> <p>Related: create_calendar_event, list_attachments</p>"},{"location":"reference/commands/#create_calendar_event","title":"<code>create_calendar_event</code>","text":"<p>Create an event in Apple Calendar. Safety gate: requires <code>confirm=true</code> to actually create. macOS only.</p> Parameter Type Required Default Description <code>summary</code> string Yes \u2014 Event title/summary <code>dtstart</code> string Yes \u2014 Start date/time (ISO format) <code>dtend</code> string Yes \u2014 End date/time (ISO format) <code>location</code> string No \u2014 Event location <code>description</code> string No \u2014 Event description/notes <code>confirm</code> boolean No <code>false</code> Set <code>true</code> to actually create <p>Safety flow:</p> <pre><code>1. extract_calendar_event(id: \"42\")    \u2192 parse ICS attachment\n2. create_calendar_event(summary: \"...\", dtstart: \"...\", dtend: \"...\")\n   \u2192 shows PREVIEW (not created)\n3. User reviews and approves\n4. create_calendar_event(..., confirm: true)  \u2192 CREATES in Apple Calendar\n</code></pre> <p>Examples:</p> <pre><code>\"Add that meeting to my calendar\"\n\u2192 extract_calendar_event(id: \"42\")\n   then create_calendar_event(summary: \"Team Standup\", dtstart: \"2026-03-01T09:00:00\", ...)\n\n\"Create a calendar event for Friday at 2pm\"\n\u2192 create_calendar_event(summary: \"Project Review\", dtstart: \"2026-02-20T14:00:00\", dtend: \"2026-02-20T15:00:00\")\n</code></pre> <p>macOS only</p> <p>Calendar event creation uses AppleScript to interact with Apple Calendar. This tool is only available on macOS.</p> <p>Related: extract_calendar_event</p>"},{"location":"reference/commands/#prompts","title":"Prompts","text":""},{"location":"reference/commands/#triage_inbox-prompt","title":"<code>triage_inbox</code>","text":"<p>Classify recent emails as actionable, FYI, or skip.</p> Parameter Type Required Default Description <code>count</code> string No <code>\"10\"</code> Number of recent emails to triage <p>What it does:</p> <ol> <li>Fetches recent emails with <code>list_emails</code></li> <li>Reads each with <code>read_email</code></li> <li>Classifies as Actionable / FYI / Skip</li> <li>Suggests flags and folder moves</li> <li>Presents a table for your approval</li> <li>Executes only actions you confirm</li> </ol> <p>Example output:</p> ID From Subject Class Suggested Action 42 Alice Q1 Review Actionable Flag, reply needed 43 Newsletter Weekly digest Skip Archive 44 Bob FYI: server update FYI Mark read"},{"location":"reference/commands/#summarize_email-prompt","title":"<code>summarize_email</code>","text":"<p>One-sentence summary with action items for a specific email.</p> Parameter Type Required Default Description <code>id</code> string Yes \u2014 Email message ID <code>folder</code> string No <code>INBOX</code> Folder name <p>Output includes:</p> <ul> <li>One-sentence summary</li> <li>Action items (or \"None\")</li> <li>Priority: High / Medium / Low</li> <li>Suggested response (if actionable)</li> </ul>"},{"location":"reference/commands/#daily_email_digest","title":"<code>daily_email_digest</code>","text":"<p>Create a markdown digest of today's emails grouped by priority.</p> <p>No parameters.</p> <p>Output format:</p> <pre><code># Email Digest - 2026-02-13\n\n## Requires Action\n- **Q1 Review** from Alice - needs response by Friday\n\n## FYI / Review\n- **Server Update** from Bob - maintenance window tonight\n\n## Low Priority\n- **Weekly Newsletter** from Devtools - new releases\n\n## Stats\n- Total: 15 emails\n- Action needed: 3\n- FYI: 7\n- Low priority: 5\n</code></pre>"},{"location":"reference/commands/#draft_reply-prompt","title":"<code>draft_reply</code> (prompt)","text":"<p>Guided reply composition with tone control.</p> Parameter Type Required Default Description <code>id</code> string Yes \u2014 Email message ID to reply to <code>tone</code> string No <code>\"professional\"</code> Tone: professional, casual, brief, detailed <code>instructions</code> string No \u2014 Specific instructions for reply content <p>Examples:</p> <pre><code>\"Reply professionally to email 42\"\n\u2192 draft_reply prompt (id: \"42\", tone: \"professional\")\n\n\"Send a brief casual reply declining the meeting\"\n\u2192 draft_reply prompt (id: \"42\", tone: \"casual\", instructions: \"Decline politely, suggest next week\")\n</code></pre> <p>Prompt vs Tool</p> <p>The prompt <code>draft_reply</code> guides the full workflow (read, draft, review, send). The tool <code>draft_reply</code> just generates the template. Use the prompt for interactive reply sessions.</p>"},{"location":"reference/commands/#resources","title":"Resources","text":""},{"location":"reference/commands/#emailinbox","title":"<code>email://inbox</code>","text":"<p>Browse current inbox listing. Returns recent emails as a read-only resource.</p> <pre><code>URI: email://inbox\nType: text/plain\n</code></pre>"},{"location":"reference/commands/#emailfolders","title":"<code>email://folders</code>","text":"<p>List available email folders for the current account.</p> <pre><code>URI: email://folders\nType: text/plain\n</code></pre>"},{"location":"reference/commands/#emailmessageid","title":"<code>email://message/{id}</code>","text":"<p>Read a specific email message by ID.</p> <pre><code>URI: email://message/42\nType: text/plain\n</code></pre>"},{"location":"reference/commands/#common-parameters","title":"Common Parameters","text":"<p>These parameters appear on most tools:</p> Parameter Description Example <code>folder</code> Email folder (default: INBOX) <code>\"Archive\"</code>, <code>\"Sent\"</code>, <code>\"[Gmail]/Trash\"</code> <code>account</code> himalaya account name <code>\"personal\"</code>, <code>\"work\"</code> <code>id</code> Email message ID from list/search results <code>\"42\"</code>, <code>\"1337\"</code> <p>Multi-account usage</p> <p>Every tool accepts an optional <code>account</code> parameter. If omitted, himalaya uses your default account. Set up multiple accounts in <code>~/.config/himalaya/config.toml</code>.</p>"},{"location":"reference/commands/#cli-commands","title":"CLI Commands","text":""},{"location":"reference/commands/#himalaya-mcp-setup","title":"<code>himalaya-mcp setup</code>","text":"<p>Configure himalaya-mcp as an MCP server for Claude Desktop (legacy <code>mcpServers</code> approach).</p> <pre><code>himalaya-mcp setup           # Add MCP server to Claude Desktop config\nhimalaya-mcp setup --check   # Verify configuration exists and paths are valid\nhimalaya-mcp setup --remove  # Remove the server entry\n</code></pre> <p>Config path (per platform):</p> Platform Path macOS <code>~/Library/Application Support/Claude/claude_desktop_config.json</code> Linux <code>~/.config/Claude/claude_desktop_config.json</code> Windows <code>%APPDATA%/Claude/claude_desktop_config.json</code> <p>The setup command preserves all existing MCP servers in the config file. Only the <code>himalaya</code> entry is added, updated, or removed.</p>"},{"location":"reference/commands/#himalaya-mcp-install-ext","title":"<code>himalaya-mcp install-ext</code>","text":"<p>Install a <code>.mcpb</code> Desktop Extension into Claude Desktop.</p> <pre><code>himalaya-mcp install-ext                              # Auto-find .mcpb in project root\nhimalaya-mcp install-ext himalaya-mcp-v1.4.0.mcpb     # Install specific file\n</code></pre> <p>What it does:</p> <ol> <li>Unpacks the <code>.mcpb</code> to <code>~/Library/Application Support/Claude/Claude Extensions/himalaya-mcp/</code></li> <li>Registers the extension in <code>extensions-installations.json</code> with SHA256 hash</li> <li>Creates default settings (enabled, empty user config)</li> <li>Restart Claude Desktop to activate</li> </ol> <p>Auto-discovery: If no file path is given, searches the project root for <code>himalaya-mcp-v*.mcpb</code> and picks the latest version.</p> <p>When to use</p> <p>Use <code>install-ext</code> for local development and testing. For production installs, download the <code>.mcpb</code> from GitHub Releases and double-click to install via Claude Desktop's GUI.</p>"},{"location":"reference/commands/#himalaya-mcp-remove-ext","title":"<code>himalaya-mcp remove-ext</code>","text":"<p>Remove the himalaya-mcp Desktop Extension from Claude Desktop.</p> <pre><code>himalaya-mcp remove-ext\n</code></pre> <p>What it removes:</p> <ul> <li>Extension directory (<code>Claude Extensions/himalaya-mcp/</code>)</li> <li>Registry entry from <code>extensions-installations.json</code></li> <li>Settings file (<code>Claude Extensions Settings/himalaya-mcp.json</code>)</li> </ul> <p>Restart Claude Desktop after removal.</p> <p>See also</p> <p>Desktop Extensions Reference for full details on the <code>.mcpb</code> format, manifest schema, and installation mechanism.</p>"},{"location":"reference/commands/#himalaya-mcp-doctor","title":"<code>himalaya-mcp doctor</code>","text":"<p>Diagnose your himalaya-mcp installation across the full stack: prerequisites, MCP server, email connectivity, Claude Desktop extension, and Claude Code plugin.</p> <pre><code>himalaya-mcp doctor          # Run all checks\nhimalaya-mcp doctor --fix    # Auto-fix what can be fixed\nhimalaya-mcp doctor --json   # Machine-readable output\n</code></pre> <p>Check categories:</p> Category What it checks Prerequisites Node.js version, himalaya binary, himalaya config MCP Server <code>dist/index.js</code> exists and is non-empty Email Connectivity Account list, folder list, envelope fetch Claude Desktop Extension Extension dir, manifest, registry, settings, user_config Claude Code Plugin Symlink, plugin.json, marketplace registration Environment <code>HIMALAYA_*</code> env vars, unresolved template variables <p>Auto-fixable issues (<code>--fix</code>):</p> Issue Fix applied <code>himalaya_binary</code> empty in Desktop settings Set to <code>which himalaya</code> result Settings file missing Create default settings (enabled, empty config) <p>Sample output:</p> <pre><code>himalaya-mcp doctor v1.4.0\n\n  Prerequisites\n  \u2713 Node.js 22.14.0\n  \u2713 himalaya found at /opt/homebrew/bin/himalaya\n  \u2713 himalaya config exists\n\n  MCP Server\n  \u2713 dist/index.js exists (595 KB)\n\n  Email Connectivity\n  \u2713 Accounts: personal, work\n  \u2713 Folders accessible (14 folders)\n  \u2713 Envelopes accessible\n\n  Claude Desktop Extension\n  \u2713 Extension installed\n  \u2713 manifest.json valid\n  \u2713 Registry entry exists\n  \u2713 Settings: enabled\n  \u2717 user_config.himalaya_binary is empty\n    \u2192 Fix with: himalaya-mcp doctor --fix\n\n  Summary: 11 passed, 0 warnings, 1 failed\n</code></pre> <p>JSON output (<code>--json</code>):</p> <p>Returns an array of <code>CheckResult</code> objects:</p> <pre><code>[\n  {\n    \"name\": \"Node.js installed\",\n    \"category\": \"Prerequisites\",\n    \"status\": \"pass\",\n    \"message\": \"Node.js v22.14.0\"\n  },\n  {\n    \"name\": \"himalaya_binary configured\",\n    \"category\": \"Desktop Extension\",\n    \"status\": \"fail\",\n    \"message\": \"user_config.himalaya_binary is empty\",\n    \"fix\": { \"description\": \"Set to /opt/homebrew/bin/himalaya\" }\n  }\n]\n</code></pre> <p>Run after installation</p> <p>Run <code>himalaya-mcp doctor</code> after any installation method to verify everything is connected correctly. Use <code>--fix</code> to resolve common issues automatically.</p>"},{"location":"reference/desktop-extensions/","title":"Claude Desktop Extensions (.mcpb) Reference","text":"<p>Technical reference for the <code>.mcpb</code> Desktop Extension format used to package himalaya-mcp for Claude Desktop.</p>"},{"location":"reference/desktop-extensions/#overview","title":"Overview","text":"<p>A <code>.mcpb</code> file (formerly <code>.dxt</code>) is a ZIP archive containing an MCP server bundle and a <code>manifest.json</code> descriptor. Claude Desktop unpacks it to <code>~/Library/Application Support/Claude/Claude Extensions/&lt;id&gt;/</code> and registers it in <code>extensions-installations.json</code>.</p>"},{"location":"reference/desktop-extensions/#history","title":"History","text":"Version Name Status 0.1 <code>.dxt</code> (Desktop Extension) Deprecated 0.2 <code>.mcpb</code> Superseded 0.3 <code>.mcpb</code> Current <p>The format was renamed from <code>.dxt</code> to <code>.mcpb</code> in early 2026. The <code>dxt_version</code> manifest field became <code>manifest_version</code>.</p>"},{"location":"reference/desktop-extensions/#manifestjson-schema","title":"manifest.json Schema","text":""},{"location":"reference/desktop-extensions/#required-fields","title":"Required Fields","text":"Field Type Description <code>manifest_version</code> <code>\"0.3\"</code> Schema version <code>name</code> string Extension identifier (kebab-case, unique) <code>version</code> string Semantic version (e.g., <code>\"1.2.1\"</code>) <code>description</code> string Short description (one sentence) <code>author</code> object <code>{ name: string, url?: string }</code> <code>server</code> object Server configuration (see below)"},{"location":"reference/desktop-extensions/#optional-fields","title":"Optional Fields","text":"Field Type Description <code>display_name</code> string Human-readable name shown in UI <code>long_description</code> string Extended description <code>icon</code> string Path to icon file (relative to manifest) <code>license</code> string SPDX license identifier <code>homepage</code> string Project URL <code>repository</code> object <code>{ type: \"git\", url: string }</code> <code>documentation</code> string Docs URL <code>support</code> string Support URL <code>keywords</code> string[] Discovery tags <code>privacy_policies</code> string[] Privacy policy URLs <code>user_config</code> object User-configurable settings (see below) <code>tools</code> array Static tool declarations <code>tools_generated</code> boolean If <code>true</code>, tools are generated at runtime <code>prompts</code> array Static prompt declarations <code>prompts_generated</code> boolean If <code>true</code>, prompts are generated at runtime <code>compatibility</code> object Platform and runtime requirements"},{"location":"reference/desktop-extensions/#server","title":"server","text":"<pre><code>{\n  \"type\": \"node\",\n  \"entry_point\": \"dist/index.js\",\n  \"mcp_config\": {\n    \"command\": \"node\",\n    \"args\": [\"${__dirname}/dist/index.js\"],\n    \"env\": {\n      \"HIMALAYA_BINARY\": \"${user_config.himalaya_binary}\",\n      \"HIMALAYA_ACCOUNT\": \"${user_config.himalaya_account}\"\n    }\n  }\n}\n</code></pre> Field Description <code>type</code> Runtime type: <code>\"node\"</code> or <code>\"python\"</code> <code>entry_point</code> Main file relative to manifest <code>mcp_config.command</code> Binary to execute <code>mcp_config.args</code> Command arguments (supports template variables) <code>mcp_config.env</code> Environment variables (supports template variables) <p>Why PATH is set explicitly</p> <p>Claude Desktop does not inherit the user's shell PATH. The himalaya-mcp manifest sets <code>PATH</code> to standard binary locations (<code>/opt/homebrew/bin</code>, <code>/usr/local/bin</code>, etc.) so the server can find the <code>himalaya</code> binary. This is scoped to common installation paths rather than passing through the full system PATH.</p>"},{"location":"reference/desktop-extensions/#user_config","title":"user_config","text":"<p>User-configurable settings that appear in Claude Desktop's extension settings UI.</p> <pre><code>{\n  \"himalaya_binary\": {\n    \"type\": \"file\",\n    \"title\": \"Himalaya Binary\",\n    \"description\": \"Path to himalaya CLI binary\",\n    \"required\": false\n  },\n  \"himalaya_account\": {\n    \"type\": \"string\",\n    \"title\": \"Default Account\",\n    \"description\": \"Email account name from himalaya config\",\n    \"required\": false\n  },\n  \"himalaya_folder\": {\n    \"type\": \"string\",\n    \"title\": \"Default Folder\",\n    \"default\": \"INBOX\",\n    \"required\": false\n  }\n}\n</code></pre> <p>Field types:</p> Type UI Control Description <code>string</code> Text input Free-form text <code>number</code> Number input Numeric value <code>boolean</code> Toggle True/false <code>file</code> File picker Path to a file <code>directory</code> Folder picker Path to a directory <p>Each config field supports: <code>title</code>, <code>description</code>, <code>required</code>, <code>default</code>, <code>multiple</code> (for arrays).</p>"},{"location":"reference/desktop-extensions/#tools-and-prompts","title":"tools and prompts","text":"<p>Static declarations for discovery. Each entry has <code>name</code> and <code>description</code>. Prompts additionally require <code>text</code> and optional <code>arguments</code>.</p> <pre><code>{\n  \"tools\": [\n    { \"name\": \"list_emails\", \"description\": \"List emails in a folder\" }\n  ],\n  \"prompts\": [\n    {\n      \"name\": \"triage_inbox\",\n      \"description\": \"Classify emails as actionable, FYI, or skip\",\n      \"arguments\": [{ \"name\": \"count\", \"description\": \"Number of emails\", \"required\": false }],\n      \"text\": \"Triage the inbox...\"\n    }\n  ]\n}\n</code></pre> <p>If your server generates tools/prompts dynamically, set <code>tools_generated: true</code> / <code>prompts_generated: true</code> instead.</p>"},{"location":"reference/desktop-extensions/#compatibility","title":"compatibility","text":"<pre><code>{\n  \"platforms\": [\"darwin\"],\n  \"runtimes\": { \"node\": \"&gt;=22.0.0\" }\n}\n</code></pre> <p>Platforms: <code>darwin</code>, <code>win32</code>, <code>linux</code>.</p>"},{"location":"reference/desktop-extensions/#template-variables","title":"Template Variables","text":"<p>Variables are expanded at runtime by Claude Desktop:</p> Variable Expands To <code>${__dirname}</code> Absolute path to the unpacked extension directory <code>${user_config.&lt;key&gt;}</code> Value from user's extension settings <code>${HOME}</code> User's home directory <p>Example: <code>${__dirname}/dist/index.js</code> becomes <code>/Users/dt/Library/Application Support/Claude/Claude Extensions/himalaya-mcp/dist/index.js</code>.</p>"},{"location":"reference/desktop-extensions/#mcpbignore","title":".mcpbignore","text":"<p>Controls which files are excluded from the <code>.mcpb</code> archive. Syntax follows <code>.gitignore</code>:</p> <pre><code>node_modules/\nsrc/\ntests/\ndocs/\n*.ts\n*.md\n.git*\n.env*\n</code></pre> <p>Place in the same directory as <code>manifest.json</code>.</p>"},{"location":"reference/desktop-extensions/#cli-tool-anthropic-aimcpb","title":"CLI Tool (@anthropic-ai/mcpb)","text":"<p>Install: <code>npm install -g @anthropic-ai/mcpb</code> or use via <code>npx</code>.</p> Command Description <code>mcpb init</code> Create a new manifest.json interactively <code>mcpb validate &lt;dir&gt;</code> Validate manifest.json schema <code>mcpb pack &lt;dir&gt;</code> Create .mcpb archive from directory <code>mcpb unpack &lt;file&gt; [output]</code> Extract .mcpb to directory <code>mcpb info &lt;file&gt;</code> Show .mcpb metadata (name, version, size, files) <code>mcpb sign &lt;file&gt;</code> Sign .mcpb with a key <code>mcpb verify &lt;file&gt;</code> Verify .mcpb signature <code>mcpb unsign &lt;file&gt;</code> Remove signature <code>mcpb clean &lt;dir&gt;</code> Remove build artifacts"},{"location":"reference/desktop-extensions/#validation","title":"Validation","text":"<pre><code>npx @anthropic-ai/mcpb validate mcpb/\n</code></pre> <p>Checks: required fields, type correctness, prompt <code>text</code> fields, user_config types, version format.</p>"},{"location":"reference/desktop-extensions/#packing","title":"Packing","text":"<pre><code>npx @anthropic-ai/mcpb pack mcpb/\n</code></pre> <p>Creates <code>mcpb.mcpb</code> in the current directory (named after the directory, not the extension name).</p>"},{"location":"reference/desktop-extensions/#installation-mechanism","title":"Installation Mechanism","text":""},{"location":"reference/desktop-extensions/#claude-desktop-gui","title":"Claude Desktop GUI","text":"<p>Double-click a <code>.mcpb</code> file or use File &gt; Install Extension in Claude Desktop.</p>"},{"location":"reference/desktop-extensions/#cli-himalaya-mcp","title":"CLI (himalaya-mcp)","text":"<pre><code>himalaya-mcp install-ext himalaya-mcp-v1.4.0.mcpb   # Install\nhimalaya-mcp remove-ext                               # Uninstall\n</code></pre>"},{"location":"reference/desktop-extensions/#what-install-does","title":"What Install Does","text":"<ol> <li>Unpacks the .mcpb to <code>~/Library/Application Support/Claude/Claude Extensions/&lt;id&gt;/</code></li> <li>Registers in <code>extensions-installations.json</code> with id, version, SHA256 hash, timestamp, full manifest, signature status, and source</li> <li>Creates settings in <code>Claude Extensions Settings/&lt;id&gt;.json</code> with <code>isEnabled: true</code> and empty <code>userConfig</code></li> <li>Restart required \u2014 Claude Desktop reads extensions on startup</li> </ol>"},{"location":"reference/desktop-extensions/#installation-files","title":"Installation Files","text":"File Purpose <code>Claude Extensions/&lt;id&gt;/manifest.json</code> Extension manifest <code>Claude Extensions/&lt;id&gt;/dist/index.js</code> Server bundle <code>extensions-installations.json</code> Registry of all installed extensions <code>Claude Extensions Settings/&lt;id&gt;.json</code> Per-extension settings (enabled, userConfig)"},{"location":"reference/desktop-extensions/#registry-entry-format","title":"Registry Entry Format","text":"<pre><code>{\n  \"extensions\": {\n    \"himalaya-mcp\": {\n      \"id\": \"himalaya-mcp\",\n      \"version\": \"1.3.0\",\n      \"hash\": \"f099...\",\n      \"installedAt\": \"2026-02-17T06:33:25.366Z\",\n      \"manifest\": { /* full manifest.json content */ },\n      \"signatureInfo\": { \"status\": \"unsigned\" },\n      \"source\": \"local\"\n    }\n  }\n}\n</code></pre> <p>Source values: <code>\"registry\"</code> (from Anthropic registry), <code>\"local\"</code> (manual install).</p>"},{"location":"reference/desktop-extensions/#settings-file-format","title":"Settings File Format","text":"<pre><code>{\n  \"isEnabled\": true,\n  \"userConfig\": {\n    \"himalaya_binary\": \"/opt/homebrew/bin/himalaya\",\n    \"himalaya_account\": \"work\"\n  }\n}\n</code></pre>"},{"location":"reference/desktop-extensions/#build-pipeline-himalaya-mcp","title":"Build Pipeline (himalaya-mcp)","text":"<pre><code>src/index.ts (16 source files)\n    \u2502\n    \u251c\u2500\u2500 npm run build:bundle    \u2192  dist/index.js (595 KB, esbuild)\n    \u2502\n    \u251c\u2500\u2500 copy to mcpb/dist/      \u2192  mcpb/dist/index.js\n    \u2502\n    \u251c\u2500\u2500 mcpb validate mcpb/     \u2192  Schema check\n    \u2502\n    \u2514\u2500\u2500 mcpb pack mcpb/         \u2192  himalaya-mcp-v1.4.0.mcpb (147 KB)\n</code></pre> <p>Run: <code>npm run build:mcpb</code></p>"},{"location":"reference/desktop-extensions/#whats-in-the-mcpb","title":"What's in the .mcpb","text":"File Size Purpose <code>manifest.json</code> 6.3 KB Extension descriptor <code>dist/index.js</code> 595.3 KB esbuild bundle (all deps inlined) Total (compressed) ~147 KB ZIP archive"},{"location":"reference/desktop-extensions/#signing","title":"Signing","text":"<p>Extensions can be signed for authenticity verification. himalaya-mcp is currently unsigned (open source, distributed via GitHub Releases).</p> <pre><code>mcpb sign himalaya-mcp-v1.4.0.mcpb --key private.pem\nmcpb verify himalaya-mcp-v1.4.0.mcpb --key public.pem\n</code></pre>"},{"location":"reference/desktop-extensions/#cicd-integration","title":"CI/CD Integration","text":""},{"location":"reference/desktop-extensions/#ci-validation-githubworkflowsciyml","title":"CI Validation (.github/workflows/ci.yml)","text":"<pre><code>validate-mcpb:\n  runs-on: ubuntu-latest\n  steps:\n    - uses: actions/checkout@v4\n    - uses: actions/setup-node@v4\n      with: { node-version: 22, cache: npm }\n    - run: npm ci\n    - run: npx --yes @anthropic-ai/mcpb validate mcpb/\n    - run: npm run build:mcpb\n    - run: |\n        MCPB_FILE=$(ls himalaya-mcp-v*.mcpb 2&gt;/dev/null | head -1)\n        test -f \"$MCPB_FILE\" &amp;&amp; echo \"MCPB OK: $MCPB_FILE\"\n</code></pre>"},{"location":"reference/desktop-extensions/#release-upload-githubworkflowshomebrew-releaseyml","title":"Release Upload (.github/workflows/homebrew-release.yml)","text":"<p>The <code>.mcpb</code> is built during the release validation job and uploaded to the GitHub Release as an artifact.</p>"},{"location":"reference/desktop-extensions/#comparison-mcpservers-vs-extensions","title":"Comparison: mcpServers vs Extensions","text":"Aspect mcpServers (legacy) .mcpb Extension Config file <code>claude_desktop_config.json</code> <code>Claude Extensions/</code> directory Setup Manual JSON editing or <code>himalaya-mcp setup</code> Double-click .mcpb or <code>install-ext</code> User config Environment variables GUI settings panel Discovery Manual Extension gallery Updates Manual Extension update mechanism CLI <code>himalaya-mcp setup</code> <code>himalaya-mcp install-ext</code> <p>Both approaches work simultaneously. The extension approach is recommended for new installations.</p>"},{"location":"reference/mcpb-format-reference/","title":"Claude Desktop Extensions (.mcpb) Technical Reference","text":"<p>Last Updated: 2026-02-16 Spec Version: manifest_version 0.3 CLI Version: @anthropic-ai/mcpb 2.1.2</p> <p>Point-in-time snapshot</p> <p>This is a snapshot of the <code>.mcpb</code> format as of the date above. The canonical spec lives in the modelcontextprotocol/mcpb repository. Check upstream for the latest schema changes.</p>"},{"location":"reference/mcpb-format-reference/#table-of-contents","title":"Table of Contents","text":"<ol> <li>What Are .mcpb Files?</li> <li>History: .dxt to .mcpb Rename</li> <li>Bundle Structure</li> <li>manifest.json Schema</li> <li>manifest_version History</li> <li>Server Configuration</li> <li>Template Variables</li> <li>user_config Field Types</li> <li>Tools, Prompts, and Resources</li> <li>Compatibility</li> <li>.mcpbignore Syntax</li> <li>CLI Commands</li> <li>Signing and Verification</li> <li>Installation Mechanism</li> <li>Build Pipeline</li> <li>Registry vs Local Installation</li> <li>Localization</li> <li>Real-World Examples</li> <li>References</li> </ol>"},{"location":"reference/mcpb-format-reference/#1-what-are-mcpb-files","title":"1. What Are .mcpb Files?","text":"<p>MCP Bundles (<code>.mcpb</code>) are ZIP archives containing a local MCP server and a <code>manifest.json</code> that describes the server and its capabilities. They are spiritually similar to Chrome extensions (<code>.crx</code>) or VS Code extensions (<code>.vsix</code>), enabling end users to install local MCP servers with a single click.</p> <p>Key characteristics:</p> <ul> <li>Format: Standard ZIP archive with <code>.mcpb</code> extension</li> <li>Required file: Only <code>manifest.json</code> is mandatory</li> <li>Transports: stdio (standard input/output between Claude and the server)</li> <li>Runtimes: Node.js (recommended, ships with Claude Desktop), Python, UV (experimental), or standalone binaries</li> <li>Platforms: macOS (darwin), Windows (win32), Linux (linux)</li> <li>Package: <code>@anthropic-ai/mcpb</code> on npm</li> </ul> <p>The format is open-source and designed for cross-client adoption. Any AI desktop application can support .mcpb bundles, not just Claude Desktop.</p>"},{"location":"reference/mcpb-format-reference/#2-history-dxt-to-mcpb-rename","title":"2. History: .dxt to .mcpb Rename","text":""},{"location":"reference/mcpb-format-reference/#timeline","title":"Timeline","text":"Date Event ~Mid 2025 Anthropic introduces Desktop Extensions with <code>.dxt</code> file format 2025-09-11 Format renamed from <code>.dxt</code> to <code>.mcpb</code> (MCP Bundle) 2025-11-20 Format moved to Model Context Protocol open-source project Current <code>@anthropic-ai/mcpb</code> CLI v2.1.2, manifest_version 0.3"},{"location":"reference/mcpb-format-reference/#what-changed","title":"What Changed","text":"Before After <code>.dxt</code> file extension <code>.mcpb</code> file extension <code>@anthropic-ai/dxt</code> npm package <code>@anthropic-ai/mcpb</code> npm package <code>dxt</code> CLI command <code>mcpb</code> CLI command <code>dxt_version</code> manifest field <code>manifest_version</code> manifest field Anthropic-internal spec Open-source at <code>modelcontextprotocol/mcpb</code>"},{"location":"reference/mcpb-format-reference/#what-stayed-the-same","title":"What Stayed the Same","text":"<ul> <li>All functionality, schema fields, and capabilities are identical</li> <li>Existing <code>.dxt</code> files continue to work in Claude Desktop</li> <li>Same ZIP-based archive format</li> <li>Same installation UX (double-click, drag-and-drop, menu install)</li> </ul>"},{"location":"reference/mcpb-format-reference/#migration","title":"Migration","text":"<p>This was a naming change only. The <code>dxt_version</code> field in older manifests is still accepted. New extensions should use <code>manifest_version</code> and the <code>.mcpb</code> extension.</p>"},{"location":"reference/mcpb-format-reference/#3-bundle-structure","title":"3. Bundle Structure","text":""},{"location":"reference/mcpb-format-reference/#minimal-bundle-manifest-only","title":"Minimal Bundle (manifest only)","text":"<pre><code>my-server.mcpb (ZIP)\n\u2514\u2500\u2500 manifest.json          # Required: metadata + server config\n</code></pre>"},{"location":"reference/mcpb-format-reference/#nodejs-bundle","title":"Node.js Bundle","text":"<pre><code>my-server.mcpb (ZIP)\n\u251c\u2500\u2500 manifest.json          # Required\n\u251c\u2500\u2500 dist/\n\u2502   \u2514\u2500\u2500 index.js           # Bundled server (esbuild/webpack)\n\u251c\u2500\u2500 node_modules/          # Or bundle deps into index.js\n\u251c\u2500\u2500 icon.png               # Optional: 512x512 recommended, 256x256 minimum\n\u2514\u2500\u2500 assets/                # Optional: screenshots, icons\n</code></pre>"},{"location":"reference/mcpb-format-reference/#python-bundle","title":"Python Bundle","text":"<pre><code>my-server.mcpb (ZIP)\n\u251c\u2500\u2500 manifest.json\n\u251c\u2500\u2500 server/\n\u2502   \u251c\u2500\u2500 main.py\n\u2502   \u2514\u2500\u2500 utils.py\n\u251c\u2500\u2500 lib/                   # Bundled pip packages\n\u2514\u2500\u2500 requirements.txt\n</code></pre>"},{"location":"reference/mcpb-format-reference/#binary-bundle","title":"Binary Bundle","text":"<pre><code>my-server.mcpb (ZIP)\n\u251c\u2500\u2500 manifest.json\n\u251c\u2500\u2500 server/\n\u2502   \u251c\u2500\u2500 my-server          # Unix executable\n\u2502   \u2514\u2500\u2500 my-server.exe      # Windows executable\n\u2514\u2500\u2500 icon.png\n</code></pre>"},{"location":"reference/mcpb-format-reference/#uv-bundle-experimental-v04","title":"UV Bundle (Experimental, v0.4+)","text":"<pre><code>my-server.mcpb (ZIP)\n\u251c\u2500\u2500 manifest.json          # server.type = \"uv\"\n\u251c\u2500\u2500 server/\n\u2502   \u2514\u2500\u2500 main.py\n\u2514\u2500\u2500 pyproject.toml         # Dependencies (no bundled packages needed)\n</code></pre>"},{"location":"reference/mcpb-format-reference/#4-manifestjson-schema","title":"4. manifest.json Schema","text":""},{"location":"reference/mcpb-format-reference/#required-fields","title":"Required Fields","text":"Field Type Description <code>manifest_version</code> <code>string</code> Spec version. Current: <code>\"0.3\"</code>. Legacy: <code>dxt_version</code> still accepted. <code>name</code> <code>string</code> Machine-readable identifier for CLI/APIs <code>version</code> <code>string</code> Semantic version (e.g., <code>\"1.2.1\"</code>) <code>description</code> <code>string</code> Brief description (localizable) <code>author</code> <code>object</code> <code>{ name: string (required), email?: string, url?: string }</code> <code>server</code> <code>object</code> Server configuration (see Section 6)"},{"location":"reference/mcpb-format-reference/#optional-display-metadata-fields","title":"Optional Display &amp; Metadata Fields","text":"Field Type Description <code>display_name</code> <code>string</code> Human-friendly name for UI (localizable) <code>long_description</code> <code>string</code> Detailed markdown description (localizable) <code>icon</code> <code>string</code> Path to PNG icon or HTTPS URL <code>icons</code> <code>array</code> Icon variants: <code>[{ src, size, theme? }]</code> <code>screenshots</code> <code>array</code> Screenshot image paths <code>keywords</code> <code>array&lt;string&gt;</code> Search/discovery keywords (localizable) <code>license</code> <code>string</code> License identifier (e.g., <code>\"MIT\"</code>)"},{"location":"reference/mcpb-format-reference/#optional-link-fields","title":"Optional Link Fields","text":"Field Type Description <code>repository</code> <code>object</code> <code>{ type: \"git\", url: string }</code> <code>homepage</code> <code>string</code> Homepage URL <code>documentation</code> <code>string</code> Documentation URL <code>support</code> <code>string</code> Support/issues URL"},{"location":"reference/mcpb-format-reference/#optional-feature-fields","title":"Optional Feature Fields","text":"Field Type Default Description <code>tools</code> <code>array</code> <code>[]</code> Static tool declarations <code>tools_generated</code> <code>boolean</code> <code>false</code> Server generates additional tools at runtime <code>prompts</code> <code>array</code> <code>[]</code> Static prompt declarations <code>prompts_generated</code> <code>boolean</code> <code>false</code> Server generates additional prompts at runtime <code>resources_generated</code> <code>boolean</code> <code>false</code> Server generates resources at runtime"},{"location":"reference/mcpb-format-reference/#optional-configuration-fields","title":"Optional Configuration Fields","text":"Field Type Description <code>user_config</code> <code>object</code> User-configurable fields (see Section 8) <code>compatibility</code> <code>object</code> Platform/runtime requirements (see Section 10) <code>localization</code> <code>object</code> Locale resources config (see Section 17) <code>privacy_policies</code> <code>array&lt;string&gt;</code> URLs to privacy policies for external services <code>_meta</code> <code>object</code> Platform-specific metadata (reverse-DNS keys)"},{"location":"reference/mcpb-format-reference/#icons-array-schema","title":"Icons Array Schema","text":"<pre><code>\"icons\": [\n  { \"src\": \"assets/icon-16-light.png\", \"size\": \"16x16\", \"theme\": \"light\" },\n  { \"src\": \"assets/icon-16-dark.png\",  \"size\": \"16x16\", \"theme\": \"dark\" },\n  { \"src\": \"assets/icon-512.png\",      \"size\": \"512x512\" }\n]\n</code></pre> <ul> <li><code>src</code> (string, required): Path relative to bundle root</li> <li><code>size</code> (string, required): Format <code>\"WxH\"</code> (e.g., <code>\"16x16\"</code>, <code>\"512x512\"</code>)</li> <li><code>theme</code> (string, optional): <code>\"light\"</code> or <code>\"dark\"</code></li> </ul>"},{"location":"reference/mcpb-format-reference/#5-manifest_version-history","title":"5. manifest_version History","text":"Version Key Name Notes <code>\"0.1\"</code> <code>dxt_version</code> Original release. Used by early .dxt extensions. Still accepted by Claude Desktop for backward compatibility. <code>\"0.2\"</code> <code>manifest_version</code> Introduced <code>manifest_version</code> field name (replacing <code>dxt_version</code>). Used by Anthropic's Filesystem extension. <code>\"0.3\"</code> <code>manifest_version</code> Current version. Adds <code>resources_generated</code>, <code>long_description</code>, <code>privacy_policies</code>, <code>_meta</code>, expanded <code>user_config</code> types, <code>localization</code> support. Used by Anthropic's PowerPoint, Word extensions and third-party extensions. <p>The version field is intentionally low (\"we are looking forward to working with the greater community on evolving and changing the format\"). Extensions using <code>dxt_version: \"0.1\"</code> continue to work without modification.</p>"},{"location":"reference/mcpb-format-reference/#6-server-configuration","title":"6. Server Configuration","text":"<pre><code>\"server\": {\n  \"type\": \"node\",\n  \"entry_point\": \"dist/index.js\",\n  \"mcp_config\": {\n    \"command\": \"node\",\n    \"args\": [\"${__dirname}/dist/index.js\"],\n    \"env\": {\n      \"API_KEY\": \"${user_config.api_key}\",\n      \"HOME\": \"${HOME}\"\n    }\n  }\n}\n</code></pre>"},{"location":"reference/mcpb-format-reference/#server-types","title":"Server Types","text":"Type Runtime Notes <code>\"node\"</code> Node.js Recommended. Node.js ships with Claude Desktop. <code>\"python\"</code> Python Must bundle deps in <code>lib/</code> or <code>venv/</code>. Cannot portably bundle compiled deps (e.g., pydantic). <code>\"uv\"</code> UV (experimental, v0.4+) Uses <code>pyproject.toml</code> for deps. Host manages Python and deps automatically. <code>\"binary\"</code> Standalone executable Static linking preferred. Include platform-specific binaries."},{"location":"reference/mcpb-format-reference/#mcp_config-fields","title":"mcp_config Fields","text":"Field Type Description <code>command</code> <code>string</code> Executable to run (e.g., <code>\"node\"</code>, <code>\"python3\"</code>, <code>\"${__dirname}/server/my-binary\"</code>) <code>args</code> <code>array&lt;string&gt;</code> Command arguments. Supports <code>${__dirname}</code> and <code>${user_config.*}</code> substitution. <code>env</code> <code>object</code> Environment variables. Supports <code>${user_config.*}</code>, <code>${HOME}</code>, <code>${__dirname}</code> substitution."},{"location":"reference/mcpb-format-reference/#entry-point","title":"Entry Point","text":"<p>The <code>entry_point</code> field specifies the main server file relative to the bundle root. It serves as documentation and for validation; the actual execution is determined by <code>mcp_config.command</code> and <code>mcp_config.args</code>.</p>"},{"location":"reference/mcpb-format-reference/#7-template-variables","title":"7. Template Variables","text":"<p>Template variables use <code>${variable}</code> syntax and are resolved at runtime by Claude Desktop when launching the MCP server.</p> Variable Expands To Usable In <code>${__dirname}</code> Absolute path to the extension's installation directory <code>mcp_config.args</code>, <code>mcp_config.env</code> <code>${user_config.&lt;key&gt;}</code> Value the user entered for the named config field <code>mcp_config.args</code>, <code>mcp_config.env</code> <code>${HOME}</code> User's home directory (e.g., <code>/Users/dt</code>) <code>mcp_config.env</code>, <code>user_config[].default</code> <code>${arguments.&lt;name&gt;}</code> Prompt argument value (for prompts only) <code>prompts[].text</code>"},{"location":"reference/mcpb-format-reference/#examples","title":"Examples","text":"<pre><code>\"args\": [\"${__dirname}/dist/index.js\"]\n// Resolves to: /Users/dt/Library/Application Support/Claude/Claude Extensions/my-ext/dist/index.js\n\n\"env\": {\n  \"BINARY\": \"${user_config.binary_path}\",\n  \"ACCOUNT\": \"${user_config.account_name}\"\n}\n// Resolves to user-provided values from the settings UI\n\n\"default\": [\"${HOME}/Desktop\"]\n// Resolves to: /Users/dt/Desktop\n</code></pre>"},{"location":"reference/mcpb-format-reference/#behavior-with-empty-optional-config","title":"Behavior with Empty Optional Config","text":"<p>When a <code>user_config</code> field is optional and the user leaves it empty, the variable resolves to an empty string <code>\"\"</code>. Server code should handle this gracefully (e.g., fall back to defaults when the env var is empty).</p>"},{"location":"reference/mcpb-format-reference/#8-user_config-field-types","title":"8. user_config Field Types","text":"<p>The <code>user_config</code> object defines fields that Claude Desktop renders as a settings UI. Users must fill in required fields before the extension activates. Sensitive values are stored in the OS keychain.</p>"},{"location":"reference/mcpb-format-reference/#field-types","title":"Field Types","text":""},{"location":"reference/mcpb-format-reference/#string-text-input","title":"<code>string</code> - Text Input","text":"<pre><code>\"api_key\": {\n  \"type\": \"string\",\n  \"title\": \"API Key\",\n  \"description\": \"Your API key for the service\",\n  \"sensitive\": true,\n  \"required\": true\n}\n</code></pre> <pre><code>\"account_name\": {\n  \"type\": \"string\",\n  \"title\": \"Account Name\",\n  \"description\": \"Default account to use\",\n  \"default\": \"personal\",\n  \"required\": false\n}\n</code></pre>"},{"location":"reference/mcpb-format-reference/#number-numeric-input","title":"<code>number</code> - Numeric Input","text":"<pre><code>\"max_file_size\": {\n  \"type\": \"number\",\n  \"title\": \"Maximum File Size (MB)\",\n  \"description\": \"Maximum file size to process\",\n  \"default\": 10,\n  \"min\": 1,\n  \"max\": 100,\n  \"required\": false\n}\n</code></pre>"},{"location":"reference/mcpb-format-reference/#boolean-toggle","title":"<code>boolean</code> - Toggle","text":"<pre><code>\"verbose_logging\": {\n  \"type\": \"boolean\",\n  \"title\": \"Verbose Logging\",\n  \"description\": \"Enable detailed logging output\",\n  \"default\": false\n}\n</code></pre>"},{"location":"reference/mcpb-format-reference/#file-file-path-picker","title":"<code>file</code> - File Path Picker","text":"<pre><code>\"binary_path\": {\n  \"type\": \"file\",\n  \"title\": \"Binary Path\",\n  \"description\": \"Path to the CLI binary\",\n  \"required\": false\n}\n</code></pre>"},{"location":"reference/mcpb-format-reference/#directory-directory-path-picker","title":"<code>directory</code> - Directory Path Picker","text":"<pre><code>\"allowed_directories\": {\n  \"type\": \"directory\",\n  \"title\": \"Allowed Directories\",\n  \"description\": \"Directories the server can access\",\n  \"multiple\": true,\n  \"required\": true,\n  \"default\": [\"${HOME}/Desktop\"]\n}\n</code></pre>"},{"location":"reference/mcpb-format-reference/#common-properties-all-types","title":"Common Properties (All Types)","text":"Property Type Default Description <code>type</code> <code>string</code> (required) One of: <code>\"string\"</code>, <code>\"number\"</code>, <code>\"boolean\"</code>, <code>\"file\"</code>, <code>\"directory\"</code> <code>title</code> <code>string</code> - UI label displayed to the user <code>description</code> <code>string</code> - Help text / tooltip <code>required</code> <code>boolean</code> <code>false</code> Whether the user must provide a value before the extension activates <code>default</code> <code>varies</code> - Default value (type must match field type) <code>sensitive</code> <code>boolean</code> <code>false</code> If true, value is masked in UI and stored in OS keychain <code>multiple</code> <code>boolean</code> <code>false</code> If true, allows multiple values (renders as array). Applies to <code>file</code>, <code>directory</code>, <code>string</code>."},{"location":"reference/mcpb-format-reference/#number-specific-properties","title":"Number-Specific Properties","text":"Property Type Description <code>min</code> <code>number</code> Minimum allowed value <code>max</code> <code>number</code> Maximum allowed value"},{"location":"reference/mcpb-format-reference/#sensitive-data-handling","title":"Sensitive Data Handling","text":"<p>When <code>sensitive: true</code>: - The value is masked (dots/asterisks) in the settings UI - The value is stored in the OS keychain (macOS Keychain, Windows Credential Manager) - The value is never written to disk in plaintext - The value is injected via environment variable at server launch time</p>"},{"location":"reference/mcpb-format-reference/#9-tools-prompts-and-resources","title":"9. Tools, Prompts, and Resources","text":""},{"location":"reference/mcpb-format-reference/#static-tool-declaration","title":"Static Tool Declaration","text":"<pre><code>\"tools\": [\n  {\n    \"name\": \"search_files\",\n    \"description\": \"Search for files in a directory\"\n  },\n  {\n    \"name\": \"read_file\",\n    \"description\": \"Read the contents of a file\"\n  }\n]\n</code></pre> <p>Each tool object has: - <code>name</code> (string, required): Tool identifier - <code>description</code> (string, required, localizable): What the tool does</p> <p>Tool declarations serve as metadata for the extension directory/marketplace. The actual tool schemas (parameters, return types) are defined in the MCP server code and discovered via the MCP <code>tools/list</code> method at runtime.</p>"},{"location":"reference/mcpb-format-reference/#static-prompt-declaration","title":"Static Prompt Declaration","text":"<pre><code>\"prompts\": [\n  {\n    \"name\": \"triage_inbox\",\n    \"description\": \"Classify emails as actionable, FYI, or skip\",\n    \"arguments\": [\"count\"],\n    \"text\": \"Triage my recent emails. For each, classify as Actionable, FYI, or Skip.\"\n  }\n]\n</code></pre> <p>Each prompt object has: - <code>name</code> (string, required): Prompt identifier - <code>description</code> (string, required, localizable): What the prompt does - <code>arguments</code> (array, optional): Named arguments - <code>text</code> (string, optional): Template text (supports <code>${arguments.&lt;name&gt;}</code>)"},{"location":"reference/mcpb-format-reference/#dynamic-generation-flags","title":"Dynamic Generation Flags","text":"Flag Default Effect <code>tools_generated</code> <code>false</code> When <code>true</code>, tells the client that the server may register additional tools at runtime beyond those listed in <code>tools[]</code>. Client should call <code>tools/list</code> to discover all tools. <code>prompts_generated</code> <code>false</code> When <code>true</code>, server may register additional prompts at runtime. Client should call <code>prompts/list</code>. <code>resources_generated</code> <code>false</code> When <code>true</code>, server provides resources at runtime. Client should call <code>resources/list</code>. <p>These flags do NOT replace static declarations. Use both: static declarations for the marketplace/directory, and <code>*_generated: true</code> if the server also creates tools/prompts/resources dynamically.</p>"},{"location":"reference/mcpb-format-reference/#10-compatibility","title":"10. Compatibility","text":"<pre><code>\"compatibility\": {\n  \"claude_desktop\": \"&gt;=1.0.0\",\n  \"platforms\": [\"darwin\", \"win32\"],\n  \"runtimes\": {\n    \"node\": \"&gt;=22.0.0\"\n  }\n}\n</code></pre>"},{"location":"reference/mcpb-format-reference/#client-version-constraints","title":"Client Version Constraints","text":"<p>Any key in <code>compatibility</code> (other than <code>platforms</code> and <code>runtimes</code>) is treated as a client name with a semver constraint:</p> <pre><code>\"claude_desktop\": \"&gt;=1.0.0\",\n\"my_client\": \"&gt;1.0.0\",\n\"other_client\": \"&gt;=2.0.0 &lt;3.0.0\"\n</code></pre> <p>Supported semver patterns: <code>&gt;=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>^</code>, <code>~</code>, ranges with spaces.</p>"},{"location":"reference/mcpb-format-reference/#platform-values","title":"Platform Values","text":"Value Platform <code>\"darwin\"</code> macOS <code>\"win32\"</code> Windows <code>\"linux\"</code> Linux <p>Maps to Node.js <code>process.platform</code> values.</p>"},{"location":"reference/mcpb-format-reference/#runtime-constraints","title":"Runtime Constraints","text":"<p>Only specify the runtimes your extension actually uses:</p> <pre><code>\"runtimes\": {\n  \"node\": \"&gt;=16.0.0\"      // For Node.js servers\n}\n</code></pre> <pre><code>\"runtimes\": {\n  \"python\": \"&gt;=3.8\"       // For Python servers\n}\n</code></pre>"},{"location":"reference/mcpb-format-reference/#11-mcpbignore-syntax","title":"11. .mcpbignore Syntax","text":"<p>Create a <code>.mcpbignore</code> file in your bundle directory to exclude files from the packed <code>.mcpb</code> archive. The syntax is similar to <code>.gitignore</code>.</p>"},{"location":"reference/mcpb-format-reference/#default-exclusions-always-applied","title":"Default Exclusions (Always Applied)","text":"<p>The <code>mcpb pack</code> command automatically excludes:</p> <pre><code>.DS_Store\nThumbs.db\n.gitignore\n.git/\n*.log\nnpm-debug.log*\nyarn-debug.log*\nyarn-error.log*\n.npm/\n.npmrc\n.yarnrc\n.yarn/\n.pnp.*\nnode_modules/.cache/\nnode_modules/.bin/\n*.map\n.env.local\n.env.*.local\npackage-lock.json\nyarn.lock\n</code></pre>"},{"location":"reference/mcpb-format-reference/#custom-mcpbignore-example","title":"Custom .mcpbignore Example","text":"<pre><code># Comments start with #\n# Empty lines are ignored\n\n# Test files\n*.test.js\n*.test.ts\n*.spec.js\n__tests__/\ncoverage/\n\n# Source (if bundling to dist/)\nsrc/\ntsconfig.json\n\n# Dev dependencies\n.eslintrc*\n.prettierrc*\nvitest.config.*\n\n# Documentation\ndocs/\n*.md\n!README.md\n\n# Environment\n.env*\ntemp/\n</code></pre>"},{"location":"reference/mcpb-format-reference/#supported-patterns","title":"Supported Patterns","text":"Pattern Meaning <code>filename.txt</code> Exact filename match <code>*.log</code> Simple glob (any .log file) <code>temp/*</code> Everything inside temp/ <code>docs/</code> Entire directory <code>**/*.test.ts</code> Recursive glob <code># comment</code> Comment line (ignored) (empty line) Ignored"},{"location":"reference/mcpb-format-reference/#12-cli-commands","title":"12. CLI Commands","text":"<p>Install: <code>npm install -g @anthropic-ai/mcpb</code></p> <p>Or use via npx: <code>npx @anthropic-ai/mcpb &lt;command&gt;</code></p>"},{"location":"reference/mcpb-format-reference/#mcpb-init-directory","title":"mcpb init [directory]","text":"<p>Creates a new manifest.json interactively.</p> <pre><code>mcpb init                    # Current directory\nmcpb init my-extension/      # Specific directory\n</code></pre> <p>Prompts for: name, author, display name, version, description, server type, entry point, tools, keywords, license, repository.</p>"},{"location":"reference/mcpb-format-reference/#mcpb-validate-path","title":"mcpb validate \\&lt;path&gt;","text":"<p>Validates manifest.json against the schema.</p> <pre><code>mcpb validate manifest.json       # Direct file path\nmcpb validate ./my-extension      # Directory containing manifest.json\nmcpb validate .                   # Current directory\n</code></pre> <p>Returns success or lists validation errors.</p>"},{"location":"reference/mcpb-format-reference/#mcpb-pack-directory-output","title":"mcpb pack [directory] [output]","text":"<p>Packs a directory into a .mcpb file. Validates manifest first, excludes dev files, applies .mcpbignore, creates ZIP with maximum compression.</p> <pre><code>mcpb pack .                                    # Pack current dir\nmcpb pack my-extension/                        # Pack specific dir\nmcpb pack my-extension/ my-ext-v1.0.mcpb       # Custom output name\n</code></pre>"},{"location":"reference/mcpb-format-reference/#mcpb-clean-mcpb","title":"mcpb clean \\&lt;mcpb&gt;","text":"<p>Cleans an existing .mcpb file: validates the manifest, removes unnecessary files, and minimizes bundle size.</p> <pre><code>mcpb clean my-extension.mcpb\n</code></pre>"},{"location":"reference/mcpb-format-reference/#mcpb-unpack-mcpb-file-output","title":"mcpb unpack \\&lt;mcpb-file&gt; [output]","text":"<p>Extracts a .mcpb file to a directory.</p> <pre><code>mcpb unpack my-extension.mcpb                  # Extract to current dir\nmcpb unpack my-extension.mcpb ./extracted/     # Extract to specific dir\n</code></pre>"},{"location":"reference/mcpb-format-reference/#mcpb-info-mcpb-file","title":"mcpb info \\&lt;mcpb-file&gt;","text":"<p>Displays metadata about a packed .mcpb file: name, version, description, file size, signature status, certificate details.</p> <pre><code>mcpb info my-extension.mcpb\n</code></pre>"},{"location":"reference/mcpb-format-reference/#mcpb-sign-mcpb-file","title":"mcpb sign \\&lt;mcpb-file&gt;","text":"<p>Signs a .mcpb file with a certificate.</p> <pre><code>mcpb sign my-ext.mcpb                                    # Default cert.pem/key.pem\nmcpb sign my-ext.mcpb --cert /path/cert.pem --key /path/key.pem\nmcpb sign my-ext.mcpb --self-signed                      # Generate self-signed cert\nmcpb sign my-ext.mcpb --cert c.pem --key k.pem --intermediate inter.pem root.pem\n</code></pre> <p>Options: - <code>--cert, -c</code> : Certificate file path (PEM format, default: <code>cert.pem</code>) - <code>--key, -k</code> : Private key file path (PEM format, default: <code>key.pem</code>) - <code>--intermediate, -i</code> : Intermediate certificate file paths - <code>--self-signed</code> : Create and use a self-signed certificate</p>"},{"location":"reference/mcpb-format-reference/#mcpb-verify-mcpb-file","title":"mcpb verify \\&lt;mcpb-file&gt;","text":"<p>Verifies the signature of a signed .mcpb file.</p> <pre><code>mcpb verify my-extension.mcpb\n</code></pre> <p>Output includes: signature validity, certificate subject/issuer, validity dates, fingerprint, self-signed warning.</p>"},{"location":"reference/mcpb-format-reference/#mcpb-unsign-mcpb-file","title":"mcpb unsign \\&lt;mcpb-file&gt;","text":"<p>Removes the signature block from a .mcpb file (for development/testing).</p> <pre><code>mcpb unsign my-extension.mcpb\n</code></pre>"},{"location":"reference/mcpb-format-reference/#13-signing-and-verification","title":"13. Signing and Verification","text":""},{"location":"reference/mcpb-format-reference/#signature-format","title":"Signature Format","text":"<p>MCPB uses PKCS#7 (Cryptographic Message Syntax) for digital signatures. The signature is appended to the ZIP content with boundary markers:</p> <pre><code>[Original MCPB ZIP content]\nMCPB_SIG_V1\n[Base64-encoded PKCS#7 signature]\nMCPB_SIG_END\n</code></pre> <p>This design provides: - Backward compatibility: Unsigned .mcpb files are valid ZIP files - Non-destructive: Original ZIP content is unmodified - Detached format: Signature can be added/removed independently</p>"},{"location":"reference/mcpb-format-reference/#certificate-requirements","title":"Certificate Requirements","text":"<p>For signing, you need:</p> <ol> <li>Certificate: X.509 in PEM format, ideally with Code Signing extended key usage</li> <li>Private Key: Corresponding private key in PEM format</li> <li>Intermediate Certificates (optional): For CA-issued certificates, required for chain validation</li> </ol>"},{"location":"reference/mcpb-format-reference/#signing-tiers","title":"Signing Tiers","text":"Tier Command Trust Level Unsigned (no signing) Lowest. User must manually approve. Self-signed <code>mcpb sign --self-signed</code> Development/testing only. Warns user. CA-signed <code>mcpb sign --cert ... --key ...</code> Production. Full trust chain."},{"location":"reference/mcpb-format-reference/#14-installation-mechanism","title":"14. Installation Mechanism","text":""},{"location":"reference/mcpb-format-reference/#installation-methods","title":"Installation Methods","text":"<ol> <li>Double-click the <code>.mcpb</code> file (file association with Claude Desktop)</li> <li>Drag-and-drop the <code>.mcpb</code> file into the Claude Desktop window</li> <li>Menu: Developer &gt; Extensions &gt; Install Extension</li> </ol> <p>All methods open a review UI where the user can see the extension name, description, author, tools, and configure <code>user_config</code> fields.</p>"},{"location":"reference/mcpb-format-reference/#on-disk-layout-macos","title":"On-Disk Layout (macOS)","text":"<pre><code>~/Library/Application Support/Claude/\n\u251c\u2500\u2500 Claude Extensions/                          # Extracted extensions\n\u2502   \u251c\u2500\u2500 my-extension/\n\u2502   \u2502   \u251c\u2500\u2500 manifest.json\n\u2502   \u2502   \u251c\u2500\u2500 dist/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 index.js\n\u2502   \u2502   \u2514\u2500\u2500 icon.png\n\u2502   \u251c\u2500\u2500 ant.dir.ant.anthropic.filesystem/       # Anthropic first-party\n\u2502   \u2502   \u251c\u2500\u2500 manifest.json\n\u2502   \u2502   \u251c\u2500\u2500 server/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 index.js\n\u2502   \u2502   \u251c\u2500\u2500 node_modules/\n\u2502   \u2502   \u2514\u2500\u2500 icon.png\n\u2502   \u2514\u2500\u2500 context7/                               # Third-party\n\u2502       \u251c\u2500\u2500 manifest.json\n\u2502       \u251c\u2500\u2500 dist/\n\u2502       \u2502   \u2514\u2500\u2500 index.js\n\u2502       \u2514\u2500\u2500 icon.png\n\u251c\u2500\u2500 Claude Extensions Settings/                 # Per-extension settings\n\u2502   \u251c\u2500\u2500 my-extension.json                       # { isEnabled, userConfig }\n\u2502   \u251c\u2500\u2500 ant.dir.ant.anthropic.filesystem.json\n\u2502   \u2514\u2500\u2500 context7.json\n\u251c\u2500\u2500 extensions-installations.json               # Installation registry\n\u2514\u2500\u2500 extensions-blocklist.json                   # Enterprise blocklist\n</code></pre>"},{"location":"reference/mcpb-format-reference/#extension-settings-file-format","title":"Extension Settings File Format","text":"<p>Each extension gets a settings file in <code>Claude Extensions Settings/</code>:</p> <pre><code>{\n  \"isEnabled\": true,\n  \"userConfig\": {\n    \"allowed_directories\": [\n      \"/Users/dt/projects\",\n      \"/Users/dt/.config\"\n    ]\n  }\n}\n</code></pre> <ul> <li><code>isEnabled</code> (boolean): Whether the extension is currently active</li> <li><code>userConfig</code> (object): User-provided values for <code>user_config</code> fields</li> </ul> <p>When an extension has no user config, the file is minimal:</p> <pre><code>{\n  \"isEnabled\": true\n}\n</code></pre>"},{"location":"reference/mcpb-format-reference/#extensions-blocklist","title":"Extensions Blocklist","text":"<p>Enterprise administrators can push blocklists:</p> <pre><code>[\n  {\n    \"entries\": [],\n    \"lastUpdated\": \"2026-02-17T06:35:51.435Z\",\n    \"url\": \"https://claude.ai/api/organizations/{org_id}/dxt/blocklist\"\n  }\n]\n</code></pre>"},{"location":"reference/mcpb-format-reference/#naming-conventions","title":"Naming Conventions","text":"Source Directory Name Pattern Example Anthropic first-party <code>ant.dir.ant.anthropic.&lt;name&gt;</code> <code>ant.dir.ant.anthropic.filesystem</code> GitHub third-party <code>ant.dir.gh.&lt;user&gt;.&lt;repo&gt;</code> <code>ant.dir.gh.k6l3.osascript</code> Local / manual Extension <code>name</code> field <code>himalaya-mcp</code>, <code>context7</code>"},{"location":"reference/mcpb-format-reference/#15-build-pipeline","title":"15. Build Pipeline","text":""},{"location":"reference/mcpb-format-reference/#typical-build-steps","title":"Typical Build Steps","text":"<pre><code>Source Code (TypeScript/JS)\n    |\n    v\n[1] esbuild / webpack / tsc\n    |  Produces: dist/index.js (single-file bundle)\n    v\n[2] Copy artifacts to mcpb/ staging directory\n    |  Copy: dist/index.js -&gt; mcpb/dist/index.js\n    |  Already present: mcpb/manifest.json\n    v\n[3] mcpb validate mcpb/\n    |  Validates manifest.json against schema\n    v\n[4] mcpb pack mcpb/\n    |  Creates: my-extension.mcpb (ZIP)\n    |  Applies: default exclusions + .mcpbignore\n    v\n[5] mcpb sign my-extension.mcpb (optional)\n    |  Appends PKCS#7 signature\n    v\n[6] mcpb info my-extension.mcpb\n       Verify metadata, size, signature status\n</code></pre>"},{"location":"reference/mcpb-format-reference/#example-build-mcpbsh","title":"Example build-mcpb.sh","text":"<pre><code>#!/usr/bin/env bash\nset -euo pipefail\n\nPROJECT_ROOT=\"$(cd \"$(dirname \"$0\")/..\" &amp;&amp; pwd)\"\nMCPB_DIR=\"$PROJECT_ROOT/mcpb\"\nVERSION=$(node -p \"require('$PROJECT_ROOT/package.json').version\")\n\necho \"==&gt; Building v${VERSION} .mcpb bundle\"\n\n# Step 1: Build esbuild bundle\nnpm run build:bundle --prefix \"$PROJECT_ROOT\"\n\n# Step 2: Copy into mcpb staging directory\nmkdir -p \"$MCPB_DIR/dist\"\ncp \"$PROJECT_ROOT/dist/index.js\" \"$MCPB_DIR/dist/index.js\"\n\n# Step 3: Validate manifest\nnpx @anthropic-ai/mcpb validate \"$MCPB_DIR/\"\n\n# Step 4: Pack\nnpx @anthropic-ai/mcpb pack \"$MCPB_DIR/\"\n\n# Step 5: Rename to versioned filename\nmv \"$PROJECT_ROOT/mcpb.mcpb\" \"$PROJECT_ROOT/my-ext-v${VERSION}.mcpb\"\n\n# Step 6: Info\nnpx @anthropic-ai/mcpb info \"$PROJECT_ROOT/my-ext-v${VERSION}.mcpb\"\n</code></pre>"},{"location":"reference/mcpb-format-reference/#packagejson-script","title":"package.json Script","text":"<pre><code>{\n  \"scripts\": {\n    \"build:bundle\": \"esbuild src/index.ts --bundle --platform=node --format=esm --outfile=dist/index.js\",\n    \"build:mcpb\": \"bash scripts/build-mcpb.sh\"\n  }\n}\n</code></pre>"},{"location":"reference/mcpb-format-reference/#ci-integration-github-actions","title":"CI Integration (GitHub Actions)","text":"<pre><code>- name: Validate MCPB manifest\n  run: npx @anthropic-ai/mcpb validate mcpb/\n\n- name: Build MCPB bundle\n  run: npm run build:mcpb\n\n- name: Verify MCPB bundle\n  run: npx @anthropic-ai/mcpb info my-ext-v*.mcpb\n\n- name: Upload MCPB artifact\n  uses: actions/upload-artifact@v4\n  with:\n    name: mcpb-bundle\n    path: \"*.mcpb\"\n</code></pre>"},{"location":"reference/mcpb-format-reference/#16-registry-vs-local-installation","title":"16. Registry vs Local Installation","text":""},{"location":"reference/mcpb-format-reference/#local-installation","title":"Local Installation","text":"<ul> <li>Double-click a <code>.mcpb</code> file downloaded from GitHub Releases, website, etc.</li> <li>File is extracted to <code>~/Library/Application Support/Claude/Claude Extensions/&lt;name&gt;/</code></li> <li>Settings stored locally in <code>Claude Extensions Settings/&lt;name&gt;.json</code></li> <li>No automatic updates (manual download of new versions)</li> </ul>"},{"location":"reference/mcpb-format-reference/#directory-registry","title":"Directory / Registry","text":"<ul> <li>Claude Desktop has a built-in extension directory (accessible from the app)</li> <li>Extensions submitted to the directory get broader visibility</li> <li>Supports automatic updates</li> <li>Enterprise features: blocklisting, pre-installation via MDM/Group Policy</li> </ul>"},{"location":"reference/mcpb-format-reference/#enterprise-deployment","title":"Enterprise Deployment","text":"Feature macOS Windows Pre-install approved extensions MDM profiles Group Policy Block specific extensions Blocklist URL Group Policy Block specific publishers Blocklist URL Group Policy Disable all extensions MDM Group Policy Private extension directory Custom URL Custom URL"},{"location":"reference/mcpb-format-reference/#17-localization","title":"17. Localization","text":"<p>Extensions can provide translations for localizable fields (marked with a globe icon in the schema).</p>"},{"location":"reference/mcpb-format-reference/#configuration","title":"Configuration","text":"<pre><code>\"localization\": {\n  \"resources\": \"mcpb-resources/${locale}.json\",\n  \"default_locale\": \"en-US\"\n}\n</code></pre> <ul> <li><code>resources</code>: Path template with <code>${locale}</code> placeholder (default: <code>\"mcpb-resources/${locale}.json\"</code>)</li> <li><code>default_locale</code>: BCP 47 locale tag (default: <code>\"en-US\"</code>)</li> </ul>"},{"location":"reference/mcpb-format-reference/#locale-file-format","title":"Locale File Format","text":"<p><code>mcpb-resources/es-ES.json</code>: <pre><code>{\n  \"description\": \"Servidor de email con privacidad\",\n  \"display_name\": \"Email Himalaya\",\n  \"tools\": {\n    \"list_emails\": {\n      \"description\": \"Listar correos en una carpeta\"\n    }\n  }\n}\n</code></pre></p>"},{"location":"reference/mcpb-format-reference/#localizable-fields","title":"Localizable Fields","text":"<ul> <li><code>description</code>, <code>display_name</code>, <code>long_description</code></li> <li><code>author.name</code></li> <li><code>tools[].description</code></li> <li><code>prompts[].description</code></li> <li><code>keywords</code></li> </ul>"},{"location":"reference/mcpb-format-reference/#fallback-chain","title":"Fallback Chain","text":"<p>The client applies locale fallbacks: <code>es-UY</code> -&gt; <code>es-MX</code> -&gt; <code>es-ES</code> -&gt; <code>en-US</code> (default).</p>"},{"location":"reference/mcpb-format-reference/#18-real-world-examples","title":"18. Real-World Examples","text":""},{"location":"reference/mcpb-format-reference/#minimal-context7-dxt_version-01-third-party","title":"Minimal: Context7 (dxt_version 0.1, third-party)","text":"<pre><code>{\n  \"dxt_version\": \"0.1\",\n  \"name\": \"context7\",\n  \"display_name\": \"Context7\",\n  \"version\": \"1.0.1\",\n  \"description\": \"Up-to-date Code Docs For Any Prompt\",\n  \"author\": { \"name\": \"Upstash\", \"email\": \"context7@upstash.com\", \"url\": \"https://upstash.com\" },\n  \"server\": {\n    \"type\": \"node\",\n    \"entry_point\": \"dist/index.js\",\n    \"mcp_config\": {\n      \"command\": \"node\",\n      \"args\": [\"${__dirname}/dist/index.js\"],\n      \"env\": {}\n    }\n  },\n  \"tools\": [\n    { \"name\": \"Resolve Context7 Library ID\", \"description\": \"Resolves a package name to a Context7 library ID.\" },\n    { \"name\": \"Get Library Docs\", \"description\": \"Fetches up-to-date documentation for a library.\" }\n  ],\n  \"compatibility\": { \"platforms\": [\"darwin\", \"win32\", \"linux\"], \"runtimes\": { \"node\": \"&gt;=v18.0.0\" } }\n}\n</code></pre>"},{"location":"reference/mcpb-format-reference/#with-user_config-filesystem-manifest_version-02-anthropic","title":"With user_config: Filesystem (manifest_version 0.2, Anthropic)","text":"<pre><code>{\n  \"manifest_version\": \"0.2\",\n  \"name\": \"Filesystem\",\n  \"display_name\": \"Filesystem\",\n  \"version\": \"0.2.0\",\n  \"description\": \"Let Claude access your filesystem to read and write files.\",\n  \"author\": { \"name\": \"Anthropic\", \"url\": \"https://www.claude.ai\" },\n  \"server\": {\n    \"type\": \"node\",\n    \"entry_point\": \"server/index.js\",\n    \"mcp_config\": {\n      \"command\": \"node\",\n      \"args\": [\"${__dirname}/server/index.js\", \"${user_config.allowed_directories}\"]\n    }\n  },\n  \"user_config\": {\n    \"allowed_directories\": {\n      \"type\": \"directory\",\n      \"title\": \"Allowed Directories\",\n      \"description\": \"Select directories the filesystem server can access\",\n      \"multiple\": true,\n      \"required\": true,\n      \"default\": []\n    }\n  },\n  \"compatibility\": { \"platforms\": [\"darwin\", \"win32\", \"linux\"], \"runtimes\": { \"node\": \"&gt;=16.0.0\" } }\n}\n</code></pre>"},{"location":"reference/mcpb-format-reference/#full-featured-himalaya-mcp-manifest_version-03-19-tools-4-prompts","title":"Full-featured: himalaya-mcp (manifest_version 0.3, 19 tools, 4 prompts)","text":"<pre><code>{\n  \"manifest_version\": \"0.3\",\n  \"name\": \"himalaya-mcp\",\n  \"display_name\": \"Himalaya Email\",\n  \"version\": \"1.3.0\",\n  \"description\": \"Privacy-first email for Claude via the himalaya CLI.\",\n  \"author\": { \"name\": \"Data-Wise\", \"url\": \"https://github.com/Data-Wise\" },\n  \"server\": {\n    \"type\": \"node\",\n    \"entry_point\": \"dist/index.js\",\n    \"mcp_config\": {\n      \"command\": \"node\",\n      \"args\": [\"${__dirname}/dist/index.js\"],\n      \"env\": {\n        \"HIMALAYA_BINARY\": \"${user_config.himalaya_binary}\",\n        \"HIMALAYA_ACCOUNT\": \"${user_config.himalaya_account}\",\n        \"HIMALAYA_FOLDER\": \"${user_config.himalaya_folder}\"\n      }\n    }\n  },\n  \"user_config\": {\n    \"himalaya_binary\": { \"type\": \"file\", \"title\": \"Himalaya Binary\", \"required\": false },\n    \"himalaya_account\": { \"type\": \"string\", \"title\": \"Default Account\", \"required\": false },\n    \"himalaya_folder\": { \"type\": \"string\", \"title\": \"Default Folder\", \"default\": \"INBOX\", \"required\": false }\n  },\n  \"tools\": [ /* 19 tools */ ],\n  \"prompts\": [ /* 4 prompts with arguments and text */ ],\n  \"compatibility\": { \"platforms\": [\"darwin\"], \"runtimes\": { \"node\": \"&gt;=22.0.0\" } }\n}\n</code></pre>"},{"location":"reference/mcpb-format-reference/#19-references","title":"19. References","text":"<ul> <li>MCPB GitHub Repository (anthropics/mcpb) -- Spec, CLI, reference implementation</li> <li>MANIFEST.md - Full Specification</li> <li>CLI.md - CLI Documentation</li> <li>Anthropic Engineering: Desktop Extensions -- Launch blog post</li> <li>Building Desktop Extensions with MCPB (Claude Help Center) -- Developer guide</li> <li>Adopting the MCP Bundle format (MCP Blog) -- DXT to MCPB rename announcement</li> <li>@anthropic-ai/mcpb on npm</li> <li>desktopextensions.com -- Community directory</li> </ul>"},{"location":"reference/refcard/","title":"Quick Reference","text":""},{"location":"reference/refcard/#install","title":"Install","text":"<pre><code>brew tap data-wise/tap &amp;&amp; brew install himalaya-mcp   # Homebrew (recommended)\n# GitHub install (requires: brew install node himalaya)\nclaude plugin marketplace add Data-Wise/himalaya-mcp  # GitHub (step 1: add marketplace)\nclaude plugin install email                     # GitHub (step 2: install plugin)\nhimalaya-mcp setup                                     # Claude Desktop config (legacy)\nhimalaya-mcp install-ext                               # Claude Desktop extension (.mcpb)\n# Or: Download .mcpb from GitHub Releases, double-click to install\nhimalaya-mcp doctor                                    # Verify any install method\n</code></pre>"},{"location":"reference/refcard/#cli-commands","title":"CLI Commands","text":"<pre><code>himalaya-mcp setup              Add MCP server to Claude Desktop config\nhimalaya-mcp setup --check      Verify configuration exists and paths valid\nhimalaya-mcp setup --remove     Remove MCP server entry\nhimalaya-mcp install-ext [file] Install .mcpb as Desktop extension\nhimalaya-mcp remove-ext         Remove Desktop extension\nhimalaya-mcp doctor             Diagnose full stack (prereqs, email, extension, plugin)\nhimalaya-mcp doctor --fix       Auto-fix common issues\nhimalaya-mcp doctor --json      Machine-readable diagnostic output\n</code></pre>"},{"location":"reference/refcard/#tools-19","title":"Tools (19)","text":"<pre><code>list_emails         [folder] [page_size] [page] [account]     List envelopes\nsearch_emails       query [folder] [account]                   Search emails\nread_email          id [folder] [account]                      Read plain text\nread_email_html     id [folder] [account]                      Read HTML\nlist_folders        [account]                                  List all folders\ncreate_folder       name [account]                             Create new folder\ndelete_folder       name [account]                             Delete folder\nflag_email          id flags action(\"add\"|\"remove\") [folder]   Set/clear flags\nmove_email          id target_folder [folder] [account]        Move to folder\ncompose_email       to subject body [account]                  Compose new email\ndraft_reply         id [body] [reply_all] [folder] [account]   Generate draft (no send)\nsend_email          template [confirm] [account]               Send (confirm=true required)\nlist_attachments    id [folder] [account]                      List email attachments\ndownload_attachment id attachment_name [folder] [account]      Download attachment\nextract_calendar_event  id [folder] [account]                  Extract calendar from email\ncreate_calendar_event   event_data                             Create calendar event\nexport_to_markdown  id [folder] [account]                      Email -&gt; markdown + YAML\ncreate_action_item  id [folder] [account]                      Extract todos/deadlines\ncopy_to_clipboard   text                                       Copy to system clipboard\n</code></pre>"},{"location":"reference/refcard/#prompts-4","title":"Prompts (4)","text":"<pre><code>triage_inbox         [count=10]              Classify emails: actionable/FYI/skip\nsummarize_email      id [folder]             One-sentence summary + action items\ndaily_email_digest   (none)                  Priority-grouped markdown digest\ndraft_reply          id [tone] [instructions] Guided reply composition\n</code></pre>"},{"location":"reference/refcard/#resources-3","title":"Resources (3)","text":"<pre><code>email://inbox           Recent inbox envelopes\nemail://message/{id}    Full message body\nemail://folders         All available folders\n</code></pre>"},{"location":"reference/refcard/#common-flags","title":"Common Flags","text":"<pre><code>Seen       Mark as read\nFlagged    Star/important\nAnswered   Has been replied to\nDeleted    Marked for deletion\nDraft      Draft message\n</code></pre>"},{"location":"reference/refcard/#plugin-skills-claude-code-only","title":"Plugin Skills (Claude Code only)","text":"<pre><code>/email:inbox        List recent emails, offer to read/triage/reply\n/email:triage       Classify inbox, suggest flags and moves\n/email:digest       Generate daily priority digest\n/email:reply        Draft reply with safety gate workflow\n/email:compose      Compose new email with safety gate\n/email:attachments  List/download attachments, calendar invites\n/email:search       Search by keyword, sender, flags, date filters\n/email:manage       Bulk flag/unflag/move/archive with confirmation gate\n/email:stats        Inbox statistics, top senders, oldest unread, trends\n/email:config       Setup wizard \u2014 provider templates, connection test, doctor\n/email:help         Help hub \u2014 browse tools, prompts, workflows\n</code></pre>"},{"location":"reference/refcard/#plugin-hooks-claude-code-only","title":"Plugin Hooks (Claude Code only)","text":"<pre><code>pre-send.sh     PreToolUse on send_email/compose_email \u2014 preview gate + audit log\n</code></pre>"},{"location":"reference/refcard/#environment-variables","title":"Environment Variables","text":"<pre><code>HIMALAYA_BINARY    Path to himalaya binary       (default: himalaya)\nHIMALAYA_ACCOUNT   Default account name          (default: system default)\nHIMALAYA_FOLDER    Default folder                (default: INBOX)\nHIMALAYA_TIMEOUT   Command timeout in ms         (default: 120000, 2 min; 0 = unlimited)\n</code></pre>"},{"location":"reference/refcard/#safety-gates","title":"Safety Gates","text":"<pre><code>send_email(template, confirm=false)           -&gt;  PREVIEW only (not sent)\nsend_email(template, confirm=true)            -&gt;  Actually sends\ncompose_email(..., confirm=false)             -&gt;  PREVIEW only (not sent)\ncompose_email(..., confirm=true)              -&gt;  Actually sends\ndelete_folder(name, confirm=false)            -&gt;  Warning (not deleted)\ndelete_folder(name, confirm=true)             -&gt;  Deletes\ncreate_calendar_event(..., confirm=false)     -&gt;  Preview (not created)\ncreate_calendar_event(..., confirm=true)      -&gt;  Creates in Apple Calendar\n</code></pre>"},{"location":"reference/refcard/#common-workflows","title":"Common Workflows","text":"<pre><code>Triage:     list_emails -&gt; read_email -&gt; flag_email / move_email\nReply:      read_email -&gt; draft_reply -&gt; [review] -&gt; send_email(confirm=true)\nCompose:    compose_email(preview) -&gt; [review] -&gt; compose_email(confirm=true)\nExport:     read_email -&gt; export_to_markdown -&gt; copy_to_clipboard\nAttach:     list_attachments -&gt; download_attachment -&gt; [use file]\nCalendar:   extract_calendar_event -&gt; [review] -&gt; create_calendar_event(confirm=true)\nFolders:    list_folders -&gt; create_folder / delete_folder(confirm=true)\nDigest:     triage_inbox prompt -&gt; daily_email_digest prompt\nSearch:     /email:search \"query\" -&gt; read_email -&gt; [act on results]\nBulk:       /email:manage [action] [ids] [destination] -&gt; confirmation -&gt; progress\nStats:      /email:stats [--weekly] -&gt; unread count, top senders, trends\nSetup:      /email:config [--check | --add-account] -&gt; wizard or validate\nMulti-acct: Any tool + account=\"work\" | account=\"personal\"\n</code></pre>"},{"location":"reference/refcard/#build-distribution","title":"Build &amp; Distribution","text":"<pre><code>npm run build           TypeScript compilation (development)\nnpm run build:bundle    esbuild single-file bundle (~595KB, production)\nnpm run build:mcpb      Build .mcpb Desktop Extension (~147KB)\nnpm test                Run 335 tests (vitest)\nnode dist/index.js      Start MCP server standalone\n</code></pre>"},{"location":"reference/refcard/#distribution-channels","title":"Distribution Channels","text":"<pre><code>Homebrew:    brew install data-wise/tap/himalaya-mcp\nGitHub:      claude plugin marketplace add Data-Wise/himalaya-mcp &amp;&amp; claude plugin install email\nDesktop:     himalaya-mcp install-ext (or double-click .mcpb from GitHub Releases)\nSource:      git clone + npm install + npm run build\n</code></pre>"},{"location":"specs/BRAINSTORM-enhancement-gaps-2026-02-25/","title":"BRAINSTORM: himalaya-mcp Enhancement Gaps","text":"<p>Date: 2026-02-25 Mode: deep feat save Duration: ~10 min Project: himalaya-mcp v1.3.1</p>"},{"location":"specs/BRAINSTORM-enhancement-gaps-2026-02-25/#context","title":"Context","text":"<p>Post v1.3.1 release \u2014 installation docs overhauled, Homebrew formula generator integrated, <code>.mcpb</code> packaging working. Identified gaps in skill coverage, hooks, and release tooling.</p>"},{"location":"specs/BRAINSTORM-enhancement-gaps-2026-02-25/#what-already-exists","title":"What Already Exists","text":"<ul> <li>19 MCP tools, 7 skills, 1 agent, 0 hooks</li> <li>4 install paths: Homebrew, Marketplace, Source, standalone MCP</li> <li>Homebrew release automation (formula + .mcpb auto-upload)</li> <li><code>himalaya-mcp doctor</code> diagnostic CLI (6-layer check)</li> </ul>"},{"location":"specs/BRAINSTORM-enhancement-gaps-2026-02-25/#whats-missing","title":"What's Missing","text":""},{"location":"specs/BRAINSTORM-enhancement-gaps-2026-02-25/#skills-4-gaps","title":"Skills (4 gaps)","text":"<ol> <li><code>/email:search</code> \u2014 tool exists, no skill wrapper</li> <li><code>/email:manage</code> \u2014 bulk flag/move/archive, no skill</li> <li><code>/email:config</code> \u2014 no guided himalaya setup from Claude</li> <li><code>/email:stats</code> \u2014 no inbox analytics</li> </ol>"},{"location":"specs/BRAINSTORM-enhancement-gaps-2026-02-25/#hooks-3-gaps","title":"Hooks (3 gaps)","text":"<ol> <li>Post-install \u2014 auto-run <code>doctor</code> after install</li> <li>Session-start \u2014 unread count notification</li> <li>Pre-send \u2014 confirmation gate for send_email/compose_email</li> </ol>"},{"location":"specs/BRAINSTORM-enhancement-gaps-2026-02-25/#config-1-gap","title":"Config (1 gap)","text":"<ol> <li><code>.craft/homebrew.json</code> \u2014 craft integration for release pipeline</li> </ol>"},{"location":"specs/BRAINSTORM-enhancement-gaps-2026-02-25/#tooling-2-gaps","title":"Tooling (2 gaps)","text":"<ol> <li>Release automation \u2014 version bump + changelog scripts</li> <li>Zero-config install \u2014 detect macOS mail accounts, generate config.toml</li> </ol>"},{"location":"specs/BRAINSTORM-enhancement-gaps-2026-02-25/#recommended-implementation-order","title":"Recommended Implementation Order","text":"<ol> <li><code>/email:search</code> (20 min)</li> <li><code>/email:manage</code> (30 min)</li> <li>Post-install hook (20 min)</li> <li><code>.craft/homebrew.json</code> (10 min)</li> <li>Pre-send hook (1 hr)</li> <li><code>/email:config</code> (2 hr)</li> <li><code>/email:stats</code> (1 hr)</li> <li>Session-start hook (1 hr)</li> <li>Release automation (4 hr)</li> </ol>"},{"location":"specs/BRAINSTORM-enhancement-gaps-2026-02-25/#spec-generated","title":"Spec Generated","text":"<p>\u2192 <code>SPEC-enhancement-gaps-2026-02-25.md</code></p>"},{"location":"specs/BRAINSTORM-installation-enhancement-2026-02-25/","title":"BRAINSTORM: himalaya-mcp Installation &amp; Distribution Enhancement","text":"<p>Date: 2026-02-25 Mode: deep + feature Duration: ~8 min</p>"},{"location":"specs/BRAINSTORM-installation-enhancement-2026-02-25/#findings","title":"Findings","text":""},{"location":"specs/BRAINSTORM-installation-enhancement-2026-02-25/#critical-bug-skillsagents-nesting-in-homebrew-formula","title":"Critical Bug: Skills/Agents Nesting in Homebrew Formula","text":"<p>The formula does <code>cp_r \"himalaya-mcp-plugin\", libexec/\"plugin\"</code> which places skills at <code>libexec/plugin/skills/</code> instead of <code>libexec/skills/</code>. Claude Code expects skills at the plugin root \u2014 they're invisible via Homebrew install.</p>"},{"location":"specs/BRAINSTORM-installation-enhancement-2026-02-25/#homebrew-post_install-gap","title":"Homebrew post_install Gap","text":"<p>Unlike craft's formula, himalaya-mcp's <code>post_install</code> only strips plugin.json keys. It does NOT run <code>himalaya-mcp-install</code> or <code>claude plugin update</code>. Users must run <code>himalaya-mcp-install</code> manually after <code>brew install</code>.</p>"},{"location":"specs/BRAINSTORM-installation-enhancement-2026-02-25/#github-install-docs-missing-prerequisites","title":"GitHub Install Docs Missing Prerequisites","text":"<p>The \"Option 2: GitHub Plugin Install\" section doesn't mention that Node.js and himalaya CLI must be installed separately. Homebrew handles this automatically, but GitHub marketplace install doesn't.</p>"},{"location":"specs/BRAINSTORM-installation-enhancement-2026-02-25/#quick-wins","title":"Quick Wins","text":"<ol> <li>Fix skills/agents nesting in formula (<code>cp_r</code> to root, not <code>plugin/</code> subdir)</li> <li>Add auto-install to <code>post_install</code> (match craft pattern)</li> <li>Add prerequisites note to GitHub install docs</li> </ol>"},{"location":"specs/BRAINSTORM-installation-enhancement-2026-02-25/#medium-effort","title":"Medium Effort","text":"<ol> <li>Add <code>himalaya-mcp doctor</code> to post_install</li> <li>Add homebrew-release automation parity (metadata, pre-release checks)</li> <li>Improve <code>brew test</code> coverage (skill count validation)</li> </ol>"},{"location":"specs/BRAINSTORM-installation-enhancement-2026-02-25/#long-term","title":"Long-term","text":"<ol> <li>Unified curl installer (detect platform, choose Homebrew/npm)</li> <li>Version sync tooling (port from craft)</li> <li>Auto-update command</li> <li>npx support for zero-install setup</li> </ol>"},{"location":"specs/BRAINSTORM-installation-enhancement-2026-02-25/#recommendation","title":"Recommendation","text":"<p>Start with #1 (bug fix), then #2 (UX), then #3 (docs). See SPEC file for implementation details.</p>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/","title":"SPEC: himalaya-mcp Enhancement Gaps","text":"<p>Status: draft Created: 2026-02-25 From Brainstorm: This session (deep feat save) Version: himalaya-mcp v1.3.1</p>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#overview","title":"Overview","text":"<p>Addresses gaps identified after the v1.3.1 installation docs overhaul and Homebrew formula generator integration. Focuses on missing skills, empty hooks, installation friction, and release automation.</p>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#primary-user-story","title":"Primary User Story","text":"<p>As a Claude Code user with himalaya configured, I want email skills to be discoverable and complete so I can manage my inbox without knowing raw MCP tool names.</p>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>[ ] All 19 MCP tools have corresponding skill coverage (currently 7 skills cover ~14 tools)</li> <li>[ ] Hooks directory has at least post-install and pre-send hooks</li> <li>[ ] <code>himalaya-mcp doctor</code> runs automatically after installation</li> <li>[ ] <code>/craft:dist:homebrew</code> recognizes himalaya-mcp via <code>.craft/homebrew.json</code></li> </ul>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#secondary-user-stories","title":"Secondary User Stories","text":"<ul> <li>As a new user, I want guided himalaya configuration so I don't need to manually create config.toml</li> <li>As a power user, I want inbox analytics and bulk operations without chaining raw tool calls</li> <li>As a maintainer, I want release automation so version bumps and changelogs aren't manual</li> </ul>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#enhancement-inventory","title":"Enhancement Inventory","text":""},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#tier-1-quick-wins-30-min-each","title":"Tier 1 \u2014 Quick Wins (&lt; 30 min each)","text":"# Enhancement Type Effort Priority 1 <code>/email:search</code> skill skill 20 min High 2 <code>/email:manage</code> skill (bulk flag/move) skill 30 min High 3 <code>.craft/homebrew.json</code> config config 10 min Medium 4 Post-install hook (<code>doctor</code>) hook 20 min High"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#tier-2-medium-effort-1-2-hours-each","title":"Tier 2 \u2014 Medium Effort (1-2 hours each)","text":"# Enhancement Type Effort Priority 5 <code>/email:config</code> setup wizard skill 2 hr High 6 <code>/email:stats</code> inbox analytics skill 1 hr Medium 7 Session-start hook (unread notification) hook 1 hr Medium 8 Pre-send confirmation gate hook hook 1 hr High"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#tier-3-long-term-4-hours","title":"Tier 3 \u2014 Long-term (4+ hours)","text":"# Enhancement Type Effort Priority 9 Release automation (bump + changelog) scripts 4 hr Medium 10 Zero-config install (detect macOS accounts) feature 8 hr Low 11 Multi-account skill enhancements skill 4 hr Low"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#architecture","title":"Architecture","text":"<pre><code>graph TD\n    subgraph \"Current (v1.3.1)\"\n        T[19 MCP Tools]\n        S[7 Skills]\n        A[1 Agent]\n        H[0 Hooks]\n    end\n\n    subgraph \"Proposed (v1.4.0)\"\n        T2[19 MCP Tools]\n        S2[10 Skills - +search, +manage, +config]\n        A2[1 Agent]\n        H2[3 Hooks - post-install, session-start, pre-send]\n        C[.craft/homebrew.json]\n    end\n\n    T --&gt; T2\n    S --&gt; S2\n    A --&gt; A2\n    H --&gt; H2</code></pre>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#api-design","title":"API Design","text":"<p>N/A \u2014 No API changes. All enhancements are plugin-layer skills, hooks, and config.</p>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#data-models","title":"Data Models","text":"<p>N/A \u2014 No data model changes. Skills use existing MCP tools.</p>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#dependencies","title":"Dependencies","text":"Dependency Required By Status himalaya CLI All skills Already required Node.js MCP server Already required craft plugin <code>.craft/homebrew.json</code> Optional (craft integration)"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#uiux-specifications","title":"UI/UX Specifications","text":""},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#skill-discovery-flow","title":"Skill Discovery Flow","text":"<pre><code>User: /email:help\n\u2192 Shows all 10 skills (currently 7)\n\u2192 New skills appear in correct categories:\n   Search &amp; Filter: /email:search (NEW)\n   Management: /email:manage (NEW)\n   Setup: /email:config (NEW)\n   Analytics: /email:stats (NEW)\n</code></pre>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#post-install-hook-ux","title":"Post-Install Hook UX","text":"<pre><code>$ brew install data-wise/tap/himalaya-mcp\n...\n==&gt; Running post-install hook...\n\u2713 himalaya binary found (v1.1.0)\n\u2713 himalaya account configured (1 account)\n\u2713 MCP server responds\n\u2713 Plugin registered in Claude Code\n</code></pre>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#pre-send-confirmation-gate","title":"Pre-Send Confirmation Gate","text":"<pre><code>Claude: I'll send this email now.\n[Hook intercepts]\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\ud83d\udce7 SEND CONFIRMATION\n  To: boss@company.com\n  Subject: Q1 Report\n  Body: (preview first 3 lines)\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\nType \"send\" to confirm, anything else to cancel.\n</code></pre> <p>N/A \u2014 Accessibility: CLI-only, no visual UI.</p>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#open-questions","title":"Open Questions","text":"<ul> <li>Should <code>/email:config</code> support OAuth2 flows (Gmail requires it) or just app passwords?</li> <li>Session-start hook: acceptable latency budget? (5s proposed)</li> <li>Multi-account: should skills default to \"all accounts\" or require explicit <code>--account</code>?</li> </ul>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#review-checklist","title":"Review Checklist","text":"<ul> <li>[ ] All new skills follow existing skill template format</li> <li>[ ] Hooks use Claude Code hook API correctly</li> <li>[ ] <code>.craft/homebrew.json</code> matches craft schema</li> <li>[ ] <code>/email:help</code> updated with new skills</li> <li>[ ] Tests added for new skills</li> <li>[ ] CHANGELOG updated</li> <li>[ ] Version bumped (v1.4.0)</li> </ul>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#implementation-notes","title":"Implementation Notes","text":"<ul> <li>Skill files are pure markdown \u2014 no code changes needed for Tier 1 items</li> <li>Hooks require Claude Code hook format \u2014 check <code>.claude/hooks</code> schema before implementing</li> <li><code>/email:config</code> is the highest-impact item \u2014 solves the #1 support issue (himalaya not configured)</li> <li>Pre-send hook is defense-in-depth \u2014 agent already has safety rules, hook adds a second layer</li> <li>Recommended implementation order: #1 \u2192 #2 \u2192 #4 \u2192 #3 \u2192 #8 \u2192 #5 \u2192 #6 \u2192 #7 \u2192 #9</li> </ul>"},{"location":"specs/SPEC-enhancement-gaps-2026-02-25/#history","title":"History","text":"Date Change 2026-02-25 Initial spec from deep brainstorm session"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/","title":"SPEC: himalaya-mcp","text":"<p>Status: draft Created: 2026-02-13 From Brainstorm: ~/BRAINSTORM-himalaya-mcp-2026-02-13.md</p>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#overview","title":"Overview","text":"<p>Privacy-first email MCP server + Claude Code plugin wrapping the himalaya CLI. Provides email read/triage/compose/export capabilities to Claude via MCP tools, resources, and prompts. Subprocess-based architecture (<code>himalaya --output json</code>) for zero additional dependencies.</p>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#primary-user-story","title":"Primary User Story","text":"<p>As a developer using Claude Code, I want Claude to read, search, triage, and export my emails, So that I can manage email without leaving my terminal workflow.</p>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>[ ] <code>list_emails</code> tool returns envelope list from himalaya (JSON parsed)</li> <li>[ ] <code>read_email</code> tool returns full email body (plain text)</li> <li>[ ] <code>search_emails</code> tool passes IMAP query to himalaya</li> <li>[ ] <code>list_folders</code> tool returns available mail folders</li> <li>[ ] <code>email://inbox</code> resource exposes inbox as browsable content</li> <li>[ ] <code>email://message/{id}</code> resource exposes individual emails</li> <li>[ ] Plugin installable via Claude Code plugin system</li> <li>[ ] Works with existing himalaya auth (app passwords, oauth2-proxy)</li> </ul>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#secondary-user-stories","title":"Secondary User Stories","text":"<ul> <li>As a Claude Desktop (Cowork) user, I want email access via MCP connector</li> <li>As a user with multiple accounts, I want to switch accounts via tool parameter</li> <li>As a privacy-conscious user, I want all email processing local (no cloud tokens)</li> </ul>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Claude Desktop (Cowork)  \u2502  Claude Code (CLI)        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502              himalaya-mcp (MCP server)               \u2502\n\u2502    Tools + Resources + Prompts + Adapters            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         himalaya CLI (subprocess)                    \u2502\n\u2502         IMAP/SMTP + local auth                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         Email provider (Exchange/Gmail/etc.)          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#component-diagram","title":"Component Diagram","text":"<pre><code>himalaya-mcp/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 index.ts              # MCP server entry point\n\u2502   \u251c\u2500\u2500 himalaya/\n\u2502   \u2502   \u251c\u2500\u2500 client.ts         # Subprocess wrapper\n\u2502   \u2502   \u251c\u2500\u2500 parser.ts         # JSON response parser\n\u2502   \u2502   \u2514\u2500\u2500 types.ts          # TypeScript types\n\u2502   \u251c\u2500\u2500 tools/                # MCP tool handlers\n\u2502   \u2502   \u251c\u2500\u2500 inbox.ts          # list_emails, search_emails\n\u2502   \u2502   \u251c\u2500\u2500 read.ts           # read_email, read_email_html\n\u2502   \u2502   \u251c\u2500\u2500 compose.ts        # draft_reply, send_email\n\u2502   \u2502   \u251c\u2500\u2500 manage.ts         # flag_email, move_email\n\u2502   \u2502   \u251c\u2500\u2500 triage.ts         # classify, summarize (prompt-based)\n\u2502   \u2502   \u2514\u2500\u2500 actions.ts        # create_todo, create_meeting\n\u2502   \u251c\u2500\u2500 resources/            # MCP resource providers\n\u2502   \u2502   \u251c\u2500\u2500 inbox.ts          # email://inbox\n\u2502   \u2502   \u251c\u2500\u2500 message.ts        # email://message/{id}\n\u2502   \u2502   \u2514\u2500\u2500 folders.ts        # email://folders\n\u2502   \u251c\u2500\u2500 prompts/              # MCP prompt templates\n\u2502   \u2502   \u251c\u2500\u2500 triage.ts         # triage_inbox\n\u2502   \u2502   \u251c\u2500\u2500 summarize.ts      # summarize_email\n\u2502   \u2502   \u251c\u2500\u2500 reply.ts          # draft_reply\n\u2502   \u2502   \u2514\u2500\u2500 digest.ts         # daily_email_digest\n\u2502   \u251c\u2500\u2500 adapters/             # Output adapters\n\u2502   \u2502   \u251c\u2500\u2500 markdown.ts       # Export to .md\n\u2502   \u2502   \u251c\u2500\u2500 clipboard.ts      # pbcopy (macOS)\n\u2502   \u2502   \u251c\u2500\u2500 obsidian.ts       # Obsidian vault (future)\n\u2502   \u2502   \u2514\u2500\u2500 apple.ts          # Apple Notes/Reminders (future)\n\u2502   \u2514\u2500\u2500 config.ts             # User configuration\n\u251c\u2500\u2500 plugin/                   # Claude Code plugin layer\n\u2502   \u251c\u2500\u2500 skills/               # Slash command skills\n\u2502   \u251c\u2500\u2500 agents/               # Autonomous agents\n\u2502   \u2514\u2500\u2500 hooks/                # Lifecycle hooks\n\u2514\u2500\u2500 tests/                    # Test suites\n</code></pre>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#api-design","title":"API Design","text":""},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#mcp-tools-phase-1-3","title":"MCP Tools (Phase 1-3)","text":"Tool Description himalaya Command Phase <code>list_emails</code> List recent emails (paginated) <code>himalaya envelope list --output json</code> 1 <code>search_emails</code> Search by IMAP query <code>himalaya envelope list --query \"...\" --output json</code> 1 <code>read_email</code> Read full email body (plain text) <code>himalaya message read {id}</code> 1 <code>list_folders</code> List mail folders <code>himalaya folder list --output json</code> 1 <code>read_email_html</code> Read HTML version <code>himalaya message read --html {id}</code> 3 <code>flag_email</code> Add/remove flags <code>himalaya flag add/remove {id} {flag}</code> 2 <code>move_email</code> Move to folder <code>himalaya message move {id} {folder}</code> 3 <code>draft_reply</code> Generate reply draft <code>himalaya message reply --template {id}</code> 3 <code>send_email</code> Send email (REQUIRES confirmation) <code>himalaya message send &lt; draft</code> 3 <code>export_to_markdown</code> Save email + summary to .md Custom: read + format + write 2 <code>create_action_item</code> Extract action/todo from email Custom: read + parse + export 3"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#mcp-resources","title":"MCP Resources","text":"URI Pattern Description Phase <code>email://inbox</code> Current inbox listing 1 <code>email://message/{id}</code> Individual email content 1 <code>email://folders</code> Available mail folders 1"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#mcp-prompts","title":"MCP Prompts","text":"Prompt Description Phase <code>triage_inbox</code> Classify each email as actionable/skip 2 <code>summarize_email</code> Summarize email in one sentence 2 <code>draft_reply</code> Draft professional reply 3 <code>daily_email_digest</code> Create markdown digest of important emails 2"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#data-models","title":"Data Models","text":""},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#envelope-from-himalaya-json","title":"Envelope (from himalaya JSON)","text":"<pre><code>interface Envelope {\n  id: number;\n  from: { name?: string; addr: string };\n  subject: string;\n  date: string;\n  flags: string[];\n}\n</code></pre>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#message","title":"Message","text":"<pre><code>interface Message {\n  id: number;\n  envelope: Envelope;\n  body: string;\n  html?: string;\n}\n</code></pre>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#dependencies","title":"Dependencies","text":"Package Purpose Phase <code>@modelcontextprotocol/sdk</code> MCP server framework 1 <code>typescript</code> Language 1 <code>vitest</code> Testing 1 himalaya CLI (system) Email backend 1"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#uiux-specifications","title":"UI/UX Specifications","text":"<p>N/A - CLI/MCP server only. No GUI components.</p>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#plugin-skills-claude-code","title":"Plugin Skills (Claude Code)","text":"Skill Trigger Description <code>/email:inbox</code> \"check email\", \"inbox\" List and summarize recent emails <code>/email:triage</code> \"triage email\" AI-classify inbox emails <code>/email:digest</code> \"email digest\" Generate daily email summary"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#implementation-phases","title":"Implementation Phases","text":""},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#phase-1-core-read-mvp-1-weekend","title":"Phase 1: Core Read (MVP) - 1 weekend","text":"<ul> <li>himalaya subprocess wrapper (spawn, parse JSON, errors)</li> <li><code>list_emails</code>, <code>read_email</code>, <code>search_emails</code>, <code>list_folders</code> tools</li> <li><code>email://inbox</code>, <code>email://message/{id}</code> resources</li> <li>Test in Claude Code via settings.json MCP config</li> </ul>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#phase-2-triage-export-1-week","title":"Phase 2: Triage + Export - 1 week","text":"<ul> <li><code>triage_inbox</code>, <code>summarize_email</code> prompts</li> <li><code>flag_email</code> tool</li> <li><code>export_to_markdown</code> tool + clipboard adapter</li> <li><code>daily_email_digest</code> prompt</li> </ul>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#phase-3-compose-actions-1-2-weeks","title":"Phase 3: Compose + Actions - 1-2 weeks","text":"<ul> <li><code>draft_reply</code>, <code>send_email</code> (with safety gate), <code>move_email</code> tools</li> <li><code>create_action_item</code> tool</li> <li><code>read_email_html</code> tool</li> </ul>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#phase-4-adapters-distribution-2-weeks","title":"Phase 4: Adapters + Distribution - 2 weeks","text":"<ul> <li>Obsidian, Apple Notes/Reminders/Calendar adapters</li> <li>MCPB packaging for Claude Desktop</li> <li>User config, README, docs</li> </ul>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#phase-5-claude-code-plugin-1-week","title":"Phase 5: Claude Code Plugin - 1 week","text":"<ul> <li>Plugin manifest, skills, agent, hooks</li> <li><code>/email:inbox</code>, <code>/email:triage</code>, <code>/email:digest</code> skills</li> </ul>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#open-questions","title":"Open Questions","text":"<ol> <li>himalaya in Cowork VM? Cowork runs in Linux VM. himalaya needs install inside VM, or MCP server runs on host.</li> <li>Rate limiting? Cache envelope lists to avoid hammering IMAP?</li> <li>Attachments? Expose attachment download as tool?</li> <li>Multi-account? How to expose account switching in MCP?</li> </ol>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#design-decisions","title":"Design Decisions","text":""},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#1-subprocess-over-library","title":"1. Subprocess over Library","text":"<p>himalaya CLI's <code>--output json</code> makes parsing trivial. Zero additional deps. Can optimize to FFI later if needed.</p>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#2-multi-layer-send-confirmation","title":"2. Multi-layer Send Confirmation","text":"<p><code>send_email</code> returns <code>{ status: \"pending_confirmation\", preview: \"...\" }</code> -&gt; Claude shows preview -&gt; user confirms -&gt; tool executes send.</p>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#3-both-tools-and-resources","title":"3. Both Tools and Resources","text":"<p>Tools for explicit actions with parameters, resources for browsing/context. Resources better for Cowork, tools better for Claude Code.</p>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#4-prompt-based-ai-triage","title":"4. Prompt-based AI Triage","text":"<p>Don't embed AI in MCP server. Provide MCP prompts that tell Claude HOW to triage. Claude IS the AI.</p>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#review-checklist","title":"Review Checklist","text":"<ul> <li>[ ] All Phase 1 tools implemented and tested</li> <li>[ ] himalaya subprocess error handling (not found, auth failure, timeout)</li> <li>[ ] JSON parsing handles all himalaya output formats</li> <li>[ ] Resources return proper MCP resource format</li> <li>[ ] Plugin.json valid and installable</li> <li>[ ] Skills trigger correctly</li> <li>[ ] send_email safety gate verified</li> <li>[ ] Works with both Claude Code and Claude Desktop</li> </ul>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#implementation-notes","title":"Implementation Notes","text":"<ul> <li>Start with Phase 1 (read-only) \u2014 safe, immediately useful</li> <li>Use <code>child_process.execFile</code> (not <code>exec</code>) for subprocess \u2014 avoids shell injection</li> <li>himalaya must be in PATH or configured via <code>config.ts</code></li> <li>All tool responses should include <code>_meta</code> field with timing info</li> <li>Test with real IMAP account (DT's Exchange setup via himalaya)</li> </ul>"},{"location":"specs/SPEC-himalaya-mcp-2026-02-13/#history","title":"History","text":"Date Change 2026-02-13 Initial spec from brainstorm session"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/","title":"SPEC: himalaya-mcp Installation &amp; Distribution Enhancement","text":"<p>Status: draft Created: 2026-02-25 From Brainstorm: Deep brainstorm with agent research + interactive Q&amp;A Priority: High (bug fix + UX improvement + docs overhaul + npm publishing)</p>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#overview","title":"Overview","text":"<p>Fix the Homebrew formula's skills/agents nesting bug, add auto-install to <code>post_install</code>, publish to npm for GitHub marketplace viability, overhaul documentation across all install methods with tabbed quickstart, and create a reusable formula template in craft's <code>/craft:dist:homebrew</code> command. No version bump for himalaya-mcp \u2014 formula-only fix in homebrew-tap.</p>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#decisions-made-interactive-qa","title":"Decisions Made (Interactive Q&amp;A)","text":"Question Decision Plugin naming (<code>email</code> vs <code>himalaya-mcp</code>) Keep both \u2014 different contexts GitHub marketplace install Tested: works for skills, but MCP server missing Marketplace MCP gap fix Publish to npm (<code>@data-wise/himalaya-mcp</code>) Scope Formula + full docs + extras (npm, template) Version bump Formula-only fix (no himalaya-mcp bump) Cross-project scope All Data-Wise plugins + shared template Quickstart format Tabbed multi-method (pymdownx.tabbed already enabled) Build strategy Keep source build in formula Template format Extend <code>/craft:dist:homebrew</code> command"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#user-stories","title":"User Stories","text":""},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#1-homebrew-install-primary-bug-fix","title":"1. Homebrew Install (Primary \u2014 Bug Fix)","text":"<p>As a developer installing via Homebrew, I want <code>brew install himalaya-mcp</code> to fully configure skills, agents, and MCP server without manual steps, so that <code>/email:*</code> skills work immediately after restarting Claude Code.</p> <p>Acceptance Criteria:</p> <ul> <li>[ ] Skills at <code>libexec/skills/</code> (not <code>libexec/plugin/skills/</code>)</li> <li>[ ] Agents at <code>libexec/agents/</code> (not <code>libexec/plugin/agents/</code>)</li> <li>[ ] <code>post_install</code> auto-runs <code>himalaya-mcp-install</code> with 30s timeout</li> <li>[ ] <code>post_install</code> runs <code>claude plugin update</code> (optional, silent fail)</li> <li>[ ] Caveats updated \u2014 no manual <code>himalaya-mcp-install</code> instruction</li> <li>[ ] <code>brew test</code> validates skills directory + count</li> <li>[ ] <code>brew upgrade</code> seamlessly migrates from old <code>plugin/</code> layout</li> </ul>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#2-github-marketplace-install-npm-publishing","title":"2. GitHub Marketplace Install (npm Publishing)","text":"<p>As a developer using <code>claude plugin marketplace add</code>, I want the MCP server to work after marketplace install (not just skills), so that email tools actually function.</p> <p>Acceptance Criteria:</p> <ul> <li>[ ] <code>@data-wise/himalaya-mcp</code> published to npm</li> <li>[ ] <code>.mcp.json</code> updated to use <code>npx -y @data-wise/himalaya-mcp</code> as server command</li> <li>[ ] Marketplace install gets skills + agents + working MCP server via npx</li> <li>[ ] Docs updated to reflect npm-based MCP server path</li> </ul>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#3-documentation-overhaul","title":"3. Documentation Overhaul","text":"<p>As a new user choosing an install method, I want clear, consistent documentation with prerequisites and verification for every method, so that I pick the right path and can verify it works.</p> <p>Acceptance Criteria:</p> <ul> <li>[ ] Quickstart uses tabbed layout (Homebrew / GitHub / Source / Desktop)</li> <li>[ ] Every install method includes prerequisites</li> <li>[ ] Every install method includes verification step (<code>himalaya-mcp doctor</code>)</li> <li>[ ] GitHub install notes that Node.js + himalaya CLI needed separately</li> <li>[ ] Desktop extension notes himalaya CLI as separate prerequisite</li> <li>[ ] All 15+ doc files consistent</li> </ul>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#4-reusable-formula-template","title":"4. Reusable Formula Template","text":"<p>As a Data-Wise plugin developer, I want <code>/craft:dist:homebrew</code> to generate formulas from a template, so that new plugins get the same proven Homebrew distribution pattern.</p> <p>Acceptance Criteria:</p> <ul> <li>[ ] <code>/craft:dist:homebrew</code> generates formula from project metadata</li> <li>[ ] Template includes: auto-install, 3-step post_install, brew test, caveats</li> <li>[ ] Works for himalaya-mcp, scholar, rforge, workflow plugins</li> </ul>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#architecture","title":"Architecture","text":""},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#current-vs-fixed-homebrew-layout","title":"Current vs Fixed Homebrew Layout","text":"<pre><code>Current (broken):                    Fixed:\nlibexec/                             libexec/\n\u251c\u2500\u2500 .claude-plugin/                  \u251c\u2500\u2500 .claude-plugin/\n\u2502   \u251c\u2500\u2500 plugin.json                  \u2502   \u251c\u2500\u2500 plugin.json\n\u2502   \u2514\u2500\u2500 marketplace.json             \u2502   \u2514\u2500\u2500 marketplace.json\n\u251c\u2500\u2500 .mcp.json                        \u251c\u2500\u2500 .mcp.json\n\u251c\u2500\u2500 dist/                            \u251c\u2500\u2500 dist/\n\u2502   \u2514\u2500\u2500 index.js                     \u2502   \u2514\u2500\u2500 index.js\n\u2514\u2500\u2500 plugin/          &lt;-- wrong       \u251c\u2500\u2500 skills/          &lt;-- correct\n    \u251c\u2500\u2500 skills/                      \u2502   \u251c\u2500\u2500 inbox.md\n    \u2514\u2500\u2500 agents/                      \u2502   \u2514\u2500\u2500 ... (7 total)\n                                     \u2514\u2500\u2500 agents/\n                                         \u2514\u2500\u2500 email-assistant.md\n</code></pre>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#github-marketplace-install-flow-post-npm","title":"GitHub Marketplace Install Flow (Post-npm)","text":"<pre><code>claude plugin marketplace add Data-Wise/himalaya-mcp\n  \u2192 Clones repo to ~/.claude/plugins/marketplaces/himalaya-mcp/\n  \u2192 Reads marketplace.json, finds \"email\" plugin at ./himalaya-mcp-plugin\n\nclaude plugin install email@himalaya-mcp\n  \u2192 Caches himalaya-mcp-plugin/ to ~/.claude/plugins/cache/himalaya-mcp/email/1.3.0/\n  \u2192 Gets: .claude-plugin/plugin.json, skills/, agents/\n  \u2192 Gets: .mcp.json (now points to npx -y @data-wise/himalaya-mcp)\n  \u2192 MCP server starts via npx (downloads from npm, runs index.js)\n  \u2192 Skills + MCP tools both work\n</code></pre>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#distribution-channel-comparison-post-fix","title":"Distribution Channel Comparison (Post-Fix)","text":"Feature Homebrew GitHub Marketplace npm/npx Source Desktop .mcpb Prerequisites Auto (deps) Manual (node + himalaya) Manual (node + himalaya) Manual Manual (himalaya) MCP server Built from source Via npx Via npx Built locally Bundled in .mcpb Skills/agents At libexec root At cache root N/A At repo root N/A Auto-enable Yes (if Claude not running) Yes N/A Manual Auto Upgrade <code>brew upgrade</code> <code>claude plugin update</code> Auto (npx) <code>git pull + build</code> Re-download .mcpb"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#changes-required","title":"Changes Required","text":""},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#increment-1-formula-fix-homebrew-tap-repo-critical","title":"Increment 1: Formula Fix (homebrew-tap repo) \u2014 Critical","text":"<p>IMPORTANT: The formula is generated from <code>generator/manifest.json</code> + <code>generator/blocks/</code>. Do NOT hand-edit <code>Formula/himalaya-mcp.rb</code> \u2014 edit the generator inputs then regenerate.</p>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#1a-fix-skillsagents-nesting-in-manifestjson","title":"1a. Fix skills/agents nesting in manifest.json","text":"<p>File: <code>generator/manifest.json</code> \u2014 <code>himalaya-mcp.libexec_paths</code></p> <p>The current manifest copies <code>\"plugin\"</code> as a directory, which nests skills under <code>libexec/plugin/skills/</code>. Fix by replacing with individual paths:</p> <p>Replace: <pre><code>\"libexec_paths\": [\n  \".claude-plugin\",\n  \".mcp.json\",\n  \"plugin\",\n  \"dist\"\n]\n</code></pre></p> <p>With: <pre><code>\"libexec_paths\": [\n  \".claude-plugin\",\n  \".mcp.json\",\n  \"himalaya-mcp-plugin/skills AS skills\",\n  \"himalaya-mcp-plugin/agents AS agents\",\n  \"himalaya-mcp-plugin/hooks AS hooks\",\n  \"dist\"\n]\n</code></pre></p> <p>Note: The <code>AS</code> syntax may need to be implemented in <code>generate.py</code> if not already supported. If not, add support for renaming during copy (e.g., <code>cp_r buildpath/\"himalaya-mcp-plugin/skills\", libexec/\"skills\"</code>).</p> <p>Alternatively, if the generator doesn't support renaming, add a new manifest field:</p> <pre><code>\"libexec_copy_map\": {\n  \"himalaya-mcp-plugin/skills\": \"skills\",\n  \"himalaya-mcp-plugin/agents\": \"agents\",\n  \"himalaya-mcp-plugin/hooks\": \"hooks\"\n}\n</code></pre>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#1b-update-manifestjson-version-test_paths","title":"1b. Update manifest.json version + test_paths","text":"<pre><code>\"version\": \"1.3.0\",\n\"sha256\": \"35662a9ffbe046e7f9208d64dae0d28bfa4f46c2c129f64e14813614f83be35e\",\n\"test_paths\": [\n  {\"path\": \".claude-plugin/plugin.json\", \"type\": \"file\"},\n  {\"path\": \"dist/index.js\", \"type\": \"file\"},\n  {\"path\": \"skills\", \"type\": \"directory\"},\n  {\"path\": \"agents\", \"type\": \"directory\"}\n]\n</code></pre> <p>(Changed from <code>\"plugin/skills\"</code> to <code>\"skills\"</code>)</p>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#1c-update-caveats-in-manifestjson","title":"1c. Update caveats in manifest.json","text":"<p>Remove the manual \"run himalaya-mcp-install\" instruction (now auto-runs in post_install):</p> <pre><code>\"caveats_extra\": \"7 email skills for Claude Code:\\n  /email:inbox   /email:triage   /email:digest\\n  /email:reply   /email:compose  /email:attachments\\n  /email:help\\n\\n19 MCP tools available.\\n\\nFor Claude Desktop: himalaya-mcp setup\\nOr download .mcpb from GitHub Releases.\\n\\nAfter upgrades, sync Claude Code registry:\\n  claude plugin update email@local-plugins\\n\\nIf symlink failed (macOS permissions), run manually:\\n  ln -sf $(brew --prefix)/opt/himalaya-mcp/libexec ~/.claude/plugins/himalaya-mcp\\n\\nRequires himalaya CLI with at least one configured account.\\nSee: https://github.com/Data-Wise/himalaya-mcp\"\n</code></pre>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#1d-verify-generator-includes-auto-install-in-post_install","title":"1d. Verify generator includes auto-install in post_install","text":"<p>Check that <code>generate.py</code> already generates the 3-step <code>post_install</code> (JSON cleanup + install script with 30s timeout + claude plugin update). If not, update the generator template. Craft's formula has this \u2014 the generator should produce it for all <code>\"type\": \"claude-plugin\"</code> formulas.</p>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#1e-regenerate-and-verify","title":"1e. Regenerate and verify","text":"<pre><code>cd ~/projects/dev-tools/homebrew-tap\npython3 generator/generate.py himalaya-mcp --diff   # Preview changes\npython3 generator/generate.py himalaya-mcp           # Generate\ncp Formula/himalaya-mcp.rb /opt/homebrew/Library/Taps/data-wise/homebrew-tap/Formula/\nbrew audit --strict data-wise/tap/himalaya-mcp\nbrew install --build-from-source data-wise/tap/himalaya-mcp\nbrew test data-wise/tap/himalaya-mcp\n</code></pre>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#increment-2-npm-publishing-himalaya-mcp-repo-high","title":"Increment 2: npm Publishing (himalaya-mcp repo) \u2014 High","text":""},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#2a-prepare-for-npm-publish","title":"2a. Prepare for npm publish","text":"<p>File: <code>package.json</code> \u2014 add publish config:</p> <pre><code>{\n  \"publishConfig\": {\n    \"access\": \"public\"\n  },\n  \"files\": [\n    \"dist/index.js\",\n    \"himalaya-mcp-plugin/\",\n    \".claude-plugin/\",\n    \".mcp.json\",\n    \"README.md\",\n    \"LICENSE\"\n  ]\n}\n</code></pre>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#2b-update-mcpjson-for-npx","title":"2b. Update .mcp.json for npx","text":"<p>File: <code>himalaya-mcp-plugin/.mcp.json</code> (or create if needed)</p> <p>The plugin's <code>.mcp.json</code> should work for both Homebrew (local path) and marketplace (npx):</p> <pre><code>{\n  \"mcpServers\": {\n    \"himalaya\": {\n      \"command\": \"npx\",\n      \"args\": [\"-y\", \"@data-wise/himalaya-mcp\"]\n    }\n  }\n}\n</code></pre> <p>Note: The Homebrew formula's <code>.mcp.json</code> at libexec root can keep using <code>${CLAUDE_PLUGIN_ROOT}/dist/index.js</code> since it has the built bundle. Only the marketplace-facing <code>.mcp.json</code> needs the npx path.</p>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#2c-publish-to-npm","title":"2c. Publish to npm","text":"<pre><code>npm login\nnpm publish --access public\n</code></pre>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#2d-add-npm-publish-to-release-workflow","title":"2d. Add npm publish to release workflow","text":"<p>File: <code>.github/workflows/homebrew-release.yml</code> \u2014 add npm publish job:</p> <pre><code>  publish-npm:\n    name: Publish to npm\n    needs: validate\n    runs-on: ubuntu-latest\n    permissions:\n      id-token: write  # for npm provenance\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with:\n          node-version: 22\n          registry-url: 'https://registry.npmjs.org'\n      - run: npm ci\n      - run: npm run build:bundle\n      - run: npm publish --provenance --access public\n        env:\n          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}\n</code></pre>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#increment-3-documentation-overhaul-himalaya-mcp-repo-high","title":"Increment 3: Documentation Overhaul (himalaya-mcp repo) \u2014 High","text":""},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#files-to-update-15-files","title":"Files to Update (15 files)","text":"# File Change Summary 1 <code>README.md</code> Add prerequisites to GitHub install; add npm method; add verification 2 <code>CLAUDE.md</code> Update Install section (remove manual step, add npm) 3 <code>docs/getting-started/installation.md</code> Major overhaul with tabbed layout, prerequisites, verification 4 <code>docs/getting-started/quickstart.md</code> Tabbed multi-method (Homebrew/GitHub/Source/Desktop) 5 <code>docs/index.md</code> Add prerequisites to GitHub install in Quick Start 6 <code>docs/guide/packaging.md</code> Update layout description, npm publishing section 7 <code>docs/guide/troubleshooting.md</code> Add \"Skills not loading after Homebrew install\" section 8 <code>docs/reference/refcard.md</code> Add npm install line, prerequisites note 9 <code>docs/tutorials/desktop-extension.md</code> Clarify himalaya CLI is separate prerequisite 10 <code>CHANGELOG.md</code> Add entry for installation fixes 11 <code>docs/guide/guide.md</code> Update install references if any 12 <code>docs/reference/architecture.md</code> Update distribution diagram 13 <code>docs/tutorials/index.md</code> Update getting started links 14 <code>docs/reference/commands.md</code> Verify install references 15 <code>docs/guide/skills.md</code> Verify install references"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#tabbed-quickstart-format","title":"Tabbed Quickstart Format","text":"<p>File: <code>docs/getting-started/quickstart.md</code></p> <p><pre><code>## 1. Install\n\n=== \"Homebrew (recommended)\"\n\n    ```bash\n    brew tap data-wise/tap\n    brew install himalaya-mcp\n    ```\n\n    Zero config. Installs dependencies, builds, symlinks, auto-enables.\n\n=== \"GitHub Marketplace\"\n\n    Prerequisites: `brew install node himalaya`\n\n    ```bash\n    claude plugin marketplace add Data-Wise/himalaya-mcp\n    claude plugin install email@himalaya-mcp\n    ```\n\n=== \"npm\"\n\n    Prerequisites: `brew install himalaya`\n\n    ```bash\n    npx -y @data-wise/himalaya-mcp\n    ```\n\n    Or add to Claude Code settings manually.\n\n=== \"From Source\"\n\n    ```bash\n    brew install himalaya\n    git clone https://github.com/Data-Wise/himalaya-mcp.git\n    cd himalaya-mcp &amp;&amp; npm install &amp;&amp; npm run build\n    ln -s $(pwd) ~/.claude/plugins/himalaya-mcp\n    ```\n\nRestart Claude Code after install.\n\n## 2. Verify\n\n```bash\nhimalaya-mcp doctor\n</code></pre> ```</p>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#installation-page-key-changes","title":"Installation Page \u2014 Key Changes","text":"<p>File: <code>docs/getting-started/installation.md</code></p> <ol> <li>Add tabbed layout for all methods</li> <li>Each method gets:</li> <li>Prerequisites callout (<code>!!! warning</code>)</li> <li>Install commands</li> <li>\"What happens\" explanation</li> <li>Verification step</li> <li>Add new \"Option 5: npm\" section</li> <li>Remove \"run <code>himalaya-mcp-install</code> manually\" from Homebrew section</li> <li>Add \"Skills not loading\" to troubleshooting</li> </ol>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#increment-4-fixenhance-existing-formula-generator-medium","title":"Increment 4: Fix/Enhance Existing Formula Generator \u2014 Medium","text":"<p>Discovery: The homebrew-tap repo already has a formula generator at <code>generator/generate.py</code> with a <code>manifest.json</code> and composable <code>blocks/</code>. This generates 6 plugin formulas (craft, himalaya-mcp, scholar, rforge, rforge-orchestrator, workflow).</p>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#4a-fix-generator-for-nested-plugin-dirs","title":"4a. Fix generator for nested plugin dirs","text":"<p>The generator currently assumes all <code>libexec_paths</code> are direct children of the repo root. himalaya-mcp's structure (skills nested under <code>himalaya-mcp-plugin/</code>) breaks this assumption.</p> <p>File: <code>generator/generate.py</code></p> <p>Add support for path mapping (source \u2192 destination): - New manifest field: <code>\"libexec_copy_map\"</code> for renaming during copy - Or support <code>\"path AS dest\"</code> syntax in <code>libexec_paths</code> - Generate <code>cp_r buildpath/\"source\", libexec/\"dest\"</code> instead of <code>libexec.install \"path\"</code></p>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#4b-sync-manifest-versions","title":"4b. Sync manifest versions","text":"<p>The manifest is at v1.2.0 for himalaya-mcp but the live formula is at v1.3.0 (updated by CI). Sync all manifest entries to current released versions to prevent regression on regenerate.</p>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#4c-extend-craftdisthomebrew","title":"4c. Extend <code>/craft:dist:homebrew</code>","text":"<p>Update the existing craft command to optionally invoke the homebrew-tap generator: 1. Read current project's plugin metadata 2. Generate or update the manifest.json entry 3. Run <code>generate.py</code> to produce the formula 4. Show diff vs existing formula</p> <p>This connects craft (the developer tool) with the homebrew-tap generator (the distribution tool).</p>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#dependencies","title":"Dependencies","text":"Dependency Required For Status homebrew-tap repo access Formula fix (Increment 1) Available himalaya-mcp repo access Docs + npm (Increments 2-3) Available npm account + NPM_TOKEN secret npm publishing (Increment 2) Needs setup craft repo access Template command (Increment 4) Available"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#open-questions","title":"Open Questions","text":"<ol> <li> <p>npm package name: <code>@data-wise/himalaya-mcp</code> or <code>himalaya-mcp</code>? Scoped is cleaner but requires npm org.</p> </li> <li> <p>Dual .mcp.json: Should we have two .mcp.json files (one for Homebrew with local path, one for marketplace with npx)? Or can one file work for both contexts?</p> </li> <li> <p>Which other plugins to Homebrew-ify? scholar, rforge, workflow are pure Claude Code plugins (no MCP server). They're simpler \u2014 just skills/agents/commands. Should they also get npm publishing or just Homebrew?</p> </li> <li> <p>Clean up duplicate marketplace entries: There are two marketplace entries for himalaya-mcp in <code>known_marketplaces.json</code> (<code>himalaya-mcp-marketplace</code> and <code>himalaya-mcp</code>). Should we clean up the old one?</p> </li> </ol>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#review-checklist","title":"Review Checklist","text":""},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#increment-1-formula","title":"Increment 1 (Formula)","text":"<ul> <li>[ ] <code>brew install --build-from-source data-wise/tap/himalaya-mcp</code> succeeds</li> <li>[ ] <code>ls ~/.claude/plugins/himalaya-mcp/skills/</code> shows 7 files</li> <li>[ ] <code>ls ~/.claude/plugins/himalaya-mcp/agents/</code> shows 1 file</li> <li>[ ] <code>brew test data-wise/tap/himalaya-mcp</code> passes</li> <li>[ ] <code>brew audit --strict data-wise/tap/himalaya-mcp</code> passes</li> <li>[ ] <code>/email:inbox</code> works in Claude Code after restart</li> </ul>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#increment-2-npm","title":"Increment 2 (npm)","text":"<ul> <li>[ ] <code>npm publish</code> succeeds</li> <li>[ ] <code>npx -y @data-wise/himalaya-mcp</code> starts MCP server</li> <li>[ ] <code>claude plugin install email@himalaya-mcp</code> + restart = working MCP tools</li> <li>[ ] Release workflow publishes to npm on GitHub release</li> </ul>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#increment-3-docs","title":"Increment 3 (Docs)","text":"<ul> <li>[ ] All 15 doc files updated and consistent</li> <li>[ ] Tabbed quickstart renders correctly in MkDocs</li> <li>[ ] <code>mkdocs build --strict</code> passes</li> <li>[ ] Broken links test passes</li> <li>[ ] Every install method has prerequisites + verification</li> </ul>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#increment-4-template","title":"Increment 4 (Template)","text":"<ul> <li>[ ] <code>/craft:dist:homebrew</code> generates correct formula for himalaya-mcp</li> <li>[ ] Generated formula matches hand-written one</li> <li>[ ] Works for a second plugin (scholar or rforge)</li> </ul>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#implementation-notes","title":"Implementation Notes","text":"<ul> <li>Formula is generated, not hand-edited. The homebrew-tap has <code>generator/generate.py</code> + <code>manifest.json</code> + <code>blocks/</code>. All plugin formula changes go through the generator. Do NOT edit <code>Formula/himalaya-mcp.rb</code> directly.</li> <li>Manifest version drift: The manifest is at v1.2.0 for himalaya-mcp but the live formula is at v1.3.0 (updated by CI's <code>update-formula.yml</code>). Must sync before regenerating.</li> <li>Increment 1 is independent \u2014 can ship immediately as a homebrew-tap PR</li> <li>Increment 3 requires npm account setup \u2014 need NPM_TOKEN GitHub secret</li> <li>Increment 4 depends on decisions from Inc 3 \u2014 docs reference npm path</li> <li>The formula fix is in <code>Data-Wise/homebrew-tap</code>, NOT himalaya-mcp. No version bump.</li> <li>Existing <code>brew upgrade</code> users get the fix automatically after formula update.</li> <li>The <code>pymdownx.tabbed</code> extension is already enabled in himalaya-mcp's mkdocs.yml.</li> <li>Agent research confirmed: craft's formula pattern (libexec.install + 3-step post_install) is the gold standard.</li> <li>Agent research confirmed: npm/npx is the correct path for marketplace MCP server distribution (context7 pattern).</li> <li>The generator produces 6 formulas. Fixing the nesting logic benefits all plugins with nested source structures, not just himalaya-mcp.</li> <li>Two duplicate marketplace entries exist in <code>known_marketplaces.json</code> (<code>himalaya-mcp-marketplace</code> from earlier, <code>himalaya-mcp</code> from today's test). Clean up the old one.</li> </ul>"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#implementation-order","title":"Implementation Order","text":"Step Scope Repo Depends On Priority 1 Fix generator + manifest for himalaya-mcp nesting homebrew-tap Nothing Critical 2 Regenerate formula, test, deploy homebrew-tap Step 1 Critical 3 npm setup + first publish himalaya-mcp npm account High 4 Docs overhaul (15 files, tabbed quickstart) himalaya-mcp Step 3 decisions High 5 npm publish in CI workflow himalaya-mcp Step 3 Medium 6 Sync all manifest versions + regenerate all formulas homebrew-tap Step 2 Medium 7 Extend <code>/craft:dist:homebrew</code> to use generator craft Step 6 Medium 8 Cleanup duplicate marketplace entries local Step 4 Low"},{"location":"specs/SPEC-installation-enhancement-2026-02-25/#history","title":"History","text":"Date Change 2026-02-25 Initial spec from deep brainstorm session 2026-02-25 Expanded: full docs inventory (15 files), all 5 install methods 2026-02-25 Agent research: craft formula pattern + marketplace MCP gap 2026-02-25 Interactive Q&amp;A: npm publishing, tabbed quickstart, formula template in craft 2026-02-25 Discovery: homebrew-tap has formula generator (generate.py + manifest.json + blocks/) 2026-02-25 Updated: fix goes through generator, not hand-edit. Manifest at v1.2.0 needs sync. 2026-02-25 Final spec: 4 increments, 15 doc files, 3 repos (homebrew-tap, himalaya-mcp, craft)"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/","title":"SPEC: .mcpb Packaging for Claude Desktop","text":"<p>Status: draft Created: 2026-02-17 From Brainstorm: BRAINSTORM-mcpb-packaging-2026-02-17.md Version: 1.0</p>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#overview","title":"Overview","text":"<p>Package himalaya-mcp as a <code>.mcpb</code> Desktop Extension for Claude Desktop, enabling one-click installation. Ship a lightweight variant first (~150 KB, requires <code>brew install himalaya</code>), with an optional bundled variant later (~19 MB, includes universal himalaya binary).</p>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#primary-user-story","title":"Primary User Story","text":"<p>As a Claude Desktop user who wants email access, I want to install himalaya-mcp with one click from a <code>.mcpb</code> file, So that I don't have to manually edit <code>claude_desktop_config.json</code>.</p>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>[ ] <code>.mcpb</code> file installs successfully in Claude Desktop</li> <li>[ ] Install dialog shows optional config fields (binary path, account, folder)</li> <li>[ ] MCP server starts and all 19 tools are available</li> <li>[ ] Existing <code>himalaya-mcp setup</code> CLI continues to work as fallback</li> </ul>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#secondary-user-stories","title":"Secondary User Stories","text":"<p>As a developer distributing himalaya-mcp, I want an automated build pipeline for <code>.mcpb</code> packaging, So that releases include the Desktop Extension automatically.</p> <p>As a power user without Homebrew, I want a bundled <code>.mcpb</code> with the himalaya binary included, So that I have a fully self-contained installation.</p>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#architecture","title":"Architecture","text":"<pre><code>graph TB\n    subgraph \"Distribution Channels\"\n        BREW[Homebrew&lt;br/&gt;brew install himalaya-mcp]\n        MCPB_LITE[.mcpb Lightweight&lt;br/&gt;~150 KB]\n        MCPB_BUNDLED[.mcpb Bundled&lt;br/&gt;~19 MB]\n        GITHUB[GitHub Marketplace&lt;br/&gt;claude plugin install]\n    end\n\n    subgraph \"Claude Desktop\"\n        INSTALL[One-click Install]\n        CONFIG[user_config Dialog]\n        SERVER[MCP Server Process]\n    end\n\n    subgraph \"himalaya-mcp\"\n        DIST[dist/index.js]\n        TOOLS[19 Tools]\n        PROMPTS[4 Prompts]\n        RESOURCES[3 Resources]\n    end\n\n    subgraph \"himalaya CLI\"\n        BIN_SYSTEM[System Binary&lt;br/&gt;brew install himalaya]\n        BIN_BUNDLED[Bundled Binary&lt;br/&gt;universal arm64+x64]\n    end\n\n    MCPB_LITE --&gt; INSTALL\n    MCPB_BUNDLED --&gt; INSTALL\n    INSTALL --&gt; CONFIG\n    CONFIG --&gt; SERVER\n    SERVER --&gt; DIST\n    DIST --&gt; TOOLS\n    DIST --&gt; PROMPTS\n    DIST --&gt; RESOURCES\n    TOOLS --&gt; BIN_SYSTEM\n    TOOLS --&gt; BIN_BUNDLED</code></pre>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#api-design","title":"API Design","text":"<p>N/A - No API changes. The <code>.mcpb</code> packaging wraps the existing MCP server without modifications.</p>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#data-models","title":"Data Models","text":"<p>N/A - No data model changes. The manifest.json is a new configuration file, not a data model.</p>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#manifestjson-schema","title":"manifest.json Schema","text":"<pre><code>{\n  \"manifest_version\": \"0.3\",\n  \"name\": \"himalaya-mcp\",\n  \"display_name\": \"Himalaya Email\",\n  \"version\": \"1.2.0\",\n  \"description\": \"Privacy-first email for Claude via the himalaya CLI\",\n  \"author\": { \"name\": \"Data-Wise\", \"url\": \"https://github.com/Data-Wise\" },\n  \"license\": \"MIT\",\n  \"server\": {\n    \"type\": \"node\",\n    \"entry_point\": \"dist/index.js\",\n    \"mcp_config\": {\n      \"command\": \"node\",\n      \"args\": [\"${__dirname}/dist/index.js\"],\n      \"env\": {\n        \"HIMALAYA_BINARY\": \"${user_config.himalaya_binary}\",\n        \"HIMALAYA_ACCOUNT\": \"${user_config.himalaya_account}\",\n        \"HIMALAYA_FOLDER\": \"${user_config.himalaya_folder}\"\n      }\n    }\n  },\n  \"user_config\": {\n    \"himalaya_binary\": { \"type\": \"file\", \"title\": \"Himalaya Binary\", \"required\": false },\n    \"himalaya_account\": { \"type\": \"string\", \"title\": \"Default Account\", \"required\": false },\n    \"himalaya_folder\": { \"type\": \"string\", \"title\": \"Default Folder\", \"default\": \"INBOX\", \"required\": false }\n  },\n  \"compatibility\": {\n    \"platforms\": [\"darwin\"],\n    \"runtimes\": { \"node\": \"&gt;=22.0.0\" }\n  }\n}\n</code></pre>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#dependencies","title":"Dependencies","text":"Dependency Purpose Required? <code>@anthropic-ai/mcpb</code> CLI for init/validate/pack/sign Dev only himalaya CLI Email operations Runtime (user installs separately or bundled) Node.js 22+ MCP server runtime Runtime (system install) esbuild Bundle dist/index.js Dev only (existing)"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#uiux-specifications","title":"UI/UX Specifications","text":""},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#install-flow","title":"Install Flow","text":"<ol> <li>User downloads <code>himalaya-mcp-v1.2.0.mcpb</code> from GitHub Releases</li> <li>Double-clicks or drags to Claude Desktop</li> <li>Install dialog appears with optional config fields:</li> <li>Himalaya Binary (file picker, optional)</li> <li>Default Account (text field, optional)</li> <li>Default Folder (text field, default \"INBOX\")</li> <li>User clicks \"Install\"</li> <li>Extension appears in Claude Desktop, MCP server starts</li> <li>User says \"check my inbox\" and Claude calls list_emails</li> </ol>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#user-flow-diagram","title":"User Flow Diagram","text":"<pre><code>Download .mcpb \u2192 Open in Claude Desktop \u2192 Config Dialog \u2192 Install \u2192 Use\n</code></pre>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#accessibility","title":"Accessibility","text":"<p>N/A - Claude Desktop handles the install UI; we provide metadata only.</p>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#open-questions","title":"Open Questions","text":"<ol> <li>Empty user_config values: Does an empty file picker pass <code>\"\"</code> or omit the env var? Need to test \u2014 our config.ts should handle both.</li> <li>tools_generated flag: Can we use <code>tools_generated: true</code> instead of listing all 19 tools? Would reduce manifest size and avoid sync issues.</li> <li>Official directory: What's the submission process? Would enable auto-updates.</li> <li>Built-in Node.js: Does Claude Desktop provide a Node.js runtime, or must the system have one?</li> </ol>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#review-checklist","title":"Review Checklist","text":"<ul> <li>[ ] manifest.json validates with <code>mcpb validate</code></li> <li>[ ] <code>.mcpb</code> installs in Claude Desktop without errors</li> <li>[ ] user_config fields appear correctly in install dialog</li> <li>[ ] Empty optional fields don't break the MCP server</li> <li>[ ] All 19 tools work after .mcpb installation</li> <li>[ ] Build script produces reproducible .mcpb files</li> <li>[ ] CI validates .mcpb as part of release pipeline</li> <li>[ ] Documentation updated (installation guide, architecture)</li> </ul>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#implementation-notes","title":"Implementation Notes","text":""},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#phase-1-lightweight-mcpb-this-spec","title":"Phase 1: Lightweight .mcpb (This Spec)","text":"<ol> <li>Create <code>mcpb/</code> directory with manifest.json</li> <li>Build script: <code>npm run build:bundle</code> then <code>mcpb pack mcpb/ himalaya-mcp-v{version}.mcpb</code></li> <li>Add .mcpb to GitHub Releases as artifact</li> <li>Update installation docs with .mcpb option</li> <li>Test on clean Claude Desktop install</li> </ol>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#phase-2-bundled-variant-future","title":"Phase 2: Bundled Variant (Future)","text":"<ol> <li>Download arm64 + x64 himalaya binaries from GitHub releases</li> <li>Create universal binary with <code>lipo -create</code></li> <li>Include in <code>mcpb-bundled/bin/himalaya</code></li> <li>Set <code>HIMALAYA_BINARY=${__dirname}/bin/himalaya</code> in manifest</li> <li>Document Gatekeeper approval (System Settings &gt; Privacy &amp; Security)</li> <li>Separate download on GitHub Releases</li> </ol>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#phase-3-signed-official-future","title":"Phase 3: Signed + Official (Future)","text":"<ol> <li>Apple Developer certificate ($99/yr)</li> <li>Sign universal binary + notarize</li> <li>Submit to Anthropic's extension directory</li> <li>Auto-updates for installed users</li> </ol>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#branch-strategy","title":"Branch Strategy","text":"<ul> <li>Work on <code>feature/mcpb-packaging</code> branch (worktree from dev)</li> <li>Standalone effort, no dependencies on other features</li> <li>PR to dev when Phase 1 complete</li> </ul>"},{"location":"specs/SPEC-mcpb-packaging-2026-02-17/#history","title":"History","text":"Date Change 2026-02-17 Initial spec from max-depth brainstorm with 2 agents"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/","title":"SPEC: Plugin Packaging &amp; Distribution","text":"<p>Status: draft Created: 2026-02-14 From Brainstorm: BRAINSTORM-proper-plugin-packaging-2026-02-14.md Primary User: Developer (personal distribution)</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#overview","title":"Overview","text":"<p>Package himalaya-mcp as a proper Claude Code plugin distributed via Homebrew (<code>brew install data-wise/tap/himalaya-mcp</code>). The formula declares <code>depends_on \"himalaya\"</code>, bundles a single-file esbuild output (no <code>node_modules</code>), auto-symlinks to <code>~/.claude/plugins/</code>, and registers in the local marketplace. Zero-config: install and it works.</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#primary-user-story","title":"Primary User Story","text":"<p>As a developer who uses Claude Code across machines, I want to run <code>brew install data-wise/tap/himalaya-mcp</code> and have email tools immediately available, So that I don't need to manually symlink, configure MCP servers, or manage dependencies.</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>[ ] <code>brew install data-wise/tap/himalaya-mcp</code> completes successfully</li> <li>[ ] himalaya CLI is installed as a dependency</li> <li>[ ] Plugin auto-symlinks to <code>~/.claude/plugins/himalaya-mcp</code></li> <li>[ ] Plugin registers in <code>~/.claude/local-marketplace/marketplace.json</code></li> <li>[ ] Plugin auto-enables in <code>~/.claude/settings.json</code></li> <li>[ ] MCP server starts correctly via <code>${CLAUDE_PLUGIN_ROOT}/dist/index.js</code></li> <li>[ ] <code>/email:inbox</code>, <code>/email:triage</code>, <code>/email:digest</code>, <code>/email:reply</code> skills load</li> <li>[ ] <code>brew uninstall himalaya-mcp</code> cleans up symlinks and marketplace entry</li> <li>[ ] <code>brew upgrade himalaya-mcp</code> preserves user configuration</li> </ul>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#secondary-user-stories","title":"Secondary User Stories","text":""},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#community-developer","title":"Community Developer","text":"<p>As a developer who discovers himalaya-mcp, I want to install it from the official Anthropic plugin directory or GitHub, So that I can get email tools without Homebrew.</p> <p>Acceptance: <code>claude plugin add github:Data-Wise/himalaya-mcp</code> works.</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#claude-desktop-user","title":"Claude Desktop User","text":"<p>As a Claude Desktop user, I want to run <code>himalaya-mcp setup</code> after installing, So that the MCP server is auto-configured in <code>claude_desktop_config.json</code>.</p> <p>Acceptance: Setup command adds server entry without breaking existing config.</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#architecture","title":"Architecture","text":"<pre><code>Distribution Channels\n=====================\n\nHomebrew (Primary)                  GitHub (Fallback)\n  brew install himalaya-mcp           claude plugin add github:Data-Wise/himalaya-mcp\n  \u2502                                   \u2502\n  \u251c\u2500 depends_on \"himalaya\"            \u2514\u2500 Copies plugin to cache\n  \u251c\u2500 depends_on \"node\"                   Uses ${CLAUDE_PLUGIN_ROOT}\n  \u2502\n  \u251c\u2500 libexec/\n  \u2502   \u251c\u2500 .claude-plugin/plugin.json\n  \u2502   \u251c\u2500 .mcp.json\n  \u2502   \u251c\u2500 plugin/skills/*.md\n  \u2502   \u251c\u2500 plugin/agents/*.md\n  \u2502   \u2514\u2500 dist/index.js (esbuild bundle, ~300KB)\n  \u2502\n  \u2514\u2500 post_install \u2192 himalaya-mcp-install\n      \u251c\u2500 symlink \u2192 ~/.claude/plugins/himalaya-mcp\n      \u251c\u2500 register \u2192 ~/.claude/local-marketplace/marketplace.json\n      \u2514\u2500 auto-enable \u2192 ~/.claude/settings.json\n\nRuntime\n=======\n\nClaude Code loads plugin\n  \u2192 Reads .mcp.json\n  \u2192 Spawns: node ${CLAUDE_PLUGIN_ROOT}/dist/index.js\n  \u2192 MCP server starts\n  \u2192 himalaya CLI found via PATH (/opt/homebrew/bin/himalaya)\n  \u2192 11 tools, 4 prompts, 3 resources available\n</code></pre>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#technical-requirements","title":"Technical Requirements","text":""},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#phase-1-esbuild-bundle-eliminates-node_modules","title":"Phase 1: esbuild Bundle (eliminates node_modules)","text":"<p>Problem: <code>node_modules</code> is 72MB for one production dep (<code>@modelcontextprotocol/sdk</code>). The compiled <code>dist/</code> is 276KB.</p> <p>Solution: Use esbuild to bundle everything into a single <code>dist/index.js</code>:</p> <pre><code>npx esbuild src/index.ts --bundle --platform=node --target=node22 --outfile=dist/index.js --format=esm --external:none\n</code></pre> <p>Files to modify: - <code>package.json</code> \u2014 Add <code>\"build:bundle\"</code> script using esbuild - <code>tsconfig.json</code> \u2014 May need <code>\"module\": \"ESNext\"</code> adjustments - <code>.mcp.json</code> \u2014 No change (already points to <code>dist/index.js</code>)</p> <p>Verification: - Bundle runs standalone: <code>node dist/index.js</code> - All 122 tests still pass - No runtime <code>require()</code> of external packages</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#phase-2-homebrew-formula","title":"Phase 2: Homebrew Formula","text":"<p>File: <code>~/projects/dev-tools/homebrew-tap/Formula/himalaya-mcp.rb</code></p> <p>Pattern: Follow <code>craft.rb</code> exactly (proven approach):</p> Step What How <code>depends_on</code> himalaya + node <code>depends_on \"himalaya\"</code> + <code>depends_on \"node\"</code> <code>install</code> Build + copy to libexec <code>npm run build:bundle</code> then <code>libexec.install</code> <code>bin</code> scripts install + uninstall <code>himalaya-mcp-install</code>, <code>himalaya-mcp-uninstall</code> <code>post_install</code> Auto-setup Runs <code>himalaya-mcp-install</code> <code>caveats</code> Usage instructions Skills list + Claude Desktop config <code>test</code> Verify structure Check plugin.json, dist/index.js exist <p>Install script responsibilities (same as craft-install): 1. Symlink <code>libexec</code> \u2192 <code>~/.claude/plugins/himalaya-mcp</code> 2. Register in <code>~/.claude/local-marketplace/marketplace.json</code> 3. Auto-enable in <code>~/.claude/settings.json</code> (if Claude not running) 4. Print success message with skill names</p> <p>Uninstall script responsibilities: 1. Remove symlink from <code>~/.claude/plugins/himalaya-mcp</code> 2. Remove entry from <code>~/.claude/local-marketplace/marketplace.json</code> 3. Print confirmation</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#phase-3-github-marketplace-official-directory","title":"Phase 3: GitHub Marketplace + Official Directory","text":"<p>Files to add to repo: - <code>.claude-plugin/marketplace.json</code> \u2014 Makes repo a self-hosted marketplace</p> <pre><code>{\n  \"name\": \"himalaya-mcp-marketplace\",\n  \"owner\": { \"name\": \"Data-Wise\" },\n  \"plugins\": [{\n    \"name\": \"himalaya-mcp\",\n    \"source\": \".\",\n    \"description\": \"Privacy-first email MCP server wrapping himalaya CLI\"\n  }]\n}\n</code></pre> <p>Official directory submission: - Submit via https://clau.de/plugin-directory-submission - Requires: quality review, README, working plugin structure</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#phase-4-claude-desktop-setup-cli","title":"Phase 4: Claude Desktop Setup CLI","text":"<p>File: <code>src/cli/setup.ts</code> (new)</p> <p>Commands: <pre><code>himalaya-mcp setup          # Add MCP server to Claude Desktop config\nhimalaya-mcp setup --check  # Verify configuration\nhimalaya-mcp setup --remove # Remove MCP server entry\n</code></pre></p> <p>Config path: <code>~/Library/Application Support/Claude/claude_desktop_config.json</code></p> <p>Logic: 1. Read existing config (or create empty) 2. Add/update <code>mcpServers.himalaya</code> entry 3. Write back (preserving other servers) 4. Print \"Restart Claude Desktop to activate\"</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#api-design","title":"API Design","text":"<p>N/A \u2014 No new MCP tools. This is a packaging/distribution feature.</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#data-models","title":"Data Models","text":"<p>N/A \u2014 No data model changes.</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#dependencies","title":"Dependencies","text":"Dependency Purpose Phase esbuild Bundle dist/index.js (dev dependency) 1 himalaya (Homebrew) Email CLI backend 2 node (Homebrew) MCP server runtime 2 jq (optional, Homebrew) Auto-enable in settings.json 2"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#uiux-specifications","title":"UI/UX Specifications","text":"<p>N/A \u2014 CLI only. No visual UI.</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#user-flow","title":"User Flow","text":"<pre><code>Install:\n  brew tap data-wise/tap\n  brew install himalaya-mcp\n  \u2192 \"himalaya-mcp plugin installed to ~/.claude/plugins/himalaya-mcp\"\n  \u2192 \"Plugin auto-enabled in Claude Code\"\n  \u2192 \"5 skills available: /email:inbox, /email:triage, ...\"\n\nUse in Claude Code:\n  /email:inbox          \u2192 Lists recent emails\n  /email:triage         \u2192 Classify and prioritize\n  /email:digest         \u2192 Daily summary\n  /email:reply          \u2192 Draft a reply\n\nUse in Claude Desktop:\n  himalaya-mcp setup    \u2192 Configures MCP server\n  \u2192 Restart Claude Desktop\n  \u2192 Email tools available\n</code></pre>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#open-questions","title":"Open Questions","text":"<ol> <li> <p>esbuild + ESM \u2014 The MCP SDK uses ESM. Does esbuild handle the zod/v4 import map correctly? Need to test the bundle runs standalone.</p> </li> <li> <p><code>depends_on \"node\"</code> \u2014 Homebrew's node formula is large. Should we use <code>depends_on \"node@22\"</code> for stability, or just <code>\"node\"</code>?</p> </li> <li> <p>plugin.json version \u2014 Currently <code>0.1.0</code>. Should bump to <code>1.0.0</code> to match the npm package version before publishing the formula.</p> </li> <li> <p>Homebrew sandbox \u2014 Does <code>npm run build</code> work in Homebrew's sandboxed build environment? May need to pre-build and include <code>dist/</code> in the tarball.</p> </li> <li> <p><code>${CLAUDE_PLUGIN_ROOT}</code> through symlinks \u2014 Key risk. Need to verify Claude Code resolves the plugin root correctly when installed via symlink (not direct path).</p> </li> </ol>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#review-checklist","title":"Review Checklist","text":"<ul> <li>[ ] esbuild bundle runs standalone (<code>node dist/index.js</code>)</li> <li>[ ] All 122 tests pass with bundled output</li> <li>[ ] Formula installs cleanly on fresh system</li> <li>[ ] Plugin loads in Claude Code (skills + MCP server)</li> <li>[ ] Uninstall cleans up all artifacts</li> <li>[ ] Upgrade preserves user configuration</li> <li>[ ] <code>claude plugin add github:Data-Wise/himalaya-mcp</code> works</li> <li>[ ] Claude Desktop setup command works</li> <li>[ ] README documents all install methods</li> </ul>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#implementation-notes","title":"Implementation Notes","text":""},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#key-risk-esbuild-bundle","title":"Key Risk: esbuild Bundle","text":"<p>The biggest technical risk is the esbuild step. The MCP SDK uses: - <code>zod/v4</code> (import map in package.json) - Dynamic <code>import()</code> for some modules - <code>@modelcontextprotocol/sdk/server/mcp.js</code> subpath exports</p> <p>Mitigation: Test the bundle immediately. If esbuild can't handle the import map, fall back to shipping <code>node_modules</code> (72MB, but proven to work).</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#craftrb-as-template","title":"Craft.rb as Template","text":"<p>The craft formula (<code>~/projects/dev-tools/homebrew-tap/Formula/craft.rb</code>) is the direct template. himalaya-mcp adds: - <code>depends_on \"himalaya\"</code> (new \u2014 craft has no system deps) - <code>depends_on \"node\"</code> (new \u2014 craft is pure markdown/shell) - Build step (<code>npm run build:bundle</code>) - Claude Desktop caveats (MCP server config snippet)</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#version-bump","title":"Version Bump","text":"<p>Before creating the formula: - Bump <code>plugin.json</code> version <code>0.1.0</code> \u2192 <code>1.1.0</code> - Bump <code>package.json</code> version <code>1.0.0</code> \u2192 <code>1.1.0</code> - Tag <code>v1.1.0</code> release on GitHub - Use the tarball URL in the formula</p>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#implementation-order","title":"Implementation Order","text":"<pre><code>Phase 1: esbuild bundle        (30 min)\n  \u2192 Add esbuild dev dep\n  \u2192 Create build:bundle script\n  \u2192 Test standalone execution\n  \u2192 Verify tests pass\n\nPhase 2: Homebrew formula       (2 hours)\n  \u2192 Create formula in homebrew-tap\n  \u2192 Write install/uninstall scripts\n  \u2192 Test full lifecycle\n  \u2192 Push formula\n\nPhase 3: GitHub marketplace     (15 min)\n  \u2192 Add marketplace.json to repo\n  \u2192 Test: claude plugin add github:Data-Wise/himalaya-mcp\n\nPhase 4: Official directory     (15 min)\n  \u2192 Submit via form\n  \u2192 Wait for review\n\nPhase 5: Claude Desktop setup   (1 hour)\n  \u2192 Create src/cli/setup.ts\n  \u2192 Add bin entry to package.json\n  \u2192 Test setup/check/remove commands\n  \u2192 Add to formula caveats\n</code></pre>"},{"location":"specs/SPEC-plugin-packaging-2026-02-14/#history","title":"History","text":"Date Change 2026-02-14 Initial spec from brainstorm (plugin packaging &amp; distribution)"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/","title":"SPEC: himalaya-mcp v1.2.0 Features","text":"<p>Status: complete Created: 2026-02-15 From Brainstorm: BRAINSTORM-v1.2.0-features-2026-02-15.md Version: v1.2.0</p>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#overview","title":"Overview","text":"<p>Expand himalaya-mcp from 11 to 19 MCP tools by adding four feature areas: attachment support, email composition (new messages), folder management, and calendar integration. Each feature wraps existing himalaya CLI commands where available, with custom code only for calendar ICS parsing and Apple Calendar integration.</p>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#primary-user-story","title":"Primary User Story","text":"<p>As a Claude Code user managing email through himalaya-mcp, I want to download attachments, compose new emails, manage folders, and create calendar events from meeting invites, So that I can handle my complete email workflow without leaving Claude.</p>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>[x] All 8 new tools register and appear in MCP tool listing</li> <li>[x] Attachment download saves to temp directory and returns file path</li> <li>[x] Compose email uses the same two-phase safety gate as send_email</li> <li>[x] Folder create/delete/list wrap himalaya CLI commands directly</li> <li>[x] Calendar event extraction parses ICS from downloaded attachments</li> <li>[x] Calendar event creation uses AppleScript (macOS only, mocked in tests)</li> <li>[x] All new tools support multi-account via <code>account</code> parameter</li> <li>[x] 64 new tests passed, bringing total from 181 to 245</li> </ul>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#secondary-user-stories","title":"Secondary User Stories","text":""},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#attachment-workflow","title":"Attachment Workflow","text":"<p>As a user receiving documents via email, I want to list and download attachments, So that Claude can process files (PDFs, spreadsheets, etc.) from my inbox.</p>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#fresh-email-composition","title":"Fresh Email Composition","text":"<p>As a user who needs to send new emails (not replies), I want to compose and send fresh messages with subject, recipients, and body, So that I'm not limited to only replying to existing threads.</p>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#folder-organization","title":"Folder Organization","text":"<p>As a user with multiple email folders/labels, I want to create, delete, and list folders, So that Claude can help organize my email structure.</p>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#calendar-integration","title":"Calendar Integration","text":"<p>As a user receiving meeting invites via email, I want to extract event details and create Apple Calendar entries, So that meeting invites flow from email to my calendar automatically.</p>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#architecture","title":"Architecture","text":"<pre><code>graph TD\n    subgraph \"New Tools (v1.2.0)\"\n        LA[list_attachments]\n        DA[download_attachment]\n        CE[compose_email]\n        CF[create_folder]\n        DF[delete_folder]\n        LF[list_folders]\n        EC[extract_calendar_event]\n        CC[create_calendar_event]\n    end\n\n    subgraph \"Existing Infrastructure\"\n        Client[HimalayaClient]\n        Safety[Two-Phase Safety Gate]\n        Config[Config + Multi-Account]\n    end\n\n    subgraph \"External\"\n        CLI[himalaya CLI]\n        AC[Apple Calendar]\n        FS[File System / tmpdir]\n    end\n\n    LA --&gt; Client\n    DA --&gt; Client\n    DA --&gt; FS\n    CE --&gt; Client\n    CE --&gt; Safety\n    CF --&gt; Client\n    DF --&gt; Client\n    DF --&gt; Safety\n    LF --&gt; Client\n    EC --&gt; DA\n    CC --&gt; AC\n\n    Client --&gt; CLI\n    Client --&gt; Config</code></pre>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#build-order","title":"Build Order","text":"<pre><code>Phase 6a: Folders (independent, simplest, 3 tools)\nPhase 6b: Compose (independent, mirrors existing pattern, 1 tool)\nPhase 6c: Attachments (independent, 2 tools, but Calendar depends on it)\nPhase 6d: Calendar (depends on Attachments for ICS download, 2 tools)\n</code></pre>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#api-design","title":"API Design","text":""},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#new-tools","title":"New Tools","text":"Tool Parameters Returns Safety Gate <code>list_attachments</code> <code>id</code>, <code>folder?</code>, <code>account?</code> <code>[{filename, mime, size}]</code> No <code>download_attachment</code> <code>id</code>, <code>filename</code>, <code>folder?</code>, <code>account?</code> <code>{path, size, mime}</code> No <code>compose_email</code> <code>to</code>, <code>subject</code>, <code>body</code>, <code>cc?</code>, <code>bcc?</code>, <code>confirm?</code>, <code>account?</code> Preview or send result Yes (two-phase) <code>create_folder</code> <code>name</code>, <code>account?</code> <code>{success, name}</code> No <code>delete_folder</code> <code>name</code>, <code>confirm?</code>, <code>account?</code> Preview or delete result Yes (two-phase) <code>list_folders</code> <code>account?</code> <code>[{name, desc?}]</code> No <code>extract_calendar_event</code> <code>id</code>, <code>folder?</code>, <code>account?</code> <code>{summary, dtstart, dtend, location?, organizer?, description?}</code> No <code>create_calendar_event</code> <code>event</code> (CalendarEvent), <code>confirm?</code> Preview or creation result Yes (two-phase)"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#cli-command-mapping","title":"CLI Command Mapping","text":"Tool himalaya Command <code>list_attachments</code> <code>himalaya attachment list --output json &lt;id&gt;</code> <code>download_attachment</code> <code>himalaya attachment download &lt;id&gt; &lt;filename&gt;</code> <code>compose_email</code> <code>himalaya template write</code> + <code>himalaya template send</code> <code>create_folder</code> <code>himalaya folder create &lt;name&gt;</code> <code>delete_folder</code> <code>himalaya folder delete &lt;name&gt;</code> <code>list_folders</code> <code>himalaya folder list --output json</code> <code>extract_calendar_event</code> Download .ics attachment, parse ICS content <code>create_calendar_event</code> AppleScript via osascript subprocess"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#data-models","title":"Data Models","text":""},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#new-typescript-types","title":"New TypeScript Types","text":"<pre><code>// Attachment metadata from himalaya CLI\ninterface Attachment {\n  filename: string;\n  mime: string;\n  size: number;        // bytes\n}\n\n// Folder metadata\ninterface Folder {\n  name: string;\n  desc?: string;       // optional description/path\n}\n\n// Parsed calendar event from ICS\ninterface CalendarEvent {\n  summary: string;     // event title\n  dtstart: string;     // ISO datetime\n  dtend: string;       // ISO datetime\n  location?: string;\n  organizer?: string;\n  description?: string;\n  uid?: string;        // unique event ID from ICS\n}\n</code></pre>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#new-client-methods","title":"New Client Methods","text":"Method CLI Command Returns <code>listAttachments(id, folder?, account?)</code> <code>attachment list --output json</code> <code>Attachment[]</code> <code>downloadAttachment(id, filename, folder?, account?)</code> <code>attachment download</code> <code>{path: string}</code> <code>composeEmail(to, subject, body, cc?, bcc?)</code> <code>template write</code> + <code>template send</code> <code>string</code> <code>createFolder(name, account?)</code> <code>folder create</code> <code>void</code> <code>deleteFolder(name, account?)</code> <code>folder delete</code> <code>void</code> <code>listFolders(account?)</code> <code>folder list --output json</code> <code>Folder[]</code> <code>sendTemplate(template)</code> <code>template send</code> (stdin pipe) <code>string</code>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#dependencies","title":"Dependencies","text":"Dependency Purpose New? himalaya CLI All email operations Existing Node.js <code>os.tmpdir()</code> Temp dir for attachment downloads Built-in Node.js <code>crypto.randomUUID()</code> Unique temp file names Built-in osascript (macOS) Apple Calendar integration System binary vitest Test framework Existing <p>No new npm dependencies required. ICS parsing is ~50 lines of custom code (line-based key:value format).</p>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#uiux-specifications","title":"UI/UX Specifications","text":""},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#two-phase-safety-gate-pattern","title":"Two-Phase Safety Gate Pattern","text":"<p>Reused from existing <code>send_email</code> for: <code>compose_email</code>, <code>delete_folder</code>, <code>create_calendar_event</code>.</p> <p>Phase 1 (Preview): Call without <code>confirm=true</code> returns a preview: <pre><code>compose_email(to: \"alice@example.com\", subject: \"Meeting\", body: \"...\")\n\u2192 Returns: \"Preview: To: alice@example.com | Subject: Meeting | Body: ... | Set confirm=true to send\"\n</code></pre></p> <p>Phase 2 (Execute): Call with <code>confirm=true</code> performs the action: <pre><code>compose_email(to: \"alice@example.com\", subject: \"Meeting\", body: \"...\", confirm: true)\n\u2192 Returns: \"Email sent successfully\"\n</code></pre></p>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#attachment-download-flow","title":"Attachment Download Flow","text":"<pre><code>1. list_attachments(id: \"42\")\n   \u2192 [{filename: \"report.pdf\", mime: \"application/pdf\", size: 245760}]\n\n2. download_attachment(id: \"42\", filename: \"report.pdf\")\n   \u2192 {path: \"/tmp/himalaya-mcp-abc123/report.pdf\", size: 245760, mime: \"application/pdf\"}\n</code></pre>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#calendar-event-flow","title":"Calendar Event Flow","text":"<pre><code>1. list_attachments(id: \"55\")\n   \u2192 [{filename: \"invite.ics\", mime: \"text/calendar\", size: 1024}]\n\n2. extract_calendar_event(id: \"55\")\n   \u2192 {summary: \"Team Standup\", dtstart: \"2026-02-16T09:00:00\", ...}\n\n3. create_calendar_event(event: {...})\n   \u2192 \"Preview: Team Standup | Feb 16, 9:00 AM | Set confirm=true to create\"\n\n4. create_calendar_event(event: {...}, confirm: true)\n   \u2192 \"Event created in Apple Calendar\"\n</code></pre>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#accessibility","title":"Accessibility","text":"<p>N/A - CLI tool, no visual UI.</p>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#open-questions","title":"Open Questions","text":"<ol> <li>Temp file cleanup: Should downloaded attachments be cleaned up automatically (e.g., on server shutdown), or left for the OS to handle via tmpdir?</li> <li>ICS recurrence: Should <code>extract_calendar_event</code> handle recurring events (RRULE), or just single instances for v1.2.0?</li> <li>Compose with attachments: Should <code>compose_email</code> support attaching files? himalaya's MML format supports this, but adds complexity. Defer to v1.3.0?</li> </ol>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#review-checklist","title":"Review Checklist","text":"<ul> <li>[x] All 8 new tools have input validation</li> <li>[x] Safety gates prevent accidental sends/deletes</li> <li>[x] Multi-account parameter works on all new tools</li> <li>[x] Error messages are clear and actionable</li> <li>[x] No new npm dependencies introduced</li> <li>[x] ICS parser handles malformed input gracefully</li> <li>[x] AppleScript integration gracefully skips on non-macOS</li> <li>[x] Temp file paths use secure random names</li> <li>[x] All tools documented in plugin agent awareness</li> <li>[x] Plugin skills updated for new capabilities</li> </ul>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#implementation-notes","title":"Implementation Notes","text":""},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#temp-file-strategy","title":"Temp File Strategy","text":"<ul> <li>Use <code>os.tmpdir()</code> + <code>crypto.randomUUID()</code> for unique subdirectories</li> <li>Pattern: <code>/tmp/himalaya-mcp-&lt;uuid&gt;/filename.ext</code></li> <li>Let OS handle cleanup via standard tmpdir lifecycle</li> </ul>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#ics-parser","title":"ICS Parser","text":"<ul> <li>Simple line-based parser (~50 lines), no external library</li> <li>Parse VCALENDAR/VEVENT blocks for: SUMMARY, DTSTART, DTEND, LOCATION, ORGANIZER, DESCRIPTION, UID</li> <li>Handle folded lines (continuation with leading whitespace)</li> <li>Return structured CalendarEvent object</li> </ul>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#apple-calendar-adapter","title":"Apple Calendar Adapter","text":"<ul> <li>Uses <code>osascript</code> subprocess (same pattern as clipboard adapter uses <code>pbcopy</code>)</li> <li>AppleScript creates new event in default calendar</li> <li>Platform guard: check <code>process.platform === \"darwin\"</code> before attempting</li> <li>In tests: mock the subprocess call entirely</li> <li>On CI: skip calendar tests with <code>describe.skipIf</code></li> </ul>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#compose-email-strategy","title":"Compose Email Strategy","text":"<ul> <li>Uses himalaya's <code>template write</code> to generate MML template</li> <li>Injects headers (To, Subject, Cc, Bcc) and body</li> <li>Two-phase: without confirm returns preview, with confirm pipes to <code>template send</code></li> <li>Mirrors existing <code>draft_reply</code> + <code>send_email</code> flow closely</li> </ul>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#existing-patterns-to-reuse","title":"Existing Patterns to Reuse","text":"<ul> <li>Two-phase safety gate from <code>src/tools/compose.ts</code></li> <li>Subprocess wrapper from <code>src/himalaya/client.ts</code></li> <li>Multi-account parameter handling from all existing tools</li> <li>Test mocking pattern from <code>tests/client.test.ts</code></li> </ul>"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#new-files","title":"New Files","text":"File Purpose <code>src/tools/attachments.ts</code> list_attachments, download_attachment <code>src/tools/compose-new.ts</code> compose_email <code>src/tools/folders.ts</code> create_folder, delete_folder, list_folders <code>src/adapters/calendar.ts</code> ICS parser + Apple Calendar adapter <code>tests/attachments.test.ts</code> ~10 tests <code>tests/compose-new.test.ts</code> ~8 tests <code>tests/folders.test.ts</code> ~8 tests <code>tests/calendar.test.ts</code> ~10 tests <code>plugin/skills/compose.md</code> /email:compose skill <code>plugin/skills/attachments.md</code> /email:attachments skill"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#existing-file-changes","title":"Existing File Changes","text":"File Change <code>src/himalaya/client.ts</code> +7 methods (listAttachments, downloadAttachment, composeEmail, createFolder, deleteFolder, listFolders, sendTemplate) <code>src/himalaya/types.ts</code> +3 types (Attachment, Folder, CalendarEvent) <code>src/index.ts</code> Register 8 new tools <code>plugin/agents/email-assistant.md</code> New tool awareness <code>.claude-plugin/plugin.json</code> v1.2.0, new skills"},{"location":"specs/SPEC-v1.2.0-features-2026-02-15/#history","title":"History","text":"Date Change 2026-02-15 Initial spec from brainstorm session (max + feat + save)"},{"location":"tutorials/","title":"Tutorials","text":"<p>Step-by-step guides from simple to advanced. Each tutorial builds on the previous one -- start at Level 1 and work your way up.</p>"},{"location":"tutorials/#learning-path","title":"Learning Path","text":"<pre><code>flowchart LR\n    subgraph L1[\"Level 1: Getting Started\"]\n        A1[Read First Email] --&gt; A2[Multi-Account]\n        A2 --&gt; A3[Desktop Extension]\n    end\n\n    subgraph L2[\"Level 2: Productivity\"]\n        B1[Triage Inbox] --&gt; B2[Reply to Email]\n        B2 --&gt; B4[Compose Email]\n        B4 --&gt; B5[Attachments &amp; Calendar]\n        B5 --&gt; B6[Search &amp; Manage]\n        B6 --&gt; B3[Export &amp; Save]\n    end\n\n    subgraph L3[\"Level 3: Automation\"]\n        C1[Automate with Agent]\n    end\n\n    L1 --&gt; L2 --&gt; L3\n\n    style L1 fill:#f5e6d3,stroke:#c4a882\n    style L2 fill:#e8d5c4,stroke:#b8956a\n    style L3 fill:#d4c4b0,stroke:#a07850</code></pre>"},{"location":"tutorials/#tutorials-by-level","title":"Tutorials by Level","text":""},{"location":"tutorials/#level-1-getting-started","title":"Level 1: Getting Started","text":"<p>Get comfortable reading and navigating your email through Claude.</p> Tutorial Time What You'll Learn Read Your First Email 2 min List inbox, read messages, HTML vs plain text Multi-Account Email 3 min Switch accounts, cross-account queries, defaults Desktop Extension 5 min Install .mcpb, configure, use in Claude Desktop/Cowork"},{"location":"tutorials/#level-2-productivity","title":"Level 2: Productivity","text":"<p>Organize, reply, and export emails efficiently.</p> Tutorial Time Prerequisites Triage Your Inbox 5 min Level 1 Reply to an Email 5 min Level 1 Compose and Send Email 5 min Level 1 Attachments and Calendar 5 min Level 1 Search and Manage 5 min Level 1 Export and Save Emails 3 min Level 1"},{"location":"tutorials/#level-3-automation","title":"Level 3: Automation","text":"<p>Let the email-assistant agent handle your entire inbox workflow.</p> Tutorial Time Prerequisites Automate with the Agent 10 min Level 2 <p>Total learning time: ~43 minutes from zero to full automation.</p> <p>Prerequisites: Installation complete and himalaya CLI configured with at least one email account.</p>"},{"location":"tutorials/attachments-calendar/","title":"Attachments and Calendar Events","text":"<p>Level 2 | Time: 5 minutes | Builds on: Read Your First Email</p>"},{"location":"tutorials/attachments-calendar/#part-1-working-with-attachments","title":"Part 1: Working with Attachments","text":""},{"location":"tutorials/attachments-calendar/#step-1-list-attachments","title":"Step 1: List attachments","text":"<pre><code>You: \"What attachments does email 42 have?\"\n</code></pre> <p>Claude calls <code>list_attachments</code> and shows:</p> <pre><code>Attachments for email 42:\n- report.pdf (application/pdf, 245 KB)\n- invite.ics (text/calendar, 2 KB)\n- screenshot.png (image/png, 118 KB)\n</code></pre>"},{"location":"tutorials/attachments-calendar/#step-2-download-an-attachment","title":"Step 2: Download an attachment","text":"<pre><code>You: \"Download the report PDF\"\n</code></pre> <p>Claude calls <code>download_attachment</code> and returns the file path:</p> <pre><code>Downloaded \"report.pdf\" to: /tmp/himalaya-mcp-abc123/report.pdf\n</code></pre> <p>The file is saved to a temporary directory. You can reference it in follow-up conversations or copy the path.</p>"},{"location":"tutorials/attachments-calendar/#part-2-calendar-invites","title":"Part 2: Calendar Invites","text":""},{"location":"tutorials/attachments-calendar/#step-3-extract-a-calendar-event","title":"Step 3: Extract a calendar event","text":"<p>When an email has an <code>.ics</code> attachment (calendar invite):</p> <pre><code>You: \"What meeting is in email 42?\"\n</code></pre> <p>Claude calls <code>extract_calendar_event</code> and parses the ICS file:</p> <pre><code>Event: Q2 Planning Meeting\nStart: 2026-03-01T14:00:00\nEnd: 2026-03-01T15:00:00\nLocation: Room 42\nOrganizer: alice@example.com\nDescription: Quarterly planning session\n\nUse create_calendar_event to add this to Apple Calendar.\n</code></pre>"},{"location":"tutorials/attachments-calendar/#step-4-add-to-apple-calendar","title":"Step 4: Add to Apple Calendar","text":"<pre><code>You: \"Add it to my calendar\"\n</code></pre> <p>Claude shows a preview first:</p> <pre><code>--- CALENDAR EVENT PREVIEW (not created) ---\n\nEvent: Q2 Planning Meeting\nStart: 2026-03-01T14:00:00\nEnd: 2026-03-01T15:00:00\nLocation: Room 42\n\n--- END PREVIEW ---\n\nCreate this event? (confirm to proceed)\n</code></pre> <p>After you confirm:</p> <pre><code>You: \"Yes, create it\"\n</code></pre> <p>The event is added to Apple Calendar.</p> <p>macOS only</p> <p>Calendar event creation uses AppleScript to interact with Apple Calendar. This feature is only available on macOS.</p>"},{"location":"tutorials/attachments-calendar/#what-you-learned","title":"What you learned","text":"<ul> <li><code>list_attachments</code> shows files with MIME types and sizes</li> <li><code>download_attachment</code> saves to a temp directory and returns the path</li> <li><code>extract_calendar_event</code> parses ICS invites from email attachments</li> <li><code>create_calendar_event</code> has a safety gate: preview first, then confirm</li> <li>Body parts (plain.txt, index.html) are automatically filtered from attachment listings</li> </ul> <p>Next: Automate with the Agent | Back to: Tutorials</p>"},{"location":"tutorials/automate-agent/","title":"Automate with the Agent","text":"<p>Level 3 | Time: 10 minutes | Builds on: All Level 2 tutorials</p> <p>The email-assistant agent combines all previous workflows into one autonomous session.</p>"},{"location":"tutorials/automate-agent/#step-1-start-the-agent","title":"Step 1: Start the agent","text":"<pre><code>You: \"Handle my email\"\n</code></pre> <p>The agent scans your inbox, reads unread emails, and classifies everything.</p>"},{"location":"tutorials/automate-agent/#step-2-review-the-plan","title":"Step 2: Review the plan","text":"<p>The agent presents a summary:</p> <pre><code>Scanned 15 unread emails:\n\nActionable (3):\n  - Alice: Q1 Budget Review -- reply needed by Friday\n  - Boss: Meeting Tomorrow -- needs preparation\n  - Client: Project Update Request -- reply with status\n\nFYI (5):\n  - Bob: Sprint retro notes\n  - DevOps: Server maintenance Saturday\n  - HR: Benefits enrollment reminder\n  - GitHub: 3 PRs merged\n  - CI: Build passed\n\nLow Priority (7):\n  - 4 newsletters\n  - 2 marketing emails\n  - 1 social notification\n\nSuggested plan:\n1. Draft replies for 3 actionable emails\n2. Mark 5 FYI emails as read\n3. Archive 7 low-priority emails\n\nProceed?\n</code></pre>"},{"location":"tutorials/automate-agent/#step-3-process-actionable-emails","title":"Step 3: Process actionable emails","text":"<p>For each actionable email, the agent:</p> <ol> <li>Shows the email content</li> <li>Generates a reply draft</li> <li>Waits for your approval</li> <li>Sends only after your \"yes\"</li> </ol> <pre><code>Email 1/3: Q1 Budget Review from Alice\n\nDraft reply:\n---\nHi Alice, reviewed the numbers -- looks aligned.\nTwo questions about marketing spend and eng allocation.\nCan we chat this week?\n---\n\nSend? (yes / edit / skip)\n</code></pre>"},{"location":"tutorials/automate-agent/#step-4-handle-bulk-actions","title":"Step 4: Handle bulk actions","text":"<p>After replies, the agent processes FYI and low-priority:</p> <pre><code>Bulk actions:\n- Mark 5 FYI emails as read? (y/n)\n- Archive 7 low-priority emails? (y/n)\n</code></pre>"},{"location":"tutorials/automate-agent/#step-5-get-the-report","title":"Step 5: Get the report","text":"<p>The agent generates a final digest:</p> <pre><code>Session complete:\n- 3 replies sent\n- 5 emails marked read\n- 7 emails archived\n- 0 remaining unread\n\nTime saved: ~25 minutes of manual email work\n</code></pre>"},{"location":"tutorials/automate-agent/#what-you-learned","title":"What you learned","text":"<ul> <li>The agent automates the full triage-read-reply cycle</li> <li>Each reply still requires your explicit approval</li> <li>Bulk actions are grouped for efficiency</li> <li>Nothing is deleted -- only flagged, moved, or replied to</li> </ul> <p>Back to: Tutorials</p>"},{"location":"tutorials/compose-email/","title":"Compose and Send a New Email","text":"<p>Level 2 | Time: 5 minutes | Builds on: Reply to an Email</p>"},{"location":"tutorials/compose-email/#step-1-tell-claude-what-to-send","title":"Step 1: Tell Claude what to send","text":"<pre><code>You: \"Email alice@example.com about rescheduling our meeting to Thursday\"\n</code></pre> <p>Claude composes the email and shows a preview:</p> <pre><code>--- EMAIL PREVIEW (not sent) ---\n\nTo: alice@example.com\nSubject: Meeting Rescheduled to Thursday\n\nHi Alice,\n\nWould it be possible to move our meeting to Thursday? I have a\nconflict on the original date. Same time works for me.\n\nLet me know if that works for you.\n\nBest regards\n\n--- END PREVIEW ---\n\nSend this, edit it, or cancel?\n</code></pre>"},{"location":"tutorials/compose-email/#step-2-refine-before-sending","title":"Step 2: Refine before sending","text":"<p>You can adjust anything:</p> <pre><code>You: \"Add CC to bob@example.com and mention it's the Q2 planning meeting\"\n</code></pre> <p>Claude revises and shows the updated preview:</p> <pre><code>--- EMAIL PREVIEW (not sent) ---\n\nTo: alice@example.com\nCc: bob@example.com\nSubject: Reschedule Q2 Planning Meeting to Thursday\n\nHi Alice,\n\nCould we move the Q2 planning meeting to Thursday? I have a\nscheduling conflict on Wednesday. Happy to keep the same time.\n\nBob, FYI on the change.\n\nBest regards\n\n--- END PREVIEW ---\n</code></pre>"},{"location":"tutorials/compose-email/#step-3-send-it","title":"Step 3: Send it","text":"<p>When you're satisfied:</p> <pre><code>You: \"Send it\"\n</code></pre> <p>Claude calls <code>compose_email</code> with <code>confirm=true</code> and the email is sent.</p> <p>Safety gate</p> <p>Just like replies, new emails are never sent without your explicit approval. Claude always shows a preview first.</p>"},{"location":"tutorials/compose-email/#what-you-learned","title":"What you learned","text":"<ul> <li><code>compose_email</code> creates new emails (not replies)</li> <li>The same two-phase safety gate applies: preview first, then confirm</li> <li>You can add CC/BCC recipients</li> <li>Natural language editing works before sending</li> </ul> <p>Next: Attachments and Calendar | Back to: Tutorials</p>"},{"location":"tutorials/desktop-extension/","title":"Using himalaya-mcp in Claude Desktop","text":"<p>Use himalaya-mcp as a Desktop Extension to read, triage, and manage email directly in Claude Desktop and Claude Cowork.</p>"},{"location":"tutorials/desktop-extension/#what-youll-learn","title":"What You'll Learn","text":"<ul> <li>Install the <code>.mcpb</code> Desktop Extension</li> <li>Configure your himalaya binary path and account</li> <li>Use email tools via natural language</li> <li>Diagnose and fix common issues</li> </ul>"},{"location":"tutorials/desktop-extension/#prerequisites","title":"Prerequisites","text":"<ul> <li>Claude Desktop installed</li> <li>himalaya CLI installed and configured (<code>brew install himalaya</code>)</li> <li>At least one email account in <code>~/.config/himalaya/config.toml</code></li> </ul> <p>himalaya CLI is a separate install</p> <p>The <code>.mcpb</code> Desktop Extension does not bundle the himalaya CLI. You must install it separately before the extension can access your email. Run <code>brew install himalaya</code> and configure at least one account in <code>~/.config/himalaya/config.toml</code>.</p> <p>Verify himalaya works from your terminal first:</p> <pre><code>himalaya envelope list --output json\n</code></pre>"},{"location":"tutorials/desktop-extension/#step-1-install-the-extension","title":"Step 1: Install the Extension","text":""},{"location":"tutorials/desktop-extension/#option-a-double-click-easiest","title":"Option A: Double-click (easiest)","text":"<p>Download <code>himalaya-mcp-v{version}.mcpb</code> from GitHub Releases and double-click the file. Claude Desktop opens and installs it automatically.</p>"},{"location":"tutorials/desktop-extension/#option-b-cli-install","title":"Option B: CLI install","text":"<p>If you have himalaya-mcp installed locally (Homebrew or source):</p> <pre><code>himalaya-mcp install-ext\n</code></pre> <p>This unpacks the extension and registers it with Claude Desktop.</p>"},{"location":"tutorials/desktop-extension/#option-c-build-from-source","title":"Option C: Build from source","text":"<pre><code>git clone https://github.com/Data-Wise/himalaya-mcp.git\ncd himalaya-mcp\nnpm install\nnpm run build:mcpb          # Creates himalaya-mcp-v{version}.mcpb\nhimalaya-mcp install-ext    # Install into Claude Desktop\n</code></pre>"},{"location":"tutorials/desktop-extension/#step-2-configure-first-time-only","title":"Step 2: Configure (first time only)","text":"<p>When the extension installs, Claude Desktop shows three optional configuration fields:</p> Field What to set When to set it himalaya binary path <code>/opt/homebrew/bin/himalaya</code> Always recommended (Desktop doesn't inherit your shell PATH) Default account Your account name (e.g., <code>personal</code>) Only if you have multiple accounts Default folder Leave empty Only if you want a non-INBOX default <p>Important: Set the binary path. Claude Desktop runs in its own environment without your shell's PATH, so it can't find <code>himalaya</code> unless you provide the full path.</p> <p>Find your himalaya path:</p> <pre><code>which himalaya\n# /opt/homebrew/bin/himalaya\n</code></pre>"},{"location":"tutorials/desktop-extension/#editing-settings-later","title":"Editing settings later","text":"<p>Extension settings are stored at:</p> <pre><code>~/Library/Application Support/Claude/Claude Extensions Settings/himalaya-mcp.json\n</code></pre> <pre><code>{\n  \"isEnabled\": true,\n  \"userConfig\": {\n    \"himalaya_binary\": \"/opt/homebrew/bin/himalaya\",\n    \"himalaya_account\": \"\",\n    \"himalaya_folder\": \"\"\n  }\n}\n</code></pre> <p>Edit this file directly and restart Claude Desktop to apply changes.</p>"},{"location":"tutorials/desktop-extension/#step-3-restart-claude-desktop","title":"Step 3: Restart Claude Desktop","text":"<p>After installing or updating the extension, restart Claude Desktop. The extension registers 19 tools, 4 prompts, and 3 resources.</p>"},{"location":"tutorials/desktop-extension/#step-4-try-it","title":"Step 4: Try It","text":"<p>Open a new conversation in Claude Desktop and type naturally:</p>"},{"location":"tutorials/desktop-extension/#read-emails","title":"Read emails","text":"<pre><code>You: \"Check my inbox\"\n</code></pre> <p>Claude calls <code>list_emails</code> and shows your recent messages with ID, sender, subject, date, and flags.</p> <pre><code>You: \"Read email 42\"\n</code></pre> <p>Claude calls <code>read_email</code> to show the full message body.</p>"},{"location":"tutorials/desktop-extension/#search","title":"Search","text":"<pre><code>You: \"Find emails from Alice about the budget\"\n</code></pre> <p>Claude calls <code>search_emails(query: \"from alice and subject budget\")</code>.</p>"},{"location":"tutorials/desktop-extension/#triage","title":"Triage","text":"<pre><code>You: \"Triage my last 10 emails\"\n</code></pre> <p>Claude uses the <code>triage_inbox</code> prompt to classify each email as Actionable, FYI, or Skip, then suggests flags and folder moves.</p>"},{"location":"tutorials/desktop-extension/#reply","title":"Reply","text":"<pre><code>You: \"Reply to email 42 saying I'll be there\"\n</code></pre> <p>Claude generates a draft reply and shows it for your approval. It never sends until you explicitly confirm.</p>"},{"location":"tutorials/desktop-extension/#daily-digest","title":"Daily digest","text":"<pre><code>You: \"Give me today's email digest\"\n</code></pre> <p>Claude uses the <code>daily_email_digest</code> prompt to create a priority-grouped summary.</p>"},{"location":"tutorials/desktop-extension/#multi-account","title":"Multi-account","text":"<pre><code>You: \"List emails from my work account\"\n</code></pre> <p>Claude calls <code>list_emails(account: \"work\")</code>. Every tool accepts an optional <code>account</code> parameter.</p>"},{"location":"tutorials/desktop-extension/#attachments-and-calendar","title":"Attachments and calendar","text":"<pre><code>You: \"What attachments does email 88 have?\"\nYou: \"Download the PDF from email 88\"\nYou: \"Extract the calendar invite from email 90\"\n</code></pre>"},{"location":"tutorials/desktop-extension/#compose","title":"Compose","text":"<pre><code>You: \"Send Alice an email about the meeting tomorrow\"\n</code></pre> <p>Claude composes a preview first -- you review and approve before it sends.</p>"},{"location":"tutorials/desktop-extension/#step-5-verify-with-doctor","title":"Step 5: Verify with Doctor","text":"<p>If something isn't working, run the diagnostic command:</p> <pre><code>himalaya-mcp doctor\n</code></pre> <p>This checks all six layers: prerequisites, MCP server, email connectivity, Desktop extension install, Claude Code plugin, and environment variables.</p> <pre><code>himalaya-mcp doctor --fix    # Auto-fix common issues\n</code></pre>"},{"location":"tutorials/desktop-extension/#claude-cowork","title":"Claude Cowork","text":"<p>The extension works identically in Claude Cowork (the collaborative mode within Claude Desktop). Cowork shares the same extension registry and settings -- no additional configuration needed.</p>"},{"location":"tutorials/desktop-extension/#differences-from-claude-code","title":"Differences from Claude Code","text":"Feature Claude Desktop Claude Code 19 MCP tools Yes Yes 4 MCP prompts Yes Yes 3 MCP resources Yes Yes Interaction style Natural language Natural language + <code>/email:*</code> skills Email assistant agent No Yes Slash commands No 7 skills (<code>/email:inbox</code>, etc.) <p>In Claude Desktop, everything is natural language. Say \"check my inbox\" instead of <code>/email:inbox</code>. The underlying tools are identical.</p>"},{"location":"tutorials/desktop-extension/#troubleshooting","title":"Troubleshooting","text":""},{"location":"tutorials/desktop-extension/#himalaya-cli-not-found","title":"\"himalaya CLI not found\"","text":"<p>The most common issue. Claude Desktop doesn't inherit your shell PATH.</p> <p>Fix: Set the full path in extension settings:</p> <pre><code>{\n  \"userConfig\": {\n    \"himalaya_binary\": \"/opt/homebrew/bin/himalaya\"\n  }\n}\n</code></pre> <p>Or run <code>himalaya-mcp doctor --fix</code> to set it automatically.</p>"},{"location":"tutorials/desktop-extension/#tools-not-appearing","title":"Tools not appearing","text":"<ol> <li>Restart Claude Desktop after installing the extension</li> <li>Check that the extension is enabled (look for the extensions icon in Desktop)</li> <li>Run <code>himalaya-mcp doctor</code> to verify the extension registry</li> </ol>"},{"location":"tutorials/desktop-extension/#slow-responses","title":"Slow responses","text":"<p>Large mailboxes or slow IMAP servers can take time. The default timeout is 2 minutes (120s). For very large mailboxes, you can increase it or set to 0 for unlimited:</p> <pre><code>{\n  \"userConfig\": {\n    \"himalaya_binary\": \"/opt/homebrew/bin/himalaya\"\n  }\n}\n</code></pre> <p>And set <code>HIMALAYA_TIMEOUT</code> in the manifest env (requires rebuilding the <code>.mcpb</code>).</p>"},{"location":"tutorials/desktop-extension/#next-steps","title":"Next Steps","text":"<ul> <li>Command Reference -- all 19 tools with parameters and examples</li> <li>Workflows -- common email patterns (triage, reply, export)</li> <li>Troubleshooting -- full troubleshooting guide</li> <li>Desktop Extensions Reference -- <code>.mcpb</code> format details</li> </ul>"},{"location":"tutorials/export-save/","title":"Export and Save Emails","text":"<p>Level 2 | Time: 3 minutes | Builds on: Read Your First Email</p>"},{"location":"tutorials/export-save/#step-1-export-as-markdown","title":"Step 1: Export as markdown","text":"<pre><code>You: \"Export email 249088 as markdown\"\n</code></pre> <p>Claude calls <code>export_to_markdown</code> and returns:</p> <pre><code>---\nsubject: \"Q1 Budget Review\"\nfrom: \"Alice &lt;alice@work.com&gt;\"\nto: \"You &lt;you@work.com&gt;\"\ndate: \"2026-02-13\"\nid: \"249088\"\nflags: [Seen, Flagged]\n---\n\n# Q1 Budget Review\n\nHi team, please review the attached budget...\n</code></pre>"},{"location":"tutorials/export-save/#step-2-copy-to-clipboard","title":"Step 2: Copy to clipboard","text":"<pre><code>You: \"Copy that to my clipboard\"\n</code></pre> <p>Claude calls <code>copy_to_clipboard</code> with the markdown text.</p>"},{"location":"tutorials/export-save/#step-3-extract-action-items","title":"Step 3: Extract action items","text":"<pre><code>You: \"What are the action items from that email?\"\n</code></pre> <p>Claude calls <code>create_action_item</code> and returns:</p> <pre><code>Action items from \"Q1 Budget Review\":\n- [ ] Review budget spreadsheet\n- [ ] Submit feedback by Friday 2026-02-14\n- [ ] Schedule follow-up meeting\n</code></pre>"},{"location":"tutorials/export-save/#step-4-combine-for-productivity","title":"Step 4: Combine for productivity","text":"<pre><code>You: \"Export the email as markdown, extract the action items,\n      and copy everything to my clipboard\"\n</code></pre> <p>Claude chains the operations and copies the combined output.</p>"},{"location":"tutorials/export-save/#what-you-learned","title":"What you learned","text":"<ul> <li><code>export_to_markdown</code> creates structured markdown with YAML frontmatter</li> <li><code>copy_to_clipboard</code> puts text on your system clipboard</li> <li><code>create_action_item</code> extracts todos and deadlines</li> <li>You can chain multiple operations in a single request</li> </ul> <p>Next: Automate with the Agent (Level 3) | Back to: Tutorials</p>"},{"location":"tutorials/multi-account/","title":"Multi-Account Email","text":"<p>Level 1 | Time: 3 minutes | Builds on: Read Your First Email</p>"},{"location":"tutorials/multi-account/#step-1-check-available-accounts","title":"Step 1: Check available accounts","text":"<pre><code>You: \"What email accounts do I have?\"\n</code></pre> <p>Claude reads your himalaya configuration and lists accounts.</p>"},{"location":"tutorials/multi-account/#step-2-read-from-a-specific-account","title":"Step 2: Read from a specific account","text":"<pre><code>You: \"Check my work inbox\"\n</code></pre> <p>Claude calls <code>list_emails(account: \"work\")</code>.</p>"},{"location":"tutorials/multi-account/#step-3-cross-account-workflow","title":"Step 3: Cross-account workflow","text":"<pre><code>You: \"Check both my work and personal inboxes\"\n</code></pre> <p>Claude runs two separate queries and presents combined results with account labels.</p>"},{"location":"tutorials/multi-account/#step-4-set-a-default","title":"Step 4: Set a default","text":"<p>In your MCP server config, set <code>HIMALAYA_ACCOUNT</code>:</p> <pre><code>{\n  \"env\": {\n    \"HIMALAYA_ACCOUNT\": \"work\"\n  }\n}\n</code></pre> <p>Now <code>list_emails</code> defaults to your work account. Override per-call with \"check my personal inbox.\"</p>"},{"location":"tutorials/multi-account/#what-you-learned","title":"What you learned","text":"<ul> <li>Each himalaya account is accessible by name</li> <li>Claude can query multiple accounts in one request</li> <li><code>HIMALAYA_ACCOUNT</code> sets the default for all tools</li> </ul> <p>Next: Triage Your Inbox (Level 2) | Back to: Tutorials</p>"},{"location":"tutorials/read-first-email/","title":"Read Your First Email","text":"<p>Level 1 | Time: 2 minutes | Prerequisites: Installation complete</p>"},{"location":"tutorials/read-first-email/#step-1-list-your-inbox","title":"Step 1: List your inbox","text":"<pre><code>You: \"Check my inbox\"\n</code></pre> <p>Claude calls <code>list_emails</code> and shows your recent emails in a table. Note the ID column -- you'll need it.</p>"},{"location":"tutorials/read-first-email/#step-2-read-an-email","title":"Step 2: Read an email","text":"<p>Pick an ID from the list:</p> <pre><code>You: \"Read email 249088\"\n</code></pre> <p>Claude calls <code>read_email(id: \"249088\")</code> and shows the full plain text body.</p>"},{"location":"tutorials/read-first-email/#step-3-try-html-format","title":"Step 3: Try HTML format","text":"<p>If the email looks poorly formatted (common with newsletters):</p> <pre><code>You: \"Show me the HTML version\"\n</code></pre> <p>Claude calls <code>read_email_html</code> for the rich text version.</p>"},{"location":"tutorials/read-first-email/#what-you-learned","title":"What you learned","text":"<ul> <li><code>list_emails</code> shows envelope data (sender, subject, date)</li> <li><code>read_email</code> shows the full body</li> <li>Email IDs connect everything together</li> </ul> <p>Next: Multi-Account Email | Back to: Tutorials</p>"},{"location":"tutorials/reply-email/","title":"Reply to an Email","text":"<p>Level 2 | Time: 5 minutes | Builds on: Triage Your Inbox</p>"},{"location":"tutorials/reply-email/#step-1-pick-an-email-to-reply-to","title":"Step 1: Pick an email to reply to","text":"<p>From your triage results or inbox listing:</p> <pre><code>You: \"Reply to email 249088\"\n</code></pre>"},{"location":"tutorials/reply-email/#step-2-review-the-draft","title":"Step 2: Review the draft","text":"<p>Claude reads the original email, then generates a reply:</p> <pre><code>Draft reply to Alice (Q1 Budget Review):\n\n---\nHi Alice,\n\nThanks for sharing the Q1 budget review. I've reviewed the\nnumbers and everything looks aligned with our targets.\n\nTwo quick questions:\n1. The marketing spend seems higher than projected -- is this\n   the new campaign?\n2. Can we schedule time to discuss the engineering allocation?\n\nBest,\n[Your name]\n---\n\nSend this, edit it, or cancel?\n</code></pre>"},{"location":"tutorials/reply-email/#step-3-refine-the-draft","title":"Step 3: Refine the draft","text":"<p>You can ask for changes:</p> <pre><code>You: \"Make it shorter and more casual\"\n</code></pre> <p>Claude revises:</p> <pre><code>Hey Alice,\n\nLooks good overall. Quick q -- is the marketing bump from the\nnew campaign? And can we chat about the eng budget this week?\n\nCheers\n---\n</code></pre>"},{"location":"tutorials/reply-email/#step-4-send-or-dont","title":"Step 4: Send (or don't)","text":"<p>When you're happy:</p> <pre><code>You: \"Send it\"\n</code></pre> <p>Claude calls <code>send_email(template, confirm: true)</code> and the email is sent.</p> <p>Safety gate</p> <p>Claude will never send without your explicit approval. Even if you say \"reply to all my emails,\" each draft is shown individually for review.</p>"},{"location":"tutorials/reply-email/#what-you-learned","title":"What you learned","text":"<ul> <li>Replies always show a draft first</li> <li>You can refine the draft with natural language</li> <li>Sending requires explicit confirmation</li> <li>You control the tone and content</li> </ul> <p>Next: Export and Save Emails | Back to: Tutorials</p>"},{"location":"tutorials/triage-inbox/","title":"Triage Your Inbox","text":"<p>Level 2 | Time: 5 minutes | Builds on: Read Your First Email</p>"},{"location":"tutorials/triage-inbox/#step-1-start-triage","title":"Step 1: Start triage","text":"<pre><code>You: \"Triage my last 10 emails\"\n</code></pre> <p>Claude reads each email and classifies them into three categories:</p> <ul> <li>Actionable -- needs a reply or follow-up</li> <li>Informational -- worth knowing, no action needed</li> <li>Skip -- newsletters, promotions, noise</li> </ul>"},{"location":"tutorials/triage-inbox/#step-2-review-the-results","title":"Step 2: Review the results","text":"<p>Claude presents a table like:</p> <pre><code>| ID     | From           | Subject          | Class        | Action          |\n|--------|----------------|------------------|--------------|-----------------|\n| 249088 | alice@work.com | Q1 Budget Review | Actionable   | Reply by Friday |\n| 249064 | newsletter@... | Weekly Digest    | Skip         | Archive         |\n| 249051 | boss@work.com  | Meeting Tomorrow | Actionable   | Flag + prepare  |\n</code></pre>"},{"location":"tutorials/triage-inbox/#step-3-approve-actions","title":"Step 3: Approve actions","text":"<p>Claude asks what to do. You can:</p> <ul> <li>Accept all: \"Yes, do it\"</li> <li>Cherry-pick: \"Flag the two actionable ones, but keep the newsletter\"</li> <li>Skip: \"Don't make any changes\"</li> </ul>"},{"location":"tutorials/triage-inbox/#step-4-flag-and-organize","title":"Step 4: Flag and organize","text":"<p>If you approve, Claude executes:</p> <pre><code>flag_email(id: \"249088\", flags: [\"Flagged\"], action: \"add\")\nflag_email(id: \"249051\", flags: [\"Flagged\"], action: \"add\")\nmove_email(id: \"249064\", target_folder: \"Archive\")\n</code></pre>"},{"location":"tutorials/triage-inbox/#what-you-learned","title":"What you learned","text":"<ul> <li>Triage classifies emails into actionable categories</li> <li>Claude always asks before making changes</li> <li>Flags and moves are the primary organization tools</li> </ul> <p>Next: Reply to an Email | Back to: Tutorials</p>"}]}